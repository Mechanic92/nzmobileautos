exports.id=3065,exports.ids=[3065],exports.modules={9870:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,25265,23)),Promise.resolve().then(a.t.bind(a,34249,23)),Promise.resolve().then(a.t.bind(a,39809,23)),Promise.resolve().then(a.t.bind(a,51984,23)),Promise.resolve().then(a.t.bind(a,6480,23)),Promise.resolve().then(a.t.bind(a,65588,23)),Promise.resolve().then(a.t.bind(a,90635,23))},72918:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,95121,23)),Promise.resolve().then(a.t.bind(a,39593,23)),Promise.resolve().then(a.t.bind(a,91937,23)),Promise.resolve().then(a.t.bind(a,17744,23)),Promise.resolve().then(a.t.bind(a,42032,23)),Promise.resolve().then(a.t.bind(a,84692,23)),Promise.resolve().then(a.t.bind(a,58147,23))},38659:(e,t,a)=>{Promise.resolve().then(a.bind(a,35538))},52731:(e,t,a)=>{Promise.resolve().then(a.bind(a,72709))},64897:()=>{},78049:()=>{},72709:(e,t,a)=>{"use strict";a.d(t,{ReportEditor:()=>n});var s=a(57102),r=a(45087);function n({bookingId:e,defaultType:t}){let[a,n]=(0,r.useState)(!0),[i,l]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[c,h]=(0,r.useState)(!1),[m,p]=(0,r.useState)(null),[u,x]=(0,r.useState)(null),b=(0,r.useMemo)(()=>"",[u]),w=(e,t)=>{u&&x({...u,dataJson:{...u.dataJson,[e]:t}})},g=e=>{if(!u)return;let t=[...u.dataJson.attachments||[],e];x({...u,dataJson:{...u.dataJson,attachments:t}})},f=e=>{if(!u)return;let t=[...u.dataJson.attachments||[]];t.splice(e,1),x({...u,dataJson:{...u.dataJson,attachments:t}})},v=async e=>{if(u&&e&&0!==e.length){h(!0),p(null);try{for(let t of Array.from(e)){let e=await fetch("/api/uploads/presign",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({reportId:u.id,fileName:t.name,contentType:t.type,sizeBytes:t.size})});if(!e.ok)throw Error(await e.text());let a=await e.json();if(!(await fetch(a.uploadUrl,{method:"PUT",headers:{"content-type":t.type},body:t})).ok)throw Error("Upload failed");g({url:a.publicUrl,label:t.name,contentType:a.contentType})}await y()}catch(e){p(e?.message||"Failed to upload photo")}finally{h(!1)}}},y=async e=>{if(u){l(!0),p(null);try{let t=await fetch("/api/reports/update",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:u.id,status:e,dataJson:u.dataJson})});if(!t.ok)throw Error(await t.text());let a=await t.json();x(a)}catch(e){p(e?.message||"Failed to save report")}finally{l(!1)}}},N=async()=>{if(u){d(!0),p(null);try{await y("FINAL");let e=await fetch("/api/reports/send-email",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({reportId:u.id})});if(!e.ok)throw Error(await e.text());window.alert("Report email sent.")}catch(e){p(e?.message||"Failed to send email")}finally{d(!1)}}};return a?(0,s.jsx)("div",{className:"text-white/70",children:"Loading report…"}):m?(0,s.jsx)("div",{className:"text-red-300",children:m}):u?(0,s.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{className:"text-sm text-white/70",children:"Photos (JPG/PNG/WebP)"}),(0,s.jsx)("input",{type:"file",accept:"image/jpeg,image/png,image/webp",multiple:!0,disabled:c,onChange:e=>void v(e.target.files)}),c?(0,s.jsx)("div",{className:"text-white/60 text-sm",children:"Uploading…"}):null,u.dataJson.attachments?.length?(0,s.jsx)("div",{className:"mt-3 grid gap-3",children:u.dataJson.attachments.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("a",{className:"text-brand-yellow hover:underline text-sm",href:e.url,target:"_blank",rel:"noreferrer",children:e.label||e.url}),(0,s.jsx)("button",{type:"button",className:"text-xs px-2 py-1 rounded border border-white/15 hover:bg-white/5",onClick:()=>f(t),children:"Remove"})]},t))}):(0,s.jsx)("div",{className:"text-white/60 text-sm",children:"No photos uploaded yet."})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{className:"text-sm text-white/70",children:"Title"}),(0,s.jsx)("input",{className:"w-full px-3 py-2 rounded bg-black/40 border border-white/10",value:u.dataJson.title,onChange:e=>w("title",e.target.value)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{className:"text-sm text-white/70",children:"Summary (customer-facing)"}),(0,s.jsx)("textarea",{className:"w-full min-h-28 px-3 py-2 rounded bg-black/40 border border-white/10",value:u.dataJson.summary,onChange:e=>w("summary",e.target.value)})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{className:"text-sm text-white/70",children:"Report content (plain text / markdown later)"}),(0,s.jsx)("textarea",{className:"w-full min-h-72 px-3 py-2 rounded bg-black/40 border border-white/10 font-mono text-sm",value:u.dataJson.contentMarkdown,onChange:e=>w("contentMarkdown",e.target.value)})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3 items-center",children:[(0,s.jsx)("button",{type:"button",disabled:i,className:"px-4 py-2 rounded bg-white/10 hover:bg-white/15 disabled:opacity-60",onClick:()=>y(),children:i?"Saving…":"Save"}),(0,s.jsx)("button",{type:"button",disabled:o,className:"px-4 py-2 rounded bg-brand-yellow text-black font-semibold disabled:opacity-60",onClick:N,children:o?"Sending…":"Finalize + Email to customer"}),(0,s.jsx)("a",{className:"text-brand-yellow hover:underline text-sm",href:b,target:"_blank",rel:"noreferrer",children:"Preview customer view"}),(0,s.jsxs)("div",{className:"text-xs text-white/50",children:["Status: ",u.status]})]})]}):(0,s.jsx)("div",{className:"text-white/70",children:"Report not available."})}},35538:(e,t,a)=>{"use strict";a.d(t,{ReportEditor:()=>s});let s=(0,a(93734).registerClientReference)(function(){throw Error("Attempted to call ReportEditor() from the server but ReportEditor is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\nzmobileautos\\next\\src\\app\\admin\\reports\\ReportEditor.tsx","ReportEditor")},60442:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l,metadata:()=>i});var s=a(38982);a(39839);var r=a(72646),n=a(86455);let i={metadataBase:new URL(process.env.APP_URL||"https://mobileautoworksnz.com"),title:{default:"Mobile Autoworks NZ",template:"%s | Mobile Autoworks NZ"},description:"Book diagnostics and pre-purchase inspections across Auckland.",alternates:{canonical:"/"},openGraph:{type:"website",siteName:"Mobile Autoworks NZ",url:"/",title:"Mobile Autoworks NZ",description:"Book diagnostics and pre-purchase inspections across Auckland."}};async function l({children:e}){let t=process.env.ADMIN_AUTH_SECRET,a=(await r.UL()).get(n.Dn())?.value,i=!!t&&!!a&&!!await (0,n.XD)(a,t);return(0,s.jsx)("html",{lang:"en",children:(0,s.jsx)("body",{children:(0,s.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,s.jsx)("header",{className:"sticky top-0 z-30 border-b border-white/10 bg-black/60 backdrop-blur",children:(0,s.jsxs)("div",{className:"container py-4 flex items-center justify-between gap-4",children:[(0,s.jsxs)("a",{href:"/",className:"flex items-center gap-3 no-underline",children:[(0,s.jsx)("div",{className:"h-9 w-9 rounded-lg bg-brand-yellow/15 border border-brand-yellow/30 flex items-center justify-center",children:(0,s.jsx)("div",{className:"h-2.5 w-2.5 rounded-full bg-brand-yellow"})}),(0,s.jsxs)("div",{className:"leading-tight",children:[(0,s.jsxs)("div",{className:"font-semibold tracking-tight",children:[(0,s.jsx)("span",{className:"text-brand-yellow",children:"Mobile"})," Autoworks"]}),(0,s.jsx)("div",{className:"text-xs text-white/60",children:"Auckland • Diagnostics • Pre-purchase inspections"})]})]}),(0,s.jsxs)("nav",{className:"text-sm flex items-center gap-3",children:[i&&(0,s.jsx)("a",{className:"text-white/80 hover:text-white no-underline px-3 py-2 rounded-md hover:bg-white/5",href:"/admin",children:"Admin"}),(0,s.jsx)("a",{className:"no-underline px-3 py-2 rounded-md bg-brand-yellow text-black font-semibold hover:bg-brand-yellow/90",href:"/book",children:"Book now"})]})]})}),(0,s.jsx)("main",{className:"flex-1",children:e}),(0,s.jsx)("footer",{className:"border-t border-white/10",children:(0,s.jsx)("div",{className:"container py-10",children:(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-semibold",children:[(0,s.jsx)("span",{className:"text-brand-yellow",children:"Mobile"})," Autoworks NZ"]}),(0,s.jsx)("div",{className:"mt-2 text-sm text-white/60 max-w-md",children:"Mobile diagnostics and premium pre-purchase inspections across Auckland. Fast, clear communication and high-quality reports."})]}),(0,s.jsx)("div",{className:"text-sm text-white/60 md:text-right",children:(0,s.jsxs)("div",{children:["\xa9 ",new Date().getFullYear()," Mobile Autoworks NZ"]})})]})})})]})})})}},38010:(e,t,a)=>{"use strict";a.d(t,{Q:()=>n});var s=a(72646),r=a(86455);async function n(){let e=process.env.ADMIN_AUTH_SECRET;if(!e)throw Error("Admin auth not configured");let t=(await s.UL()).get(r.Dn())?.value,a=t?await (0,r.XD)(t,e):null;if(!a)throw Error("Unauthorized");return a}},86455:(e,t,a)=>{"use strict";function s(e){return Buffer.from(e).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function r(e){let t=e.length%4==0?"":"=".repeat(4-e.length%4),a=e.replace(/-/g,"+").replace(/_/g,"/")+t;return new Uint8Array(Buffer.from(a,"base64"))}async function n(e,t){let a=new TextEncoder,s=await crypto.subtle.importKey("raw",a.encode(e),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]);return new Uint8Array(await crypto.subtle.sign("HMAC",s,a.encode(t)))}function i(){return"admin_session"}async function l(e,t){let a=JSON.stringify(e),r=s(new TextEncoder().encode(a)),i=s(await n(t,r));return`${r}.${i}`}async function o(e,t){let a=e.split(".");if(2!==a.length)return null;let[s,i]=a,l=await n(t,s),o=r(i);if(o.length!==l.length)return null;let d=0;for(let e=0;e<o.length;e++)d|=o[e]^l[e];if(0!==d)return null;try{let e=new TextDecoder().decode(r(s)),t=JSON.parse(e);if("admin"!==t.sub||"number"!=typeof t.exp||Date.now()>1e3*t.exp)return null;return t}catch{return null}}a.d(t,{Dn:()=>i,Fi:()=>l,XD:()=>o})},39839:()=>{}};