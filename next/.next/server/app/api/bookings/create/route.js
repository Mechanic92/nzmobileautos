/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/bookings/create/route";
exports.ids = ["app/api/bookings/create/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "async_hooks":
/*!******************************!*\
  !*** external "async_hooks" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("async_hooks");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "dns":
/*!**********************!*\
  !*** external "dns" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("dns");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fbookings%2Fcreate%2Froute&page=%2Fapi%2Fbookings%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbookings%2Fcreate%2Froute.ts&appDir=C%3A%5Cnzmobileautos%5Cnext%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cnzmobileautos%5Cnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fbookings%2Fcreate%2Froute&page=%2Fapi%2Fbookings%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbookings%2Fcreate%2Froute.ts&appDir=C%3A%5Cnzmobileautos%5Cnext%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cnzmobileautos%5Cnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_nzmobileautos_next_src_app_api_bookings_create_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/bookings/create/route.ts */ \"(rsc)/./src/app/api/bookings/create/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/bookings/create/route\",\n        pathname: \"/api/bookings/create\",\n        filename: \"route\",\n        bundlePath: \"app/api/bookings/create/route\"\n    },\n    resolvedPagePath: \"C:\\\\nzmobileautos\\\\next\\\\src\\\\app\\\\api\\\\bookings\\\\create\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_nzmobileautos_next_src_app_api_bookings_create_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNS4xLjlfcmVhY3QtZG9tQDE5LjIuM19yZWFjdEAxOS4yLjNfX3JlYWN0QDE5LjIuMy9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZib29raW5ncyUyRmNyZWF0ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYm9va2luZ3MlMkZjcmVhdGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZib29raW5ncyUyRmNyZWF0ZSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDbnptb2JpbGVhdXRvcyU1Q25leHQlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNuem1vYmlsZWF1dG9zJTVDbmV4dCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDa0I7QUFDL0Y7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXG56bW9iaWxlYXV0b3NcXFxcbmV4dFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxib29raW5nc1xcXFxjcmVhdGVcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2Jvb2tpbmdzL2NyZWF0ZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2Jvb2tpbmdzL2NyZWF0ZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYm9va2luZ3MvY3JlYXRlL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcbnptb2JpbGVhdXRvc1xcXFxuZXh0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGJvb2tpbmdzXFxcXGNyZWF0ZVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fbookings%2Fcreate%2Froute&page=%2Fapi%2Fbookings%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbookings%2Fcreate%2Froute.ts&appDir=C%3A%5Cnzmobileautos%5Cnext%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cnzmobileautos%5Cnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/bookings/create/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/bookings/create/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js\");\n/* harmony import */ var _server_stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/stripe */ \"(rsc)/./src/server/stripe.ts\");\n/* harmony import */ var _server_pricing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/pricing */ \"(rsc)/./src/server/pricing.ts\");\n/* harmony import */ var _server_email__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/email */ \"(rsc)/./src/server/email.ts\");\n/* harmony import */ var _server_db__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/db */ \"(rsc)/./src/server/db.ts\");\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nconst ServiceType = zod__WEBPACK_IMPORTED_MODULE_5__[\"enum\"]([\n    \"DIAGNOSTICS\",\n    \"PPI\"\n]);\nconst BookingCreateSchema = zod__WEBPACK_IMPORTED_MODULE_5__.object({\n    serviceType: ServiceType,\n    scheduledStartLocal: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(1),\n    address: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(5),\n    vehiclePlate: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(2),\n    vehicleMake: zod__WEBPACK_IMPORTED_MODULE_5__.string().optional().nullable(),\n    vehicleModel: zod__WEBPACK_IMPORTED_MODULE_5__.string().optional().nullable(),\n    vehicleYear: zod__WEBPACK_IMPORTED_MODULE_5__.preprocess((v)=>v === \"\" || v === null || v === undefined ? null : v, zod__WEBPACK_IMPORTED_MODULE_5__.coerce.number().int().min(1900).max(2100)).optional().nullable(),\n    vehicleFuel: zod__WEBPACK_IMPORTED_MODULE_5__.string().optional().nullable(),\n    odometer: zod__WEBPACK_IMPORTED_MODULE_5__.string().optional().nullable(),\n    symptoms: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(3),\n    customerName: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(2),\n    customerEmail: zod__WEBPACK_IMPORTED_MODULE_5__.string().email(),\n    customerPhone: zod__WEBPACK_IMPORTED_MODULE_5__.string().min(6)\n});\nfunction getTimeZoneOffsetMs(dateUtc, timeZone) {\n    const dtf = new Intl.DateTimeFormat(\"en-NZ\", {\n        timeZone,\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n        hourCycle: \"h23\"\n    });\n    const parts = dtf.formatToParts(dateUtc);\n    const get = (type)=>parts.find((p)=>p.type === type)?.value;\n    const y = Number(get(\"year\"));\n    const mo = Number(get(\"month\"));\n    const d = Number(get(\"day\"));\n    const h = Number(get(\"hour\"));\n    const mi = Number(get(\"minute\"));\n    const s = Number(get(\"second\"));\n    const asIfUtc = Date.UTC(y, mo - 1, d, h, mi, s);\n    return asIfUtc - dateUtc.getTime();\n}\nfunction zonedTimeToUtcAuckland(scheduledStartLocal) {\n    const m = /^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})$/.exec(scheduledStartLocal);\n    if (!m) throw new Error(\"Invalid scheduledStartLocal format\");\n    const year = Number(m[1]);\n    const month = Number(m[2]);\n    const day = Number(m[3]);\n    const hour = Number(m[4]);\n    const minute = Number(m[5]);\n    // Start with a UTC date assuming the local components are UTC (we will correct with offset)\n    const utcGuess = new Date(Date.UTC(year, month - 1, day, hour, minute, 0));\n    const offsetMs = getTimeZoneOffsetMs(utcGuess, \"Pacific/Auckland\");\n    return new Date(utcGuess.getTime() - offsetMs);\n}\nfunction getAucklandLocalParts(dateUtc) {\n    const dtf = new Intl.DateTimeFormat(\"en-NZ\", {\n        timeZone: \"Pacific/Auckland\",\n        weekday: \"short\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hourCycle: \"h23\"\n    });\n    const parts = dtf.formatToParts(dateUtc);\n    const get = (type)=>parts.find((p)=>p.type === type)?.value;\n    const weekday = (get(\"weekday\") || \"\").toLowerCase();\n    const hour = Number(get(\"hour\"));\n    const minute = Number(get(\"minute\"));\n    return {\n        weekday,\n        hour,\n        minute\n    };\n}\nfunction assertWithinBusinessHours(slotStartUtc) {\n    const { weekday, hour, minute } = getAucklandLocalParts(slotStartUtc);\n    // Only allow Mon–Fri by default. Weekends are by request and must be handled manually/admin-side.\n    if (weekday === \"sat\" || weekday === \"sun\") {\n        throw new Error(\"Weekends are by request only. Please choose a weekday time or contact us.\");\n    }\n    // Business hours: 09:00–17:00 start times.\n    // We allow booking starts only when the full reserved duration (incl buffers) fits within business hours.\n    const minutes = hour * 60 + minute;\n    const open = 9 * 60;\n    const close = 17 * 60;\n    const reservedMinutes = Number(process.env.BOOKING_RESERVED_MINUTES || \"0\") || 0;\n    const totalMinutes = reservedMinutes > 0 ? reservedMinutes : 60 + 15 + 15;\n    const lastStart = close - totalMinutes;\n    if (minutes < open || minutes > lastStart) {\n        throw new Error(\"Bookings are available 9am–5pm Monday to Friday. Please select a time within business hours.\");\n    }\n}\nfunction getReservedMinutesForDiagnostics() {\n    const duration = Number(process.env.BOOKING_DIAGNOSTICS_DURATION_MINUTES || \"60\") || 60;\n    const travel = Number(process.env.BOOKING_TRAVEL_BUFFER_MINUTES || \"15\") || 15;\n    const admin = Number(process.env.BOOKING_ADMIN_BUFFER_MINUTES || \"15\") || 15;\n    return {\n        durationMinutes: duration,\n        travelMinutes: travel,\n        adminMinutes: admin,\n        totalMinutes: duration + travel + admin\n    };\n}\nasync function POST(req) {\n    try {\n        const json = await req.json();\n        const input = BookingCreateSchema.parse(json);\n        // Production preflight: fail fast with explicit error text (otherwise UI shows generic failure).\n        if (!process.env.DATABASE_URL) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Missing DATABASE_URL (database not configured on Vercel)\", {\n                status: 500\n            });\n        }\n        if (!process.env.STRIPE_SECRET_KEY) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Missing STRIPE_SECRET_KEY (Stripe not configured on Vercel)\", {\n                status: 500\n            });\n        }\n        if (!process.env.APP_URL) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Missing APP_URL (set to https://nzmobileauto.vercel.app)\", {\n                status: 500\n            });\n        }\n        // If DB is unhealthy, do NOT attempt Stripe/payment.\n        // Return a safe degraded-mode response that the UI can present without crashing.\n        try {\n            await (0,_server_db__WEBPACK_IMPORTED_MODULE_4__.assertDbHealthyOrThrow)();\n        } catch (err) {\n            if (err instanceof _server_db__WEBPACK_IMPORTED_MODULE_4__.DbUnavailableError) {\n                // eslint-disable-next-line no-console\n                console.error(\"/api/bookings/create degraded - db unavailable\", {\n                    message: err.message,\n                    db: await (0,_server_db__WEBPACK_IMPORTED_MODULE_4__.dbHealthCheck)()\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    ok: false,\n                    degraded: true,\n                    error: \"Booking system temporarily offline. Please call or text 027 642 1824 to book.\",\n                    fallback: {\n                        phone: \"+64276421824\",\n                        displayPhone: \"027 642 1824\"\n                    }\n                }, {\n                    status: 503\n                });\n            }\n            throw err;\n        }\n        if (input.serviceType !== \"DIAGNOSTICS\") {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Only DIAGNOSTICS booking is enabled in v1\", {\n                status: 400\n            });\n        }\n        // Client sends YYYY-MM-DDTHH:mm; treat it as Pacific/Auckland local wall time.\n        // Convert to a UTC Date deterministically (safe across DST changes).\n        const slotStart = zonedTimeToUtcAuckland(input.scheduledStartLocal);\n        // Diagnostics booking reserves service duration + travel buffer + admin buffer.\n        // This ensures your calendar cannot be overbooked and stays realistic for mobile work.\n        const reserved = getReservedMinutesForDiagnostics();\n        const slotEnd = new Date(slotStart.getTime() + reserved.totalMinutes * 60 * 1000);\n        // Enforce business hours & weekdays in NZ local time.\n        assertWithinBusinessHours(slotStart);\n        // Hard-block overlaps against existing CONFIRMED bookings and unexpired PENDING_PAYMENT bookings.\n        // Overlap condition: existing.slotStart < requestedEnd AND existing.slotEnd > requestedStart\n        // Use the prisma-backed adapter via db() so DB errors can be handled consistently.\n        try {\n            const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n            const conflict = await prisma.booking.findFirst({\n                where: {\n                    OR: [\n                        {\n                            status: \"CONFIRMED\"\n                        },\n                        {\n                            status: \"PENDING_PAYMENT\",\n                            paymentExpiresAt: {\n                                gt: new Date()\n                            }\n                        }\n                    ],\n                    slotStart: {\n                        lt: slotEnd\n                    },\n                    slotEnd: {\n                        gt: slotStart\n                    }\n                },\n                select: {\n                    id: true,\n                    publicId: true,\n                    slotStart: true,\n                    slotEnd: true\n                }\n            });\n            if (conflict) {\n                return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"That time is already booked. Please choose a different time.\", {\n                    status: 409\n                });\n            }\n        } catch (err) {\n            const msg = String(err?.message || \"\");\n            if (msg.toLowerCase().includes(\"can't reach database server\") || String(err?.code || \"\") === \"P1001\") {\n                // eslint-disable-next-line no-console\n                console.error(\"/api/bookings/create degraded - conflict check db error\", err);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    ok: false,\n                    degraded: true,\n                    error: \"Booking system temporarily offline. Please call or text 027 642 1824 to book.\",\n                    fallback: {\n                        phone: \"+64276421824\",\n                        displayPhone: \"027 642 1824\"\n                    }\n                }, {\n                    status: 503\n                });\n            }\n            throw err;\n        }\n        const pricing = (0,_server_pricing__WEBPACK_IMPORTED_MODULE_2__.computePricing)({\n            serviceType: input.serviceType,\n            scheduledStartLocal: input.scheduledStartLocal\n        });\n        const paymentExpiresAt = new Date(Date.now() + pricing.paymentExpiryMinutes * 60000);\n        // Minimal address parsing (Phase 1). Expect: \"street, suburb, city\".\n        const parts = input.address.split(\",\").map((p)=>p.trim()).filter(Boolean);\n        const line1 = parts[0] || input.address;\n        const suburb = parts[1] || \"West Auckland\";\n        const city = parts[2] || \"Auckland\";\n        const booking = await (0,_server_db__WEBPACK_IMPORTED_MODULE_4__.db)().createDiagnosticsBooking({\n            customer: {\n                fullName: input.customerName,\n                email: input.customerEmail,\n                phone: input.customerPhone\n            },\n            address: {\n                line1,\n                suburb,\n                city,\n                postcode: null,\n                lat: null,\n                lng: null,\n                travelBand: null\n            },\n            vehicle: {\n                plate: input.vehiclePlate.toUpperCase().replace(/[^A-Z0-9]/g, \"\"),\n                make: input.vehicleMake || null,\n                model: input.vehicleModel || null,\n                year: input.vehicleYear ?? null,\n                fuel: input.vehicleFuel || null,\n                odometer: input.odometer || null\n            },\n            slotStart,\n            slotEnd,\n            afterHours: Boolean(pricing.pricingJson?.afterHours),\n            symptomPreset: null,\n            notes: input.symptoms,\n            pricingSnapshotJson: pricing.pricingJson,\n            paymentExpiresAt\n        });\n        const session = await (0,_server_stripe__WEBPACK_IMPORTED_MODULE_1__.createCheckoutSessionForBooking)({\n            booking,\n            customerEmail: input.customerEmail\n        });\n        if (!session?.url) {\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(\"Payment session could not be created. Please try again or contact support.\", {\n                status: 500\n            });\n        }\n        await (0,_server_db__WEBPACK_IMPORTED_MODULE_4__.db)().updateBookingStripeSession({\n            id: booking.id\n        }, {\n            stripeSessionId: session.id\n        });\n        await (0,_server_email__WEBPACK_IMPORTED_MODULE_3__.sendBookingCreatedPaymentRequiredEmail)({\n            bookingId: booking.id,\n            toEmail: input.customerEmail,\n            checkoutUrl: session.url\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            checkoutUrl: session.url\n        });\n    } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error(\"/api/bookings/create failed\", err);\n        // Zod validation\n        const zodIssues = err?.issues;\n        if (Array.isArray(zodIssues) && zodIssues.length > 0) {\n            const msg = zodIssues.map((i)=>`${i.path?.join(\".\") || \"field\"}: ${i.message}`).join(\", \");\n            return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(`Invalid request: ${msg}`, {\n                status: 400\n            });\n        }\n        const message = typeof err?.message === \"string\" && err.message.trim() ? err.message.trim() : \"Unknown server error\";\n        return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(message, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9ib29raW5ncy9jcmVhdGUvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBMkM7QUFDbkI7QUFDMEM7QUFDaEI7QUFDc0I7QUFDb0I7QUFFckYsTUFBTVMsVUFBVSxTQUFTO0FBRWhDLE1BQU1DLGNBQWNULHdDQUFNLENBQUM7SUFBQztJQUFlO0NBQU07QUFFakQsTUFBTVcsc0JBQXNCWCx1Q0FBUSxDQUFDO0lBQ25DYSxhQUFhSjtJQUNiSyxxQkFBcUJkLHVDQUFRLEdBQUdnQixHQUFHLENBQUM7SUFDcENDLFNBQVNqQix1Q0FBUSxHQUFHZ0IsR0FBRyxDQUFDO0lBQ3hCRSxjQUFjbEIsdUNBQVEsR0FBR2dCLEdBQUcsQ0FBQztJQUM3QkcsYUFBYW5CLHVDQUFRLEdBQUdvQixRQUFRLEdBQUdDLFFBQVE7SUFDM0NDLGNBQWN0Qix1Q0FBUSxHQUFHb0IsUUFBUSxHQUFHQyxRQUFRO0lBQzVDRSxhQUFhdkIsMkNBQVksQ0FDdkIsQ0FBQ3lCLElBQU9BLE1BQU0sTUFBTUEsTUFBTSxRQUFRQSxNQUFNQyxZQUFZLE9BQU9ELEdBQzNEekIsdUNBQVEsQ0FBQzRCLE1BQU0sR0FBR0MsR0FBRyxHQUFHYixHQUFHLENBQUMsTUFBTWMsR0FBRyxDQUFDLE9BQ3RDVixRQUFRLEdBQUdDLFFBQVE7SUFDckJVLGFBQWEvQix1Q0FBUSxHQUFHb0IsUUFBUSxHQUFHQyxRQUFRO0lBQzNDVyxVQUFVaEMsdUNBQVEsR0FBR29CLFFBQVEsR0FBR0MsUUFBUTtJQUN4Q1ksVUFBVWpDLHVDQUFRLEdBQUdnQixHQUFHLENBQUM7SUFDekJrQixjQUFjbEMsdUNBQVEsR0FBR2dCLEdBQUcsQ0FBQztJQUM3Qm1CLGVBQWVuQyx1Q0FBUSxHQUFHb0MsS0FBSztJQUMvQkMsZUFBZXJDLHVDQUFRLEdBQUdnQixHQUFHLENBQUM7QUFDaEM7QUFFQSxTQUFTc0Isb0JBQW9CQyxPQUFhLEVBQUVDLFFBQWdCO0lBQzFELE1BQU1DLE1BQU0sSUFBSUMs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QXNDQSxDQUFDO1lBQzNDdUssV0FBV2hELFFBQVFRLEVBQUU7WUFDckJ5QyxTQUFTckUsTUFBTW5FLGFBQWE7WUFDNUJ5SSxhQUFhTixRQUFRQyxHQUFHO1FBQzFCO1FBRUEsT0FBT3hLLHFEQUFZQSxDQUFDc0csSUFBSSxDQUFDO1lBQUV1RSxhQUFhTixRQUFRQyxHQUFHO1FBQUM7SUFDdEQsRUFBRSxPQUFPM0QsS0FBVTtRQUNqQixzQ0FBc0M7UUFDdENDLFFBQVFDLEtBQUssQ0FBQywrQkFBK0JGO1FBRTdDLGlCQUFpQjtRQUNqQixNQUFNaUUsWUFBWWpFLEtBQUtrRTtRQUN2QixJQUFJQyxNQUFNQyxPQUFPLENBQUNILGNBQWNBLFVBQVVJLE1BQU0sR0FBRyxHQUFHO1lBQ3BELE1BQU03QyxNQUFNeUMsVUFBVWpDLEdBQUcsQ0FBQyxDQUFDc0MsSUFBVyxHQUFHQSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssUUFBUSxRQUFRLEVBQUUsRUFBRUYsRUFBRW5FLE9BQU8sRUFBRSxFQUFFcUUsSUFBSSxDQUFDO1lBQzVGLE9BQU8sSUFBSXJMLHFEQUFZQSxDQUFDLENBQUMsaUJBQWlCLEVBQUVxSSxLQUFLLEVBQUU7Z0JBQUUzQixRQUFRO1lBQUk7UUFDbkU7UUFFQSxNQUFNTSxVQUFVLE9BQU9ILEtBQUtHLFlBQVksWUFBWUgsSUFBSUcsT0FBTyxDQUFDOEIsSUFBSSxLQUFLakMsSUFBSUcsT0FBTyxDQUFDOEIsSUFBSSxLQUFLO1FBQzlGLE9BQU8sSUFBSTlJLHFEQUFZQSxDQUFDZ0gsU0FBUztZQUFFTixRQUFRO1FBQUk7SUFDakQ7QUFDRiIsInNvdXJjZXMiOlsiQzpcXG56bW9iaWxlYXV0b3NcXG5leHRcXHNyY1xcYXBwXFxhcGlcXGJvb2tpbmdzXFxjcmVhdGVcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IGNyZWF0ZUNoZWNrb3V0U2Vzc2lvbkZvckJvb2tpbmcgfSBmcm9tIFwiQC9zZXJ2ZXIvc3RyaXBlXCI7XG5pbXBvcnQgeyBjb21wdXRlUHJpY2luZyB9IGZyb20gXCJAL3NlcnZlci9wcmljaW5nXCI7XG5pbXBvcnQgeyBzZW5kQm9va2luZ0NyZWF0ZWRQYXltZW50UmVxdWlyZWRFbWFpbCB9IGZyb20gXCJAL3NlcnZlci9lbWFpbFwiO1xuaW1wb3J0IHsgYXNzZXJ0RGJIZWFsdGh5T3JUaHJvdywgRGJVbmF2YWlsYWJsZUVycm9yLCBkYiwgZGJIZWFsdGhDaGVjayB9IGZyb20gXCJAL3NlcnZlci9kYlwiO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7XG5cbmNvbnN0IFNlcnZpY2VUeXBlID0gei5lbnVtKFtcIkRJQUdOT1NUSUNTXCIsIFwiUFBJXCJdKTtcblxuY29uc3QgQm9va2luZ0NyZWF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgc2VydmljZVR5cGU6IFNlcnZpY2VUeXBlLFxuICBzY2hlZHVsZWRTdGFydExvY2FsOiB6LnN0cmluZygpLm1pbigxKSxcbiAgYWRkcmVzczogei5zdHJpbmcoKS5taW4oNSksXG4gIHZlaGljbGVQbGF0ZTogei5zdHJpbmcoKS5taW4oMiksXG4gIHZlaGljbGVNYWtlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgdmVoaWNsZU1vZGVsOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgdmVoaWNsZVllYXI6IHoucHJlcHJvY2VzcyhcbiAgICAodikgPT4gKHYgPT09IFwiXCIgfHwgdiA9PT0gbnVsbCB8fCB2ID09PSB1bmRlZmluZWQgPyBudWxsIDogdiksXG4gICAgei5jb2VyY2UubnVtYmVyKCkuaW50KCkubWluKDE5MDApLm1heCgyMTAwKVxuICApLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgdmVoaWNsZUZ1ZWw6IHouc3RyaW5nKCkub3B0aW9uYWwoKS5udWxsYWJsZSgpLFxuICBvZG9tZXRlcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gIHN5bXB0b21zOiB6LnN0cmluZygpLm1pbigzKSxcbiAgY3VzdG9tZXJOYW1lOiB6LnN0cmluZygpLm1pbigyKSxcbiAgY3VzdG9tZXJFbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICBjdXN0b21lclBob25lOiB6LnN0cmluZygpLm1pbig2KSxcbn0pO1xuXG5mdW5jdGlvbiBnZXRUaW1lWm9uZU9mZnNldE1zKGRhdGVVdGM6IERhdGUsIHRpbWVab25lOiBzdHJpbmcpIHtcbiAgY29uc3QgZHRmID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoXCJlbi1OWlwiLCB7XG4gICAgdGltZVpvbmUsXG4gICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgbW9udGg6IFwiMi1kaWdpdFwiLFxuICAgIGRheTogXCIyLWRpZ2l0XCIsXG4gICAgaG91cjogXCIyLWRpZ2l0XCIsXG4gICAgbWludXRlOiBcIjItZGlnaXRcIixcbiAgICBzZWNvbmQ6IFwiMi1kaWdpdFwiLFxuICAgIGhvdXJDeWNsZTogXCJoMjNcIixcbiAgfSk7XG4gIGNvbnN0IHBhcnRzID0gZHRmLmZvcm1hdFRvUGFydHMoZGF0ZVV0Yyk7XG4gIGNvbnN0IGdldCA9ICh0eXBlOiBzdHJpbmcpID0+IHBhcnRzLmZpbmQoKHApID0+IHAudHlwZSA9PT0gdHlwZSk/LnZhbHVlO1xuXG4gIGNvbnN0IHkgPSBOdW1iZXIoZ2V0KFwieWVhclwiKSk7XG4gIGNvbnN0IG1vID0gTnVtYmVyKGdldChcIm1vbnRoXCIpKTtcbiAgY29uc3QgZCA9IE51bWJlcihnZXQoXCJkYXlcIikpO1xuICBjb25zdCBoID0gTnVtYmVyKGdldChcImhvdXJcIikpO1xuICBjb25zdCBtaSA9IE51bWJlcihnZXQoXCJtaW51dGVcIikpO1xuICBjb25zdCBzID0gTnVtYmVyKGdldChcInNlY29uZFwiKSk7XG5cbiAgY29uc3QgYXNJZlV0YyA9IERhdGUuVVRDKHksIG1vIC0gMSwgZCwgaCwgbWksIHMpO1xuICByZXR1cm4gYXNJZlV0YyAtIGRhdGVVdGMuZ2V0VGltZSgpO1xufVxuXG5mdW5jdGlvbiB6b25lZFRpbWVUb1V0Y0F1Y2tsYW5kKHNjaGVkdWxlZFN0YXJ0TG9jYWw6IHN0cmluZykge1xuICBjb25zdCBtID0gL14oWzAtOV17NH0pLShbMC05XXsyfSktKFswLTldezJ9KVQoWzAtOV17Mn0pOihbMC05XXsyfSkkLy5leGVjKHNjaGVkdWxlZFN0YXJ0TG9jYWwpO1xuICBpZiAoIW0pIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc2NoZWR1bGVkU3RhcnRMb2NhbCBmb3JtYXRcIik7XG5cbiAgY29uc3QgeWVhciA9IE51bWJlcihtWzFdKTtcbiAgY29uc3QgbW9udGggPSBOdW1iZXIobVsyXSk7XG4gIGNvbnN0IGRheSA9IE51bWJlcihtWzNdKTtcbiAgY29uc3QgaG91ciA9IE51bWJlcihtWzRdKTtcbiAgY29uc3QgbWludXRlID0gTnVtYmVyKG1bNV0pO1xuXG4gIC8vIFN0YXJ0IHdpdGggYSBVVEMgZGF0ZSBhc3N1bWluZyB0aGUgbG9jYWwgY29tcG9uZW50cyBhcmUgVVRDICh3ZSB3aWxsIGNvcnJlY3Qgd2l0aCBvZmZzZXQpXG4gIGNvbnN0IHV0Y0d1ZXNzID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGggLSAxLCBkYXksIGhvdXIsIG1pbnV0ZSwgMCkpO1xuICBjb25zdCBvZmZzZXRNcyA9IGdldFRpbWVab25lT2Zmc2V0TXModXRjR3Vlc3MsIFwiUGFjaWZpYy9BdWNrbGFuZFwiKTtcbiAgcmV0dXJuIG5ldyBEYXRlKHV0Y0d1ZXNzLmdldFRpbWUoKSAtIG9mZnNldE1zKTtcbn1cblxuZnVuY3Rpb24gZ2V0QXVja2xhbmRMb2NhbFBhcnRzKGRhdGVVdGM6IERhdGUpIHtcbiAgY29uc3QgZHRmID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoXCJlbi1OWlwiLCB7XG4gICAgdGltZVpvbmU6IFwiUGFjaWZpYy9BdWNrbGFuZFwiLFxuICAgIHdlZWtkYXk6IFwic2hvcnRcIixcbiAgICBob3VyOiBcIjItZGlnaXRcIixcbiAgICBtaW51dGU6IFwiMi1kaWdpdFwiLFxuICAgIGhvdXJDeWNsZTogXCJoMjNcIixcbiAgfSk7XG4gIGNvbnN0IHBhcnRzID0gZHRmLmZvcm1hdFRvUGFydHMoZGF0ZVV0Yyk7XG4gIGNvbnN0IGdldCA9ICh0eXBlOiBzdHJpbmcpID0+IHBhcnRzLmZpbmQoKHApID0+IHAudHlwZSA9PT0gdHlwZSk/LnZhbHVlO1xuICBjb25zdCB3ZWVrZGF5ID0gKGdldChcIndlZWtkYXlcIikgfHwgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgaG91ciA9IE51bWJlcihnZXQoXCJob3VyXCIpKTtcbiAgY29uc3QgbWludXRlID0gTnVtYmVyKGdldChcIm1pbnV0ZVwiKSk7XG4gIHJldHVybiB7IHdlZWtkYXksIGhvdXIsIG1pbnV0ZSB9O1xufVxuXG5mdW5jdGlvbiBhc3NlcnRXaXRoaW5CdXNpbmVzc0hvdXJzKHNsb3RTdGFydFV0YzogRGF0ZSkge1xuICBjb25zdCB7IHdlZWtkYXksIGhvdXIsIG1pbnV0ZSB9ID0gZ2V0QXVja2xhbmRMb2NhbFBhcnRzKHNsb3RTdGFydFV0Yyk7XG5cbiAgLy8gT25seSBhbGxvdyBNb27igJNGcmkgYnkgZGVmYXVsdC4gV2Vla2VuZHMgYXJlIGJ5IHJlcXVlc3QgYW5kIG11c3QgYmUgaGFuZGxlZCBtYW51YWxseS9hZG1pbi1zaWRlLlxuICBpZiAod2Vla2RheSA9PT0gXCJzYXRcIiB8fCB3ZWVrZGF5ID09PSBcInN1blwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiV2Vla2VuZHMgYXJlIGJ5IHJlcXVlc3Qgb25seS4gUGxlYXNlIGNob29zZSBhIHdlZWtkYXkgdGltZSBvciBjb250YWN0IHVzLlwiKTtcbiAgfVxuXG4gIC8vIEJ1c2luZXNzIGhvdXJzOiAwOTowMOKAkzE3OjAwIHN0YXJ0IHRpbWVzLlxuICAvLyBXZSBhbGxvdyBib29raW5nIHN0YXJ0cyBvbmx5IHdoZW4gdGhlIGZ1bGwgcmVzZXJ2ZWQgZHVyYXRpb24gKGluY2wgYnVmZmVycykgZml0cyB3aXRoaW4gYnVzaW5lc3MgaG91cnMuXG4gIGNvbnN0IG1pbnV0ZXMgPSBob3VyICogNjAgKyBtaW51dGU7XG4gIGNvbnN0IG9wZW4gPSA5ICogNjA7XG4gIGNvbnN0IGNsb3NlID0gMTcgKiA2MDtcblxuICBjb25zdCByZXNlcnZlZE1pbnV0ZXMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuQk9PS0lOR19SRVNFUlZFRF9NSU5VVEVTIHx8IFwiMFwiKSB8fCAwO1xuICBjb25zdCB0b3RhbE1pbnV0ZXMgPSByZXNlcnZlZE1pbnV0ZXMgPiAwID8gcmVzZXJ2ZWRNaW51dGVzIDogNjAgKyAxNSArIDE1O1xuXG4gIGNvbnN0IGxhc3RTdGFydCA9IGNsb3NlIC0gdG90YWxNaW51dGVzO1xuICBpZiAobWludXRlcyA8IG9wZW4gfHwgbWludXRlcyA+IGxhc3RTdGFydCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiQm9va2luZ3MgYXJlIGF2YWlsYWJsZSA5YW3igJM1cG0gTW9uZGF5IHRvIEZyaWRheS4gUGxlYXNlIHNlbGVjdCBhIHRpbWUgd2l0aGluIGJ1c2luZXNzIGhvdXJzLlwiXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRSZXNlcnZlZE1pbnV0ZXNGb3JEaWFnbm9zdGljcygpIHtcbiAgY29uc3QgZHVyYXRpb24gPSBOdW1iZXIocHJvY2Vzcy5lbnYuQk9PS0lOR19ESUFHTk9TVElDU19EVVJBVElPTl9NSU5VVEVTIHx8IFwiNjBcIikgfHwgNjA7XG4gIGNvbnN0IHRyYXZlbCA9IE51bWJlcihwcm9jZXNzLmVudi5CT09LSU5HX1RSQVZFTF9CVUZGRVJfTUlOVVRFUyB8fCBcIjE1XCIpIHx8IDE1O1xuICBjb25zdCBhZG1pbiA9IE51bWJlcihwcm9jZXNzLmVudi5CT09LSU5HX0FETUlOX0JVRkZFUl9NSU5VVEVTIHx8IFwiMTVcIikgfHwgMTU7XG4gIHJldHVybiB7XG4gICAgZHVyYXRpb25NaW51dGVzOiBkdXJhdGlvbixcbiAgICB0cmF2ZWxNaW51dGVzOiB0cmF2ZWwsXG4gICAgYWRtaW5NaW51dGVzOiBhZG1pbixcbiAgICB0b3RhbE1pbnV0ZXM6IGR1cmF0aW9uICsgdHJhdmVsICsgYWRtaW4sXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXEuanNvbigpO1xuICAgIGNvbnN0IGlucHV0ID0gQm9va2luZ0NyZWF0ZVNjaGVtYS5wYXJzZShqc29uKTtcblxuICAgIC8vIFByb2R1Y3Rpb24gcHJlZmxpZ2h0OiBmYWlsIGZhc3Qgd2l0aCBleHBsaWNpdCBlcnJvciB0ZXh0IChvdGhlcndpc2UgVUkgc2hvd3MgZ2VuZXJpYyBmYWlsdXJlKS5cbiAgICBpZiAoIXByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCkge1xuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXCJNaXNzaW5nIERBVEFCQVNFX1VSTCAoZGF0YWJhc2Ugbm90IGNvbmZpZ3VyZWQgb24gVmVyY2VsKVwiLCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cbiAgICBpZiAoIXByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZKSB7XG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcIk1pc3NpbmcgU1RSSVBFX1NFQ1JFVF9LRVkgKFN0cmlwZSBub3QgY29uZmlndXJlZCBvbiBWZXJjZWwpXCIsIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuICAgIGlmICghcHJvY2Vzcy5lbnYuQVBQX1VSTCkge1xuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXCJNaXNzaW5nIEFQUF9VUkwgKHNldCB0byBodHRwczovL256bW9iaWxlYXV0by52ZXJjZWwuYXBwKVwiLCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIC8vIElmIERCIGlzIHVuaGVhbHRoeSwgZG8gTk9UIGF0dGVtcHQgU3RyaXBlL3BheW1lbnQuXG4gICAgLy8gUmV0dXJuIGEgc2FmZSBkZWdyYWRlZC1tb2RlIHJlc3BvbnNlIHRoYXQgdGhlIFVJIGNhbiBwcmVzZW50IHdpdGhvdXQgY3Jhc2hpbmcuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFzc2VydERiSGVhbHRoeU9yVGhyb3coKTtcbiAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIERiVW5hdmFpbGFibGVFcnJvcikge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICBjb25zb2xlLmVycm9yKFwiL2FwaS9ib29raW5ncy9jcmVhdGUgZGVncmFkZWQgLSBkYiB1bmF2YWlsYWJsZVwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXG4gICAgICAgICAgZGI6IGF3YWl0IGRiSGVhbHRoQ2hlY2soKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBvazogZmFsc2UsXG4gICAgICAgICAgICBkZWdyYWRlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVycm9yOlxuICAgICAgICAgICAgICBcIkJvb2tpbmcgc3lzdGVtIHRlbXBvcmFyaWx5IG9mZmxpbmUuIFBsZWFzZSBjYWxsIG9yIHRleHQgMDI3IDY0MiAxODI0IHRvIGJvb2suXCIsXG4gICAgICAgICAgICBmYWxsYmFjazoge1xuICAgICAgICAgICAgICBwaG9uZTogXCIrNjQyNzY0MjE4MjRcIixcbiAgICAgICAgICAgICAgZGlzcGxheVBob25lOiBcIjAyNyA2NDIgMTgyNFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA1MDMgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIGlmIChpbnB1dC5zZXJ2aWNlVHlwZSAhPT0gXCJESUFHTk9TVElDU1wiKSB7XG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcIk9ubHkgRElBR05PU1RJQ1MgYm9va2luZyBpcyBlbmFibGVkIGluIHYxXCIsIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2xpZW50IHNlbmRzIFlZWVktTU0tRERUSEg6bW07IHRyZWF0IGl0IGFzIFBhY2lmaWMvQXVja2xhbmQgbG9jYWwgd2FsbCB0aW1lLlxuICAgIC8vIENvbnZlcnQgdG8gYSBVVEMgRGF0ZSBkZXRlcm1pbmlzdGljYWxseSAoc2FmZSBhY3Jvc3MgRFNUIGNoYW5nZXMpLlxuICAgIGNvbnN0IHNsb3RTdGFydCA9IHpvbmVkVGltZVRvVXRjQXVja2xhbmQoaW5wdXQuc2NoZWR1bGVkU3RhcnRMb2NhbCk7XG5cbiAgICAvLyBEaWFnbm9zdGljcyBib29raW5nIHJlc2VydmVzIHNlcnZpY2UgZHVyYXRpb24gKyB0cmF2ZWwgYnVmZmVyICsgYWRtaW4gYnVmZmVyLlxuICAgIC8vIFRoaXMgZW5zdXJlcyB5b3VyIGNhbGVuZGFyIGNhbm5vdCBiZSBvdmVyYm9va2VkIGFuZCBzdGF5cyByZWFsaXN0aWMgZm9yIG1vYmlsZSB3b3JrLlxuICAgIGNvbnN0IHJlc2VydmVkID0gZ2V0UmVzZXJ2ZWRNaW51dGVzRm9yRGlhZ25vc3RpY3MoKTtcbiAgICBjb25zdCBzbG90RW5kID0gbmV3IERhdGUoc2xvdFN0YXJ0LmdldFRpbWUoKSArIHJlc2VydmVkLnRvdGFsTWludXRlcyAqIDYwICogMTAwMCk7XG5cbiAgICAvLyBFbmZvcmNlIGJ1c2luZXNzIGhvdXJzICYgd2Vla2RheXMgaW4gTlogbG9jYWwgdGltZS5cbiAgICBhc3NlcnRXaXRoaW5CdXNpbmVzc0hvdXJzKHNsb3RTdGFydCk7XG5cbiAgICAvLyBIYXJkLWJsb2NrIG92ZXJsYXBzIGFnYWluc3QgZXhpc3RpbmcgQ09ORklSTUVEIGJvb2tpbmdzIGFuZCB1bmV4cGlyZWQgUEVORElOR19QQVlNRU5UIGJvb2tpbmdzLlxuICAgIC8vIE92ZXJsYXAgY29uZGl0aW9uOiBleGlzdGluZy5zbG90U3RhcnQgPCByZXF1ZXN0ZWRFbmQgQU5EIGV4aXN0aW5nLnNsb3RFbmQgPiByZXF1ZXN0ZWRTdGFydFxuICAgIC8vIFVzZSB0aGUgcHJpc21hLWJhY2tlZCBhZGFwdGVyIHZpYSBkYigpIHNvIERCIGVycm9ycyBjYW4gYmUgaGFuZGxlZCBjb25zaXN0ZW50bHkuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgcHJpc21hIH0gPSBhd2FpdCBpbXBvcnQoXCJAL3NlcnZlci9wcmlzbWFcIik7XG4gICAgICBjb25zdCBjb25mbGljdCA9IGF3YWl0IHByaXNtYS5ib29raW5nLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgIHsgc3RhdHVzOiBcIkNPTkZJUk1FRFwiIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHN0YXR1czogXCJQRU5ESU5HX1BBWU1FTlRcIixcbiAgICAgICAgICAgICAgcGF5bWVudEV4cGlyZXNBdDogeyBndDogbmV3IERhdGUoKSB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNsb3RTdGFydDogeyBsdDogc2xvdEVuZCB9LFxuICAgICAgICAgIHNsb3RFbmQ6IHsgZ3Q6IHNsb3RTdGFydCB9LFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHB1YmxpY0lkOiB0cnVlLCBzbG90U3RhcnQ6IHRydWUsIHNsb3RFbmQ6IHRydWUgfSxcbiAgICAgIH0pO1xuICAgICAgaWYgKGNvbmZsaWN0KSB7XG4gICAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKFwiVGhhdCB0aW1lIGlzIGFscmVhZHkgYm9va2VkLiBQbGVhc2UgY2hvb3NlIGEgZGlmZmVyZW50IHRpbWUuXCIsIHsgc3RhdHVzOiA0MDkgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgIGNvbnN0IG1zZyA9IFN0cmluZyhlcnI/Lm1lc3NhZ2UgfHwgXCJcIik7XG4gICAgICBpZiAobXNnLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJjYW4ndCByZWFjaCBkYXRhYmFzZSBzZXJ2ZXJcIikgfHwgU3RyaW5nKGVycj8uY29kZSB8fCBcIlwiKSA9PT0gXCJQMTAwMVwiKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCIvYXBpL2Jvb2tpbmdzL2NyZWF0ZSBkZWdyYWRlZCAtIGNvbmZsaWN0IGNoZWNrIGRiIGVycm9yXCIsIGVycik7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBvazogZmFsc2UsXG4gICAgICAgICAgICBkZWdyYWRlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVycm9yOlxuICAgICAgICAgICAgICBcIkJvb2tpbmcgc3lzdGVtIHRlbXBvcmFyaWx5IG9mZmxpbmUuIFBsZWFzZSBjYWxsIG9yIHRleHQgMDI3IDY0MiAxODI0IHRvIGJvb2suXCIsXG4gICAgICAgICAgICBmYWxsYmFjazoge1xuICAgICAgICAgICAgICBwaG9uZTogXCIrNjQyNzY0MjE4MjRcIixcbiAgICAgICAgICAgICAgZGlzcGxheVBob25lOiBcIjAyNyA2NDIgMTgyNFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA1MDMgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIGNvbnN0IHByaWNpbmcgPSBjb21wdXRlUHJpY2luZyh7XG4gICAgICBzZXJ2aWNlVHlwZTogaW5wdXQuc2VydmljZVR5cGUsXG4gICAgICBzY2hlZHVsZWRTdGFydExvY2FsOiBpbnB1dC5zY2hlZHVsZWRTdGFydExvY2FsLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcGF5bWVudEV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyBwcmljaW5nLnBheW1lbnRFeHBpcnlNaW51dGVzICogNjBfMDAwKTtcblxuICAgIC8vIE1pbmltYWwgYWRkcmVzcyBwYXJzaW5nIChQaGFzZSAxKS4gRXhwZWN0OiBcInN0cmVldCwgc3VidXJiLCBjaXR5XCIuXG4gICAgY29uc3QgcGFydHMgPSBpbnB1dC5hZGRyZXNzLnNwbGl0KFwiLFwiKS5tYXAoKHApID0+IHAudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7XG4gICAgY29uc3QgbGluZTEgPSBwYXJ0c1swXSB8fCBpbnB1dC5hZGRyZXNzO1xuICAgIGNvbnN0IHN1YnVyYiA9IHBhcnRzWzFdIHx8IFwiV2VzdCBBdWNrbGFuZFwiO1xuICAgIGNvbnN0IGNpdHkgPSBwYXJ0c1syXSB8fCBcIkF1Y2tsYW5kXCI7XG5cbiAgICBjb25zdCBib29raW5nID0gYXdhaXQgZGIoKS5jcmVhdGVEaWFnbm9zdGljc0Jvb2tpbmcoe1xuICAgICAgY3VzdG9tZXI6IHtcbiAgICAgICAgZnVsbE5hbWU6IGlucHV0LmN1c3RvbWVyTmFtZSxcbiAgICAgICAgZW1haWw6IGlucHV0LmN1c3RvbWVyRW1haWwsXG4gICAgICAgIHBob25lOiBpbnB1dC5jdXN0b21lclBob25lLFxuICAgICAgfSxcbiAgICAgIGFkZHJlc3M6IHtcbiAgICAgICAgbGluZTEsXG4gICAgICAgIHN1YnVyYixcbiAgICAgICAgY2l0eSxcbiAgICAgICAgcG9zdGNvZGU6IG51bGwsXG4gICAgICAgIGxhdDogbnVsbCxcbiAgICAgICAgbG5nOiBudWxsLFxuICAgICAgICB0cmF2ZWxCYW5kOiBudWxsLFxuICAgICAgfSxcbiAgICAgIHZlaGljbGU6IHtcbiAgICAgICAgcGxhdGU6IGlucHV0LnZlaGljbGVQbGF0ZS50b1VwcGVyQ2FzZSgpLnJlcGxhY2UoL1teQS1aMC05XS9nLCBcIlwiKSxcbiAgICAgICAgbWFrZTogaW5wdXQudmVoaWNsZU1ha2UgfHwgbnVsbCxcbiAgICAgICAgbW9kZWw6IGlucHV0LnZlaGljbGVNb2RlbCB8fCBudWxsLFxuICAgICAgICB5ZWFyOiBpbnB1dC52ZWhpY2xlWWVhciA/PyBudWxsLFxuICAgICAgICBmdWVsOiBpbnB1dC52ZWhpY2xlRnVlbCB8fCBudWxsLFxuICAgICAgICBvZG9tZXRlcjogaW5wdXQub2RvbWV0ZXIgfHwgbnVsbCxcbiAgICAgIH0sXG4gICAgICBzbG90U3RhcnQsXG4gICAgICBzbG90RW5kLFxuICAgICAgYWZ0ZXJIb3VyczogQm9vbGVhbihwcmljaW5nLnByaWNpbmdKc29uPy5hZnRlckhvdXJzKSxcbiAgICAgIHN5bXB0b21QcmVzZXQ6IG51bGwsXG4gICAgICBub3RlczogaW5wdXQuc3ltcHRvbXMsXG4gICAgICBwcmljaW5nU25hcHNob3RKc29uOiBwcmljaW5nLnByaWNpbmdKc29uLFxuICAgICAgcGF5bWVudEV4cGlyZXNBdCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBjcmVhdGVDaGVja291dFNlc3Npb25Gb3JCb29raW5nKHsgYm9va2luZywgY3VzdG9tZXJFbWFpbDogaW5wdXQuY3VzdG9tZXJFbWFpbCB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXJsKSB7XG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcbiAgICAgICAgXCJQYXltZW50IHNlc3Npb24gY291bGQgbm90IGJlIGNyZWF0ZWQuIFBsZWFzZSB0cnkgYWdhaW4gb3IgY29udGFjdCBzdXBwb3J0LlwiLFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgYXdhaXQgZGIoKS51cGRhdGVCb29raW5nU3RyaXBlU2Vzc2lvbih7IGlkOiBib29raW5nLmlkIH0sIHsgc3RyaXBlU2Vzc2lvbklkOiBzZXNzaW9uLmlkIH0pO1xuXG4gICAgYXdhaXQgc2VuZEJvb2tpbmdDcmVhdGVkUGF5bWVudFJlcXVpcmVkRW1haWwoe1xuICAgICAgYm9va2luZ0lkOiBib29raW5nLmlkLFxuICAgICAgdG9FbWFpbDogaW5wdXQuY3VzdG9tZXJFbWFpbCxcbiAgICAgIGNoZWNrb3V0VXJsOiBzZXNzaW9uLnVybCEsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBjaGVja291dFVybDogc2Vzc2lvbi51cmwgfSk7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLmVycm9yKFwiL2FwaS9ib29raW5ncy9jcmVhdGUgZmFpbGVkXCIsIGVycik7XG5cbiAgICAvLyBab2QgdmFsaWRhdGlvblxuICAgIGNvbnN0IHpvZElzc3VlcyA9IGVycj8uaXNzdWVzO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHpvZElzc3VlcykgJiYgem9kSXNzdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IG1zZyA9IHpvZElzc3Vlcy5tYXAoKGk6IGFueSkgPT4gYCR7aS5wYXRoPy5qb2luKFwiLlwiKSB8fCBcImZpZWxkXCJ9OiAke2kubWVzc2FnZX1gKS5qb2luKFwiLCBcIik7XG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShgSW52YWxpZCByZXF1ZXN0OiAke21zZ31gLCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZXJyPy5tZXNzYWdlID09PSBcInN0cmluZ1wiICYmIGVyci5tZXNzYWdlLnRyaW0oKSA/IGVyci5tZXNzYWdlLnRyaW0oKSA6IFwiVW5rbm93biBzZXJ2ZXIgZXJyb3JcIjtcbiAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShtZXNzYWdlLCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwieiIsImNyZWF0ZUNoZWNrb3V0U2Vzc2lvbkZvckJvb2tpbmciLCJjb21wdXRlUHJpY2luZyIsInNlbmRCb29raW5nQ3JlYXRlZFBheW1lbnRSZXF1aXJlZEVtYWlsIiwiYXNzZXJ0RGJIZWFsdGh5T3JUaHJvdyIsIkRiVW5hdmFpbGFibGVFcnJvciIsImRiIiwiZGJIZWFsdGhDaGVjayIsInJ1bnRpbWUiLCJTZXJ2aWNlVHlwZSIsImVudW0iLCJCb29raW5nQ3JlYXRlU2NoZW1hIiwib2JqZWN0Iiwic2VydmljZVR5cGUiLCJzY2hlZHVsZWRTdGFydExvY2FsIiwic3RyaW5nIiwibWluIiwiYWRkcmVzcyIsInZlaGljbGVQbGF0ZSIsInZlaGljbGVNYWtlIiwib3B0aW9uYWwiLCJudWxsYWJsZSIsInZlaGljbGVNb2RlbCIsInZlaGljbGVZZWFyIiwicHJlcHJvY2VzcyIsInYiLCJ1bmRlZmluZWQiLCJjb2VyY2UiLCJudW1iZXIiLCJpbnQiLCJtYXgiLCJ2ZWhpY2xlRnVlbCIsIm9kb21ldGVyIiwic3ltcHRvbXMiLCJjdXN0b21lck5hbWUiLCJjdXN0b21lckVtYWlsIiwiZW1haWwiLCJjdXN0b21lclBob25lIiwiZ2V0VGltZVpvbmVPZmZzZXRNcyIsImRhdGVVdGMiLCJ0aW1lWm9uZSIsImR0ZiIsIkludGwiLCJEYXRlVGltZUZvcm1hdCIsInllYXIiLCJtb250aCIsImRheSIsImhvdXIiLCJtaW51dGUiLCJzZWNvbmQiLCJob3VyQ3ljbGUiLCJwYXJ0cyIsImZvcm1hdFRvUGFydHMiLCJnZXQiLCJ0eXBlIiwiZmluZCIsInAiLCJ2YWx1ZSIsInkiLCJOdW1iZXIiLCJtbyIsImQiLCJoIiwibWkiLCJzIiwiYXNJZlV0YyIsIkRhdGUiLCJVVEMiLCJnZXRUaW1lIiwiem9uZWRUaW1lVG9VdGNBdWNrbGFuZCIsIm0iLCJleGVjIiwiRXJyb3IiLCJ1dGNHdWVzcyIsIm9mZnNldE1zIiwiZ2V0QXVja2xhbmRMb2NhbFBhcnRzIiwid2Vla2RheSIsInRvTG93ZXJDYXNlIiwiYXNzZXJ0V2l0aGluQnVzaW5lc3NIb3VycyIsInNsb3RTdGFydFV0YyIsIm1pbnV0ZXMiLCJvcGVuIiwiY2xvc2UiLCJyZXNlcnZlZE1pbnV0ZXMiLCJwcm9jZXNzIiwiZW52IiwiQk9PS0lOR19SRVNFUlZFRF9NSU5VVEVTIiwidG90YWxNaW51dGVzIiwibGFzdFN0YXJ0IiwiZ2V0UmVzZXJ2ZWRNaW51dGVzRm9yRGlhZ25vc3RpY3MiLCJkdXJhdGlvbiIsIkJPT0tJTkdfRElBR05PU1RJQ1NfRFVSQVRJT05fTUlOVVRFUyIsInRyYXZlbCIsIkJPT0tJTkdfVFJBVkVMX0JVRkZFUl9NSU5VVEVTIiwiYWRtaW4iLCJCT09LSU5HX0FETUlOX0JVRkZFUl9NSU5VVEVTIiwiZHVyYXRpb25NaW51dGVzIiwidHJhdmVsTWludXRlcyIsImFkbWluTWludXRlcyIsIlBPU1QiLCJyZXEiLCJqc29uIiwiaW5wdXQiLCJwYXJzZSIsIkRBVEFCQVNFX1VSTCIsInN0YXR1cyIsIlNUUklQRV9TRUNSRVRfS0VZIiwiQVBQX1VSTCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsIm1lc3NhZ2UiLCJvayIsImRlZ3JhZGVkIiwiZmFsbGJhY2siLCJwaG9uZSIsImRpc3BsYXlQaG9uZSIsInNsb3RTdGFydCIsInJlc2VydmVkIiwic2xvdEVuZCIsInByaXNtYSIsImNvbmZsaWN0IiwiYm9va2luZyIsImZpbmRGaXJzdCIsIndoZXJlIiwiT1IiLCJwYXltZW50RXhwaXJlc0F0IiwiZ3QiLCJsdCIsInNlbGVjdCIsImlkIiwicHVibGljSWQiLCJtc2ciLCJTdHJpbmciLCJpbmNsdWRlcyIsImNvZGUiLCJwcmljaW5nIiwibm93IiwicGF5bWVudEV4cGlyeU1pbnV0ZXMiLCJzcGxpdCIsIm1hcCIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIiwibGluZTEiLCJzdWJ1cmIiLCJjaXR5IiwiY3JlYXRlRGlhZ25vc3RpY3NCb29raW5nIiwiY3VzdG9tZXIiLCJmdWxsTmFtZSIsInBvc3Rjb2RlIiwibGF0IiwibG5nIiwidHJhdmVsQmFuZCIsInZlaGljbGUiLCJwbGF0ZSIsInRvVXBwZXJDYXNlIiwicmVwbGFjZSIsIm1ha2UiLCJtb2RlbCIsImZ1ZWwiLCJhZnRlckhvdXJzIiwicHJpY2luZ0pzb24iLCJzeW1wdG9tUHJlc2V0Iiwibm90ZXMiLCJwcmljaW5nU25hcHNob3RKc29uIiwic2Vzc2lvbiIsInVybCIsInVwZGF0ZUJvb2tpbmdTdHJpcGVTZXNzaW9uIiwic3RyaXBlU2Vzc2lvbklkIiwiYm9va2luZ0lkIiwidG9FbWFpbCIsImNoZWNrb3V0VXJsIiwiem9kSXNzdWVzIiwiaXNzdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiaSIsInBhdGgiLCJqb2luIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/bookings/create/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/db.ts":
/*!**************************!*\
  !*** ./src/server/db.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DbUnavailableError: () => (/* binding */ DbUnavailableError),\n/* harmony export */   assertDbHealthyOrThrow: () => (/* binding */ assertDbHealthyOrThrow),\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   dbHealthCheck: () => (/* binding */ dbHealthCheck),\n/* harmony export */   isDevNoDb: () => (/* binding */ isDevNoDb)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction randomPublicId(prefix) {\n    // URL-safe short id: 10 chars approx (base64url)\n    const id = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(8).toString(\"base64url\");\n    return `${prefix}_${id}`;\n}\nfunction hasDbEnv() {\n    return Boolean(process.env.DATABASE_URL);\n}\nclass DbUnavailableError extends Error {\n    constructor(message){\n        super(message), this.code = \"DB_UNAVAILABLE\";\n        this.name = \"DbUnavailableError\";\n    }\n}\nfunction sleep(ms) {\n    return new Promise((resolve)=>setTimeout(resolve, ms));\n}\nfunction isLikelyDbConnectivityError(err) {\n    const msg = String(err?.message || \"\");\n    const code = String(err?.code || \"\");\n    // Prisma + Postgres connectivity failures commonly show as:\n    // - P1001 / P1002\n    // - \"Can't reach database server\"\n    // - \"ECONNREFUSED\" / \"ETIMEDOUT\" / \"ENOTFOUND\"\n    return code === \"P1001\" || code === \"P1002\" || msg.toLowerCase().includes(\"can't reach database server\") || msg.toLowerCase().includes(\"cant reach database server\") || msg.toLowerCase().includes(\"econnrefused\") || msg.toLowerCase().includes(\"etimedout\") || msg.toLowerCase().includes(\"enotfound\") || msg.toLowerCase().includes(\"connection terminated\");\n}\nasync function withDbRetries(fn) {\n    // Short, bounded retry with jitter-like increasing delays.\n    const delays = [\n        0,\n        120,\n        300\n    ];\n    let lastErr;\n    for(let attempt = 0; attempt < delays.length; attempt++){\n        if (delays[attempt] > 0) await sleep(delays[attempt]);\n        try {\n            return await fn();\n        } catch (err) {\n            lastErr = err;\n            if (!isLikelyDbConnectivityError(err) || attempt === delays.length - 1) throw err;\n        }\n    }\n    throw lastErr;\n}\nasync function dbHealthCheck() {\n    if (isDevNoDb()) return {\n        ok: true,\n        latencyMs: 0\n    };\n    if (!hasDbEnv()) return {\n        ok: false,\n        latencyMs: 0,\n        error: \"Missing DATABASE_URL\"\n    };\n    const started = Date.now();\n    try {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const timeoutMs = Number(process.env.DB_HEALTHCHECK_TIMEOUT_MS || \"1200\") || 1200;\n        await withDbRetries(async ()=>{\n            await Promise.race([\n                prisma.$queryRaw`SELECT 1`,\n                new Promise((_, reject)=>setTimeout(()=>reject(new Error(\"DB healthcheck timeout\")), timeoutMs))\n            ]);\n        });\n        return {\n            ok: true,\n            latencyMs: Date.now() - started\n        };\n    } catch (err) {\n        const msg = String(err?.message || \"DB healthcheck failed\");\n        return {\n            ok: false,\n            latencyMs: Date.now() - started,\n            error: msg\n        };\n    }\n}\nasync function assertDbHealthyOrThrow() {\n    const health = await dbHealthCheck();\n    if (!health.ok) {\n        throw new DbUnavailableError(health.error || \"Database is currently unavailable\");\n    }\n    return health;\n}\nfunction isDevNoDb() {\n    return process.env.DEV_NO_DB === \"true\" || !hasDbEnv();\n}\nconst mem = global.__devNoDbStore || (global.__devNoDbStore = {\n    bookings: new Map(),\n    quoteRequests: new Map(),\n    jobs: new Map(),\n    serviceReports: new Map(),\n    idempotency: new Map()\n});\nfunction idemMapKey(scope, key) {\n    return `${scope}:${key}`;\n}\nfunction randomPublicToken() {\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(24).toString(\"base64url\");\n}\nconst memoryAdapter = {\n    async createDiagnosticsBooking (input) {\n        const id = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomUUID();\n        const now = new Date();\n        const rec = {\n            id,\n            publicId: randomPublicId(\"bk\"),\n            kind: \"DIAGNOSTICS\",\n            status: \"PENDING_PAYMENT\",\n            customerId: randomPublicId(\"cust\"),\n            addressId: randomPublicId(\"addr\"),\n            vehicleId: randomPublicId(\"veh\"),\n            slotStart: input.slotStart,\n            slotEnd: input.slotEnd,\n            afterHours: input.afterHours,\n            symptomPreset: input.symptomPreset ?? null,\n            notes: input.notes ?? null,\n            pricingSnapshotJson: input.pricingSnapshotJson,\n            stripeSessionId: null,\n            paymentExpiresAt: input.paymentExpiresAt,\n            serviceM8JobId: null,\n            serviceM8Url: null,\n            createdAt: now,\n            updatedAt: now\n        };\n        mem.bookings.set(id, rec);\n        return rec;\n    },\n    async createJob (input) {\n        const id = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomUUID();\n        const now = new Date();\n        const rec = {\n            id,\n            publicId: randomPublicId(\"job\"),\n            status: input.status ?? \"NEW\",\n            title: input.title,\n            description: input.description ?? null,\n            internalNotes: input.internalNotes ?? null,\n            customerId: randomPublicId(\"cust\"),\n            addressId: randomPublicId(\"addr\"),\n            vehicleId: input.vehicle ? randomPublicId(\"veh\") : null,\n            quoteRequestId: null,\n            bookingId: null,\n            scheduledStart: null,\n            scheduledEnd: null,\n            createdAt: now,\n            updatedAt: now\n        };\n        mem.jobs.set(id, rec);\n        return rec;\n    },\n    async listJobs (limit) {\n        return Array.from(mem.jobs.values()).sort((a, b)=>b.createdAt.getTime() - a.createdAt.getTime()).slice(0, limit);\n    },\n    async updateJobStatus (where, input) {\n        const existing = mem.jobs.get(where.id);\n        if (!existing) throw new Error(\"Job not found\");\n        const updated = {\n            ...existing,\n            status: input.status,\n            updatedAt: new Date()\n        };\n        mem.jobs.set(where.id, updated);\n        return updated;\n    },\n    async getJobById (id) {\n        return mem.jobs.get(id) ?? null;\n    },\n    async createQuoteRequest (input) {\n        const id = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomUUID();\n        const now = new Date();\n        const rec = {\n            id,\n            publicId: randomPublicId(\"qr\"),\n            status: \"NEW\",\n            category: input.category,\n            urgency: input.urgency,\n            customerId: randomPublicId(\"cust\"),\n            addressId: randomPublicId(\"addr\"),\n            vehicleId: randomPublicId(\"veh\"),\n            symptoms: input.symptoms,\n            description: input.description,\n            pricingSnapshotJson: input.pricingSnapshotJson,\n            serviceM8JobId: null,\n            serviceM8Url: null,\n            createdAt: now,\n            updatedAt: now\n        };\n        mem.quoteRequests.set(id, rec);\n        return rec;\n    },\n    async updateQuoteRequestStatus (where, input) {\n        const existing = mem.quoteRequests.get(where.id);\n        if (!existing) throw new Error(\"Quote request not found\");\n        const updated = {\n            ...existing,\n            status: input.status,\n            updatedAt: new Date()\n        };\n        mem.quoteRequests.set(where.id, updated);\n        return updated;\n    },\n    async listQuoteRequests (limit) {\n        return Array.from(mem.quoteRequests.values()).sort((a, b)=>b.createdAt.getTime() - a.createdAt.getTime()).slice(0, limit);\n    },\n    async updateBookingStatus (where, input) {\n        const existing = mem.bookings.get(where.id);\n        if (!existing) throw new Error(\"Booking not found\");\n        const updated = {\n            ...existing,\n            status: input.status,\n            updatedAt: new Date()\n        };\n        mem.bookings.set(where.id, updated);\n        return updated;\n    },\n    async updateBookingStripeSession (where, input) {\n        const existing = mem.bookings.get(where.id);\n        if (!existing) throw new Error(\"Booking not found\");\n        const updated = {\n            ...existing,\n            stripeSessionId: input.stripeSessionId,\n            updatedAt: new Date()\n        };\n        mem.bookings.set(where.id, updated);\n        return updated;\n    },\n    async getBookingById (id) {\n        return mem.bookings.get(id) ?? null;\n    },\n    async listBookings (limit) {\n        return Array.from(mem.bookings.values()).sort((a, b)=>b.createdAt.getTime() - a.createdAt.getTime()).slice(0, limit);\n    },\n    async expirePendingBookings (now) {\n        let count = 0;\n        for (const b of mem.bookings.values()){\n            if (b.status === \"PENDING_PAYMENT\" && b.paymentExpiresAt && b.paymentExpiresAt.getTime() <= now.getTime()) {\n                mem.bookings.set(b.id, {\n                    ...b,\n                    status: \"EXPIRED\",\n                    updatedAt: new Date()\n                });\n                count++;\n            }\n        }\n        return count;\n    },\n    async createIdempotencyKeyOnce (input) {\n        const k = idemMapKey(input.scope, input.key);\n        if (mem.idempotency.has(k)) return {\n            created: false\n        };\n        mem.idempotency.set(k, {\n            scope: input.scope,\n            key: input.key,\n            createdAt: new Date()\n        });\n        return {\n            created: true\n        };\n    },\n    async createOrGetServiceReportForBooking (input) {\n        const existing = Array.from(mem.serviceReports.values()).find((r)=>r.bookingId === input.bookingId && r.type === input.type);\n        if (existing) return existing;\n        const id = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomUUID();\n        const now = new Date();\n        const rec = {\n            id,\n            bookingId: input.bookingId,\n            type: input.type,\n            status: \"DRAFT\",\n            dataJson: {\n                version: 1,\n                type: input.type,\n                title: input.type === \"DIAGNOSTICS\" ? \"Diagnostics Report\" : \"Pre-Purchase Inspection Report\",\n                summary: \"\",\n                contentMarkdown: \"\",\n                attachments: []\n            },\n            publicToken: randomPublicToken(),\n            emailedAt: null,\n            createdAt: now,\n            updatedAt: now\n        };\n        mem.serviceReports.set(id, rec);\n        return rec;\n    },\n    async updateServiceReportData (where, input) {\n        const existing = mem.serviceReports.get(where.id);\n        if (!existing) throw new Error(\"Service report not found\");\n        const updated = {\n            ...existing,\n            status: input.status ?? existing.status,\n            dataJson: input.dataJson,\n            updatedAt: new Date()\n        };\n        mem.serviceReports.set(where.id, updated);\n        return updated;\n    },\n    async markServiceReportEmailed (where, input) {\n        const existing = mem.serviceReports.get(where.id);\n        if (!existing) throw new Error(\"Service report not found\");\n        const updated = {\n            ...existing,\n            emailedAt: input.emailedAt,\n            updatedAt: new Date()\n        };\n        mem.serviceReports.set(where.id, updated);\n        return updated;\n    },\n    async getServiceReportByPublicToken (token) {\n        return Array.from(mem.serviceReports.values()).find((r)=>r.publicToken === token) ?? null;\n    }\n};\nconst prismaAdapter = {\n    async createDiagnosticsBooking (input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const booking = await prisma.$transaction(async (tx)=>{\n            const email = (input.customer.email ?? \"\").trim().toLowerCase() || null;\n            const phone = (input.customer.phone ?? \"\").trim() || null;\n            const existingCustomer = await tx.customer.findFirst({\n                where: {\n                    OR: [\n                        ...email ? [\n                            {\n                                email\n                            }\n                        ] : [],\n                        ...phone ? [\n                            {\n                                phone\n                            }\n                        ] : []\n                    ]\n                }\n            });\n            const customer = existingCustomer ?? await tx.customer.create({\n                data: {\n                    publicId: randomPublicId(\"cust\"),\n                    fullName: input.customer.fullName,\n                    email,\n                    phone\n                }\n            });\n            const address = await tx.address.create({\n                data: {\n                    publicId: randomPublicId(\"addr\"),\n                    customerId: customer.id,\n                    line1: input.address.line1,\n                    suburb: input.address.suburb,\n                    city: input.address.city,\n                    postcode: input.address.postcode ?? null,\n                    lat: input.address.lat ?? null,\n                    lng: input.address.lng ?? null,\n                    travelBand: input.address.travelBand ?? null\n                }\n            });\n            const vehicle = await tx.vehicle.create({\n                data: {\n                    publicId: randomPublicId(\"veh\"),\n                    customerId: customer.id,\n                    plate: input.vehicle.plate ?? null,\n                    make: input.vehicle.make ?? null,\n                    model: input.vehicle.model ?? null,\n                    year: input.vehicle.year ?? null,\n                    fuel: input.vehicle.fuel ?? null,\n                    odometer: input.vehicle.odometer ?? null\n                }\n            });\n            return tx.booking.create({\n                data: {\n                    publicId: randomPublicId(\"bk\"),\n                    kind: \"DIAGNOSTICS\",\n                    status: \"PENDING_PAYMENT\",\n                    customerId: customer.id,\n                    addressId: address.id,\n                    vehicleId: vehicle.id,\n                    slotStart: input.slotStart,\n                    slotEnd: input.slotEnd,\n                    afterHours: input.afterHours,\n                    symptomPreset: input.symptomPreset ?? null,\n                    notes: input.notes ?? null,\n                    pricingSnapshotJson: input.pricingSnapshotJson,\n                    paymentExpiresAt: input.paymentExpiresAt\n                }\n            });\n        });\n        return booking;\n    },\n    async createQuoteRequest (input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const quote = await prisma.$transaction(async (tx)=>{\n            const email = (input.customer.email ?? \"\").trim().toLowerCase() || null;\n            const phone = (input.customer.phone ?? \"\").trim() || null;\n            const existingCustomer = await tx.customer.findFirst({\n                where: {\n                    OR: [\n                        ...email ? [\n                            {\n                                email\n                            }\n                        ] : [],\n                        ...phone ? [\n                            {\n                                phone\n                            }\n                        ] : []\n                    ]\n                }\n            });\n            const customer = existingCustomer ?? await tx.customer.create({\n                data: {\n                    publicId: randomPublicId(\"cust\"),\n                    fullName: input.customer.fullName,\n                    email,\n                    phone\n                }\n            });\n            const address = await tx.address.create({\n                data: {\n                    publicId: randomPublicId(\"addr\"),\n                    customerId: customer.id,\n                    line1: input.address.line1,\n                    suburb: input.address.suburb,\n                    city: input.address.city,\n                    postcode: input.address.postcode ?? null,\n                    lat: input.address.lat ?? null,\n                    lng: input.address.lng ?? null,\n                    travelBand: input.address.travelBand ?? null\n                }\n            });\n            const vehicle = await tx.vehicle.create({\n                data: {\n                    publicId: randomPublicId(\"veh\"),\n                    customerId: customer.id,\n                    plate: input.vehicle.plate ?? null,\n                    make: input.vehicle.make ?? null,\n                    model: input.vehicle.model ?? null,\n                    year: input.vehicle.year ?? null,\n                    fuel: input.vehicle.fuel ?? null,\n                    odometer: input.vehicle.odometer ?? null\n                }\n            });\n            return tx.quoteRequest.create({\n                data: {\n                    publicId: randomPublicId(\"qr\"),\n                    status: \"NEW\",\n                    category: input.category,\n                    urgency: input.urgency,\n                    customerId: customer.id,\n                    addressId: address.id,\n                    vehicleId: vehicle.id,\n                    symptoms: input.symptoms,\n                    description: input.description,\n                    pricingSnapshotJson: input.pricingSnapshotJson\n                }\n            });\n        });\n        return quote;\n    },\n    async createJob (input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const job = await prisma.$transaction(async (tx)=>{\n            const email = (input.customer.email ?? \"\").trim().toLowerCase() || null;\n            const phone = (input.customer.phone ?? \"\").trim() || null;\n            const existingCustomer = await tx.customer.findFirst({\n                where: {\n                    OR: [\n                        ...email ? [\n                            {\n                                email\n                            }\n                        ] : [],\n                        ...phone ? [\n                            {\n                                phone\n                            }\n                        ] : []\n                    ]\n                }\n            });\n            const customer = existingCustomer ?? await tx.customer.create({\n                data: {\n                    publicId: randomPublicId(\"cust\"),\n                    fullName: input.customer.fullName,\n                    email,\n                    phone\n                }\n            });\n            const address = await tx.address.create({\n                data: {\n                    publicId: randomPublicId(\"addr\"),\n                    customerId: customer.id,\n                    line1: input.address.line1,\n                    suburb: input.address.suburb,\n                    city: input.address.city,\n                    postcode: input.address.postcode ?? null,\n                    lat: input.address.lat ?? null,\n                    lng: input.address.lng ?? null,\n                    travelBand: input.address.travelBand ?? null\n                }\n            });\n            const vehicle = input.vehicle ? await tx.vehicle.create({\n                data: {\n                    publicId: randomPublicId(\"veh\"),\n                    customerId: customer.id,\n                    plate: input.vehicle.plate ?? null,\n                    make: input.vehicle.make ?? null,\n                    model: input.vehicle.model ?? null,\n                    year: input.vehicle.year ?? null,\n                    fuel: input.vehicle.fuel ?? null,\n                    odometer: input.vehicle.odometer ?? null\n                }\n            }) : null;\n            return tx.job.create({\n                data: {\n                    publicId: randomPublicId(\"job\"),\n                    status: input.status ?? \"NEW\",\n                    title: input.title,\n                    description: input.description ?? null,\n                    internalNotes: input.internalNotes ?? null,\n                    customerId: customer.id,\n                    addressId: address.id,\n                    vehicleId: vehicle?.id ?? null\n                }\n            });\n        });\n        return job;\n    },\n    async listJobs (limit) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const rows = await prisma.job.findMany({\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            take: limit\n        });\n        return rows;\n    },\n    async updateJobStatus (where, input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const job = await prisma.job.update({\n            where: {\n                id: where.id\n            },\n            data: {\n                status: input.status\n            }\n        });\n        return job;\n    },\n    async getJobById (id) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        return await prisma.job.findUnique({\n            where: {\n                id\n            }\n        });\n    },\n    async updateQuoteRequestStatus (where, input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const quote = await prisma.quoteRequest.update({\n            where: {\n                id: where.id\n            },\n            data: {\n                status: input.status\n            }\n        });\n        return quote;\n    },\n    async listQuoteRequests (limit) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const rows = await prisma.quoteRequest.findMany({\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            take: limit\n        });\n        return rows;\n    },\n    async updateBookingStatus (where, input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const booking = await prisma.booking.update({\n            where: {\n                id: where.id\n            },\n            data: {\n                status: input.status\n            }\n        });\n        return booking;\n    },\n    async updateBookingStripeSession (where, input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const booking = await prisma.booking.update({\n            where: {\n                id: where.id\n            },\n            data: {\n                stripeSessionId: input.stripeSessionId\n            }\n        });\n        return booking;\n    },\n    async getBookingById (id) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        return await prisma.booking.findUnique({\n            where: {\n                id\n            }\n        });\n    },\n    async listBookings (limit) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        return await prisma.booking.findMany({\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            take: limit\n        });\n    },\n    async expirePendingBookings (now) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const res = await prisma.booking.updateMany({\n            where: {\n                status: \"PENDING_PAYMENT\",\n                paymentExpiresAt: {\n                    lte: now\n                }\n            },\n            data: {\n                status: \"EXPIRED\"\n            }\n        });\n        return res.count;\n    },\n    async createIdempotencyKeyOnce (input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        try {\n            await prisma.idempotencyKey.create({\n                data: {\n                    scope: input.scope,\n                    key: input.key,\n                    requestHash: input.requestHash ?? null,\n                    responseJson: input.responseJson ?? null\n                }\n            });\n            return {\n                created: true\n            };\n        } catch  {\n            return {\n                created: false\n            };\n        }\n    },\n    async createOrGetServiceReportForBooking (input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const existing = await prisma.serviceReport.findFirst({\n            where: {\n                bookingId: input.bookingId,\n                type: input.type\n            }\n        });\n        if (existing) return existing;\n        const dataJson = {\n            version: 1,\n            type: input.type,\n            title: input.type === \"DIAGNOSTICS\" ? \"Diagnostics Report\" : \"Pre-Purchase Inspection Report\",\n            summary: \"\",\n            contentMarkdown: \"\",\n            attachments: []\n        };\n        const created = await prisma.serviceReport.create({\n            data: {\n                bookingId: input.bookingId,\n                type: input.type,\n                status: \"DRAFT\",\n                dataJson,\n                publicToken: randomPublicToken()\n            }\n        });\n        return created;\n    },\n    async updateServiceReportData (where, input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const updated = await prisma.serviceReport.update({\n            where: {\n                id: where.id\n            },\n            data: {\n                status: input.status,\n                dataJson: input.dataJson\n            }\n        });\n        return updated;\n    },\n    async markServiceReportEmailed (where, input) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        const updated = await prisma.serviceReport.update({\n            where: {\n                id: where.id\n            },\n            data: {\n                emailedAt: input.emailedAt\n            }\n        });\n        return updated;\n    },\n    async getServiceReportByPublicToken (token) {\n        const { prisma } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_prisma_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/prisma */ \"(rsc)/./src/server/prisma.ts\"));\n        return await prisma.serviceReport.findUnique({\n            where: {\n                publicToken: token\n            }\n        });\n    }\n};\nfunction db() {\n    return isDevNoDb() ? memoryAdapter : prismaAdapter;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQ1IsTUFBTSxDQUFDO1lBQ3pEdkUsT0FBTztnQkFBRTNHLElBQUkyRyxNQUFNM0csRUFBRTtZQUFDO1lBQ3RCMkosTUFBTTtnQkFDSnJGLFFBQVFMLE1BQU1LLE1BQU07Z0JBQ3BCOEQsVUFBVW5FLE1BQU1tRSxRQUFRO1lBQzFCO1FBQ0Y7UUFDQSxPQUFPdEI7SUFDVDtJQUVBLE1BQU04QiwwQkFBeUJqQyxLQUFLLEVBQUUxQyxLQUFLO1FBQ3pDLE1BQU0sRUFBRTFCLE1BQU0sRUFBRSxHQUFHLE1BQU0sNktBQXlCO1FBQ2xELE1BQU11RSxVQUFVLE1BQU0sT0FBZ0I0RSxhQUFhLENBQUNSLE1BQU0sQ0FBQztZQUN6RHZFLE9BQU87Z0JBQUUzRyxJQUFJMkcsTUFBTTNHLEVBQUU7WUFBQztZQUN0QjJKLE1BQU07Z0JBQUVqQixXQUFXekUsTUFBTXlFLFNBQVM7WUFBQztRQUNyQztRQUNBLE9BQU81QjtJQUNUO0lBRUEsTUFBTStCLCtCQUE4QkMsS0FBSztRQUN2QyxNQUFNLEVBQUV2RyxNQUFNLEVBQUUsR0FBRyxNQUFNLDZLQUF5QjtRQUNsRCxPQUFRLE1BQU0sT0FBZ0JtSixhQUFhLENBQUNQLFVBQVUsQ0FBQztZQUFFeEUsT0FBTztnQkFBRThCLGFBQWFLO1lBQU07UUFBRTtJQUN6RjtBQUNGO0FBRU8sU0FBUzZDO0lBQ2QsT0FBTzNKLGNBQWMrQixnQkFBZ0JnRjtBQUN2QyIsInNvdXJjZXMiOlsiQzpcXG56bW9iaWxlYXV0b3NcXG5leHRcXHNyY1xcc2VydmVyXFxkYi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcblxuZXhwb3J0IHR5cGUgQm9va2luZ0tpbmQgPSBcIkRJQUdOT1NUSUNTXCI7XG5leHBvcnQgdHlwZSBCb29raW5nU3RhdHVzID0gXCJORVdcIiB8IFwiUEVORElOR19QQVlNRU5UXCIgfCBcIkNPTkZJUk1FRFwiIHwgXCJDQU5DRUxMRURcIiB8IFwiRVhQSVJFRFwiIHwgXCJJTl9QUk9HUkVTU1wiIHwgXCJDT01QTEVURURcIjtcblxuZXhwb3J0IHR5cGUgUXVvdGVDYXRlZ29yeSA9IFwiQlJBS0VTXCIgfCBcIldPRl9SRVBBSVJTXCIgfCBcIlNFUlZJQ0lOR1wiIHwgXCJPVEhFUlwiO1xuZXhwb3J0IHR5cGUgUXVvdGVVcmdlbmN5ID0gXCJUT0RBWVwiIHwgXCJUSElTX1dFRUtcIiB8IFwiRkxFWElCTEVcIjtcbmV4cG9ydCB0eXBlIFF1b3RlUmVxdWVzdFN0YXR1cyA9IFwiTkVXXCIgfCBcIkNPTlRBQ1RFRFwiIHwgXCJCT09LRURcIiB8IFwiSU5fUFJPR1JFU1NcIiB8IFwiQ09NUExFVEVEXCIgfCBcIkNMT1NFRFwiO1xuXG5leHBvcnQgdHlwZSBKb2JTdGF0dXMgPSBcIk5FV1wiIHwgXCJORUVEU19RVU9URVwiIHwgXCJRVU9URURcIiB8IFwiU0NIRURVTEVEXCIgfCBcIklOX1BST0dSRVNTXCIgfCBcIkNPTVBMRVRFRFwiIHwgXCJDQU5DRUxMRURcIjtcblxuZXhwb3J0IHR5cGUgU2VydmljZVJlcG9ydFR5cGUgPSBcIkRJQUdOT1NUSUNTXCIgfCBcIlBQSVwiO1xuZXhwb3J0IHR5cGUgU2VydmljZVJlcG9ydFN0YXR1cyA9IFwiRFJBRlRcIiB8IFwiRklOQUxcIjtcblxuZXhwb3J0IHR5cGUgU2VydmljZVJlcG9ydFJlY29yZCA9IHtcbiAgaWQ6IHN0cmluZztcbiAgYm9va2luZ0lkOiBzdHJpbmc7XG4gIHR5cGU6IFNlcnZpY2VSZXBvcnRUeXBlO1xuICBzdGF0dXM6IFNlcnZpY2VSZXBvcnRTdGF0dXM7XG4gIGRhdGFKc29uOiBhbnk7XG4gIHB1YmxpY1Rva2VuOiBzdHJpbmc7XG4gIGVtYWlsZWRBdDogRGF0ZSB8IG51bGw7XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbiAgdXBkYXRlZEF0OiBEYXRlO1xufTtcblxuZXhwb3J0IHR5cGUgSm9iUmVjb3JkID0ge1xuICBpZDogc3RyaW5nO1xuICBwdWJsaWNJZDogc3RyaW5nO1xuICBzdGF0dXM6IEpvYlN0YXR1cztcblxuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nIHwgbnVsbDtcbiAgaW50ZXJuYWxOb3Rlczogc3RyaW5nIHwgbnVsbDtcblxuICBjdXN0b21lcklkOiBzdHJpbmc7XG4gIGFkZHJlc3NJZDogc3RyaW5nO1xuICB2ZWhpY2xlSWQ6IHN0cmluZyB8IG51bGw7XG5cbiAgcXVvdGVSZXF1ZXN0SWQ6IHN0cmluZyB8IG51bGw7XG4gIGJvb2tpbmdJZDogc3RyaW5nIHwgbnVsbDtcblxuICBzY2hlZHVsZWRTdGFydDogRGF0ZSB8IG51bGw7XG4gIHNjaGVkdWxlZEVuZDogRGF0ZSB8IG51bGw7XG5cbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG59O1xuXG5leHBvcnQgdHlwZSBCb29raW5nUmVjb3JkID0ge1xuICBpZDogc3RyaW5nO1xuICBwdWJsaWNJZDogc3RyaW5nO1xuICBraW5kOiBCb29raW5nS2luZDtcbiAgc3RhdHVzOiBCb29raW5nU3RhdHVzO1xuXG4gIGN1c3RvbWVySWQ6IHN0cmluZztcbiAgYWRkcmVzc0lkOiBzdHJpbmc7XG4gIHZlaGljbGVJZDogc3RyaW5nIHwgbnVsbDtcblxuICBzbG90U3RhcnQ6IERhdGU7XG4gIHNsb3RFbmQ6IERhdGU7XG4gIGFmdGVySG91cnM6IGJvb2xlYW47XG5cbiAgc3ltcHRvbVByZXNldDogc3RyaW5nIHwgbnVsbDtcbiAgbm90ZXM6IHN0cmluZyB8IG51bGw7XG5cbiAgcHJpY2luZ1NuYXBzaG90SnNvbjogYW55O1xuXG4gIHN0cmlwZVNlc3Npb25JZDogc3RyaW5nIHwgbnVsbDtcbiAgcGF5bWVudEV4cGlyZXNBdDogRGF0ZSB8IG51bGw7XG5cbiAgc2VydmljZU04Sm9iSWQ6IHN0cmluZyB8IG51bGw7XG4gIHNlcnZpY2VNOFVybDogc3RyaW5nIHwgbnVsbDtcblxuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHVwZGF0ZWRBdDogRGF0ZTtcbn07XG5cbmV4cG9ydCB0eXBlIFF1b3RlUmVxdWVzdFJlY29yZCA9IHtcbiAgaWQ6IHN0cmluZztcbiAgcHVibGljSWQ6IHN0cmluZztcbiAgc3RhdHVzOiBRdW90ZVJlcXVlc3RTdGF0dXM7XG4gIGNhdGVnb3J5OiBRdW90ZUNhdGVnb3J5O1xuICB1cmdlbmN5OiBRdW90ZVVyZ2VuY3k7XG5cbiAgY3VzdG9tZXJJZDogc3RyaW5nO1xuICBhZGRyZXNzSWQ6IHN0cmluZztcbiAgdmVoaWNsZUlkOiBzdHJpbmcgfCBudWxsO1xuXG4gIHN5bXB0b21zOiBhbnk7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsO1xuICBwcmljaW5nU25hcHNob3RKc29uOiBhbnk7XG5cbiAgc2VydmljZU04Sm9iSWQ6IHN0cmluZyB8IG51bGw7XG4gIHNlcnZpY2VNOFVybDogc3RyaW5nIHwgbnVsbDtcblxuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHVwZGF0ZWRBdDogRGF0ZTtcbn07XG5cbmV4cG9ydCB0eXBlIENyZWF0ZURpYWdub3N0aWNzQm9va2luZ0lucHV0ID0ge1xuICBjdXN0b21lcjoge1xuICAgIGZ1bGxOYW1lOiBzdHJpbmc7XG4gICAgZW1haWw/OiBzdHJpbmcgfCBudWxsO1xuICAgIHBob25lPzogc3RyaW5nIHwgbnVsbDtcbiAgfTtcbiAgYWRkcmVzczoge1xuICAgIGxpbmUxOiBzdHJpbmc7XG4gICAgc3VidXJiOiBzdHJpbmc7XG4gICAgY2l0eTogc3RyaW5nO1xuICAgIHBvc3Rjb2RlPzogc3RyaW5nIHwgbnVsbDtcbiAgICBsYXQ/OiBudW1iZXIgfCBudWxsO1xuICAgIGxuZz86IG51bWJlciB8IG51bGw7XG4gICAgdHJhdmVsQmFuZD86IHN0cmluZyB8IG51bGw7XG4gIH07XG4gIHZlaGljbGU6IHtcbiAgICBwbGF0ZT86IHN0cmluZyB8IG51bGw7XG4gICAgbWFrZT86IHN0cmluZyB8IG51bGw7XG4gICAgbW9kZWw/OiBzdHJpbmcgfCBudWxsO1xuICAgIHllYXI/OiBudW1iZXIgfCBudWxsO1xuICAgIGZ1ZWw/OiBzdHJpbmcgfCBudWxsO1xuICAgIG9kb21ldGVyPzogc3RyaW5nIHwgbnVsbDtcbiAgfTtcbiAgc2xvdFN0YXJ0OiBEYXRlO1xuICBzbG90RW5kOiBEYXRlO1xuICBhZnRlckhvdXJzOiBib29sZWFuO1xuICBzeW1wdG9tUHJlc2V0Pzogc3RyaW5nIHwgbnVsbDtcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsO1xuICBwcmljaW5nU25hcHNob3RKc29uOiBhbnk7XG4gIHBheW1lbnRFeHBpcmVzQXQ6IERhdGUgfCBudWxsO1xufTtcblxuZXhwb3J0IHR5cGUgQ3JlYXRlUXVvdGVSZXF1ZXN0SW5wdXQgPSB7XG4gIGNhdGVnb3J5OiBRdW90ZUNhdGVnb3J5O1xuICB1cmdlbmN5OiBRdW90ZVVyZ2VuY3k7XG4gIGN1c3RvbWVyOiB7XG4gICAgZnVsbE5hbWU6IHN0cmluZztcbiAgICBlbWFpbD86IHN0cmluZyB8IG51bGw7XG4gICAgcGhvbmU/OiBzdHJpbmcgfCBudWxsO1xuICB9O1xuICBhZGRyZXNzOiB7XG4gICAgbGluZTE6IHN0cmluZztcbiAgICBzdWJ1cmI6IHN0cmluZztcbiAgICBjaXR5OiBzdHJpbmc7XG4gICAgcG9zdGNvZGU/OiBzdHJpbmcgfCBudWxsO1xuICAgIGxhdD86IG51bWJlciB8IG51bGw7XG4gICAgbG5nPzogbnVtYmVyIHwgbnVsbDtcbiAgICB0cmF2ZWxCYW5kPzogc3RyaW5nIHwgbnVsbDtcbiAgfTtcbiAgdmVoaWNsZToge1xuICAgIHBsYXRlPzogc3RyaW5nIHwgbnVsbDtcbiAgICBtYWtlPzogc3RyaW5nIHwgbnVsbDtcbiAgICBtb2RlbD86IHN0cmluZyB8IG51bGw7XG4gICAgeWVhcj86IG51bWJlciB8IG51bGw7XG4gICAgZnVlbD86IHN0cmluZyB8IG51bGw7XG4gICAgb2RvbWV0ZXI/OiBzdHJpbmcgfCBudWxsO1xuICB9O1xuICBzeW1wdG9tczogc3RyaW5nW107XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHByaWNpbmdTbmFwc2hvdEpzb246IGFueTtcbn07XG5cbmV4cG9ydCB0eXBlIENyZWF0ZUpvYklucHV0ID0ge1xuICBzdGF0dXM/OiBKb2JTdGF0dXMgfCBudWxsO1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZyB8IG51bGw7XG4gIGludGVybmFsTm90ZXM/OiBzdHJpbmcgfCBudWxsO1xuICBjdXN0b21lcjoge1xuICAgIGZ1bGxOYW1lOiBzdHJpbmc7XG4gICAgZW1haWw/OiBzdHJpbmcgfCBudWxsO1xuICAgIHBob25lPzogc3RyaW5nIHwgbnVsbDtcbiAgfTtcbiAgYWRkcmVzczoge1xuICAgIGxpbmUxOiBzdHJpbmc7XG4gICAgc3VidXJiOiBzdHJpbmc7XG4gICAgY2l0eTogc3RyaW5nO1xuICAgIHBvc3Rjb2RlPzogc3RyaW5nIHwgbnVsbDtcbiAgICBsYXQ/OiBudW1iZXIgfCBudWxsO1xuICAgIGxuZz86IG51bWJlciB8IG51bGw7XG4gICAgdHJhdmVsQmFuZD86IHN0cmluZyB8IG51bGw7XG4gIH07XG4gIHZlaGljbGU/OiB7XG4gICAgcGxhdGU/OiBzdHJpbmcgfCBudWxsO1xuICAgIG1ha2U/OiBzdHJpbmcgfCBudWxsO1xuICAgIG1vZGVsPzogc3RyaW5nIHwgbnVsbDtcbiAgICB5ZWFyPzogbnVtYmVyIHwgbnVsbDtcbiAgICBmdWVsPzogc3RyaW5nIHwgbnVsbDtcbiAgICBvZG9tZXRlcj86IHN0cmluZyB8IG51bGw7XG4gIH0gfCBudWxsO1xufTtcblxuZnVuY3Rpb24gcmFuZG9tUHVibGljSWQocHJlZml4OiBzdHJpbmcpIHtcbiAgLy8gVVJMLXNhZmUgc2hvcnQgaWQ6IDEwIGNoYXJzIGFwcHJveCAoYmFzZTY0dXJsKVxuICBjb25zdCBpZCA9IGNyeXB0by5yYW5kb21CeXRlcyg4KS50b1N0cmluZyhcImJhc2U2NHVybFwiKTtcbiAgcmV0dXJuIGAke3ByZWZpeH1fJHtpZH1gO1xufVxuXG5mdW5jdGlvbiBoYXNEYkVudigpIHtcbiAgcmV0dXJuIEJvb2xlYW4ocHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMKTtcbn1cblxuZXhwb3J0IHR5cGUgRGJIZWFsdGhSZXN1bHQgPSB7XG4gIG9rOiBib29sZWFuO1xuICBsYXRlbmN5TXM6IG51bWJlcjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59O1xuXG5leHBvcnQgY2xhc3MgRGJVbmF2YWlsYWJsZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICByZWFkb25seSBjb2RlID0gXCJEQl9VTkFWQUlMQUJMRVwiO1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIkRiVW5hdmFpbGFibGVFcnJvclwiO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNsZWVwKG1zOiBudW1iZXIpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5cbmZ1bmN0aW9uIGlzTGlrZWx5RGJDb25uZWN0aXZpdHlFcnJvcihlcnI6IHVua25vd24pIHtcbiAgY29uc3QgbXNnID0gU3RyaW5nKChlcnIgYXMgYW55KT8ubWVzc2FnZSB8fCBcIlwiKTtcbiAgY29uc3QgY29kZSA9IFN0cmluZygoZXJyIGFzIGFueSk/LmNvZGUgfHwgXCJcIik7XG5cbiAgLy8gUHJpc21hICsgUG9zdGdyZXMgY29ubmVjdGl2aXR5IGZhaWx1cmVzIGNvbW1vbmx5IHNob3cgYXM6XG4gIC8vIC0gUDEwMDEgLyBQMTAwMlxuICAvLyAtIFwiQ2FuJ3QgcmVhY2ggZGF0YWJhc2Ugc2VydmVyXCJcbiAgLy8gLSBcIkVDT05OUkVGVVNFRFwiIC8gXCJFVElNRURPVVRcIiAvIFwiRU5PVEZPVU5EXCJcbiAgcmV0dXJuIChcbiAgICBjb2RlID09PSBcIlAxMDAxXCIgfHxcbiAgICBjb2RlID09PSBcIlAxMDAyXCIgfHxcbiAgICBtc2cudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImNhbid0IHJlYWNoIGRhdGFiYXNlIHNlcnZlclwiKSB8fFxuICAgIG1zZy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiY2FudCByZWFjaCBkYXRhYmFzZSBzZXJ2ZXJcIikgfHxcbiAgICBtc2cudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImVjb25ucmVmdXNlZFwiKSB8fFxuICAgIG1zZy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZXRpbWVkb3V0XCIpIHx8XG4gICAgbXNnLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlbm90Zm91bmRcIikgfHxcbiAgICBtc2cudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImNvbm5lY3Rpb24gdGVybWluYXRlZFwiKVxuICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiB3aXRoRGJSZXRyaWVzPFQ+KGZuOiAoKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XG4gIC8vIFNob3J0LCBib3VuZGVkIHJldHJ5IHdpdGggaml0dGVyLWxpa2UgaW5jcmVhc2luZyBkZWxheXMuXG4gIGNvbnN0IGRlbGF5cyA9IFswLCAxMjAsIDMwMF07XG4gIGxldCBsYXN0RXJyOiB1bmtub3duO1xuICBmb3IgKGxldCBhdHRlbXB0ID0gMDsgYXR0ZW1wdCA8IGRlbGF5cy5sZW5ndGg7IGF0dGVtcHQrKykge1xuICAgIGlmIChkZWxheXNbYXR0ZW1wdF0gPiAwKSBhd2FpdCBzbGVlcChkZWxheXNbYXR0ZW1wdF0pO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgZm4oKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxhc3RFcnIgPSBlcnI7XG4gICAgICBpZiAoIWlzTGlrZWx5RGJDb25uZWN0aXZpdHlFcnJvcihlcnIpIHx8IGF0dGVtcHQgPT09IGRlbGF5cy5sZW5ndGggLSAxKSB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG4gIHRocm93IGxhc3RFcnI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkYkhlYWx0aENoZWNrKCk6IFByb21pc2U8RGJIZWFsdGhSZXN1bHQ+IHtcbiAgaWYgKGlzRGV2Tm9EYigpKSByZXR1cm4geyBvazogdHJ1ZSwgbGF0ZW5jeU1zOiAwIH07XG4gIGlmICghaGFzRGJFbnYoKSkgcmV0dXJuIHsgb2s6IGZhbHNlLCBsYXRlbmN5TXM6IDAsIGVycm9yOiBcIk1pc3NpbmcgREFUQUJBU0VfVVJMXCIgfTtcblxuICBjb25zdCBzdGFydGVkID0gRGF0ZS5ub3coKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuXG4gICAgY29uc3QgdGltZW91dE1zID0gTnVtYmVyKHByb2Nlc3MuZW52LkRCX0hFQUxUSENIRUNLX1RJTUVPVVRfTVMgfHwgXCIxMjAwXCIpIHx8IDEyMDA7XG4gICAgYXdhaXQgd2l0aERiUmV0cmllcyhhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgICAgICBwcmlzbWEuJHF1ZXJ5UmF3YFNFTEVDVCAxYCxcbiAgICAgICAgbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4gc2V0VGltZW91dCgoKSA9PiByZWplY3QobmV3IEVycm9yKFwiREIgaGVhbHRoY2hlY2sgdGltZW91dFwiKSksIHRpbWVvdXRNcykpLFxuICAgICAgXSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBvazogdHJ1ZSwgbGF0ZW5jeU1zOiBEYXRlLm5vdygpIC0gc3RhcnRlZCB9O1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGNvbnN0IG1zZyA9IFN0cmluZyhlcnI/Lm1lc3NhZ2UgfHwgXCJEQiBoZWFsdGhjaGVjayBmYWlsZWRcIik7XG4gICAgcmV0dXJuIHsgb2s6IGZhbHNlLCBsYXRlbmN5TXM6IERhdGUubm93KCkgLSBzdGFydGVkLCBlcnJvcjogbXNnIH07XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFzc2VydERiSGVhbHRoeU9yVGhyb3coKSB7XG4gIGNvbnN0IGhlYWx0aCA9IGF3YWl0IGRiSGVhbHRoQ2hlY2soKTtcbiAgaWYgKCFoZWFsdGgub2spIHtcbiAgICB0aHJvdyBuZXcgRGJVbmF2YWlsYWJsZUVycm9yKGhlYWx0aC5lcnJvciB8fCBcIkRhdGFiYXNlIGlzIGN1cnJlbnRseSB1bmF2YWlsYWJsZVwiKTtcbiAgfVxuICByZXR1cm4gaGVhbHRoO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNEZXZOb0RiKCkge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuREVWX05PX0RCID09PSBcInRydWVcIiB8fCAhaGFzRGJFbnYoKTtcbn1cblxudHlwZSBEYkFkYXB0ZXIgPSB7XG4gIGNyZWF0ZURpYWdub3N0aWNzQm9va2luZyhpbnB1dDogQ3JlYXRlRGlhZ25vc3RpY3NCb29raW5nSW5wdXQpOiBQcm9taXNlPEJvb2tpbmdSZWNvcmQ+O1xuICBjcmVhdGVRdW90ZVJlcXVlc3QoaW5wdXQ6IENyZWF0ZVF1b3RlUmVxdWVzdElucHV0KTogUHJvbWlzZTxRdW90ZVJlcXVlc3RSZWNvcmQ+O1xuICBjcmVhdGVKb2IoaW5wdXQ6IENyZWF0ZUpvYklucHV0KTogUHJvbWlzZTxKb2JSZWNvcmQ+O1xuICBsaXN0Sm9icyhsaW1pdDogbnVtYmVyKTogUHJvbWlzZTxKb2JSZWNvcmRbXT47XG4gIHVwZGF0ZUpvYlN0YXR1cyh3aGVyZTogeyBpZDogc3RyaW5nIH0sIGlucHV0OiB7IHN0YXR1czogSm9iU3RhdHVzIH0pOiBQcm9taXNlPEpvYlJlY29yZD47XG4gIGdldEpvYkJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8Sm9iUmVjb3JkIHwgbnVsbD47XG4gIHVwZGF0ZVF1b3RlUmVxdWVzdFN0YXR1cyh3aGVyZTogeyBpZDogc3RyaW5nIH0sIGlucHV0OiB7IHN0YXR1czogUXVvdGVSZXF1ZXN0U3RhdHVzIH0pOiBQcm9taXNlPFF1b3RlUmVxdWVzdFJlY29yZD47XG4gIHVwZGF0ZUJvb2tpbmdTdHJpcGVTZXNzaW9uKHdoZXJlOiB7IGlkOiBzdHJpbmcgfSwgaW5wdXQ6IHsgc3RyaXBlU2Vzc2lvbklkOiBzdHJpbmcgfCBudWxsIH0pOiBQcm9taXNlPEJvb2tpbmdSZWNvcmQ+O1xuICB1cGRhdGVCb29raW5nU3RhdHVzKHdoZXJlOiB7IGlkOiBzdHJpbmcgfSwgaW5wdXQ6IHsgc3RhdHVzOiBCb29raW5nU3RhdHVzIH0pOiBQcm9taXNlPEJvb2tpbmdSZWNvcmQ+O1xuICBnZXRCb29raW5nQnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxCb29raW5nUmVjb3JkIHwgbnVsbD47XG4gIGxpc3RCb29raW5ncyhsaW1pdDogbnVtYmVyKTogUHJvbWlzZTxCb29raW5nUmVjb3JkW10+O1xuICBsaXN0UXVvdGVSZXF1ZXN0cyhsaW1pdDogbnVtYmVyKTogUHJvbWlzZTxRdW90ZVJlcXVlc3RSZWNvcmRbXT47XG4gIGV4cGlyZVBlbmRpbmdCb29raW5ncyhub3c6IERhdGUpOiBQcm9taXNlPG51bWJlcj47XG4gIGNyZWF0ZUlkZW1wb3RlbmN5S2V5T25jZShpbnB1dDoge1xuICAgIHNjb3BlOiBzdHJpbmc7XG4gICAga2V5OiBzdHJpbmc7XG4gICAgcmVxdWVzdEhhc2g/OiBzdHJpbmcgfCBudWxsO1xuICAgIHJlc3BvbnNlSnNvbj86IGFueTtcbiAgfSk6IFByb21pc2U8eyBjcmVhdGVkOiBib29sZWFuIH0+O1xuXG4gIGNyZWF0ZU9yR2V0U2VydmljZVJlcG9ydEZvckJvb2tpbmcoaW5wdXQ6IHsgYm9va2luZ0lkOiBzdHJpbmc7IHR5cGU6IFNlcnZpY2VSZXBvcnRUeXBlIH0pOiBQcm9taXNlPFNlcnZpY2VSZXBvcnRSZWNvcmQ+O1xuICB1cGRhdGVTZXJ2aWNlUmVwb3J0RGF0YSh3aGVyZTogeyBpZDogc3RyaW5nIH0sIGlucHV0OiB7IHN0YXR1cz86IFNlcnZpY2VSZXBvcnRTdGF0dXM7IGRhdGFKc29uOiBhbnkgfSk6IFByb21pc2U8U2VydmljZVJlcG9ydFJlY29yZD47XG4gIG1hcmtTZXJ2aWNlUmVwb3J0RW1haWxlZCh3aGVyZTogeyBpZDogc3RyaW5nIH0sIGlucHV0OiB7IGVtYWlsZWRBdDogRGF0ZSB9KTogUHJvbWlzZTxTZXJ2aWNlUmVwb3J0UmVjb3JkPjtcbiAgZ2V0U2VydmljZVJlcG9ydEJ5UHVibGljVG9rZW4odG9rZW46IHN0cmluZyk6IFByb21pc2U8U2VydmljZVJlcG9ydFJlY29yZCB8IG51bGw+O1xufTtcblxuZGVjbGFyZSBnbG9iYWwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG4gIHZhciBfX2Rldk5vRGJTdG9yZTpcbiAgICB8IHtcbiAgICAgICAgYm9va2luZ3M6IE1hcDxzdHJpbmcsIEJvb2tpbmdSZWNvcmQ+O1xuICAgICAgICBxdW90ZVJlcXVlc3RzOiBNYXA8c3RyaW5nLCBRdW90ZVJlcXVlc3RSZWNvcmQ+O1xuICAgICAgICBqb2JzOiBNYXA8c3RyaW5nLCBKb2JSZWNvcmQ+O1xuICAgICAgICBzZXJ2aWNlUmVwb3J0czogTWFwPHN0cmluZywgU2VydmljZVJlcG9ydFJlY29yZD47XG4gICAgICAgIGlkZW1wb3RlbmN5OiBNYXA8c3RyaW5nLCB7IHNjb3BlOiBzdHJpbmc7IGtleTogc3RyaW5nOyBjcmVhdGVkQXQ6IERhdGUgfT47XG4gICAgICB9XG4gICAgfCB1bmRlZmluZWQ7XG59XG5cbmNvbnN0IG1lbSA9XG4gIGdsb2JhbC5fX2Rldk5vRGJTdG9yZSB8fFxuICAoZ2xvYmFsLl9fZGV2Tm9EYlN0b3JlID0ge1xuICAgIGJvb2tpbmdzOiBuZXcgTWFwPHN0cmluZywgQm9va2luZ1JlY29yZD4oKSxcbiAgICBxdW90ZVJlcXVlc3RzOiBuZXcgTWFwPHN0cmluZywgUXVvdGVSZXF1ZXN0UmVjb3JkPigpLFxuICAgIGpvYnM6IG5ldyBNYXA8c3RyaW5nLCBKb2JSZWNvcmQ+KCksXG4gICAgc2VydmljZVJlcG9ydHM6IG5ldyBNYXA8c3RyaW5nLCBTZXJ2aWNlUmVwb3J0UmVjb3JkPigpLFxuICAgIGlkZW1wb3RlbmN5OiBuZXcgTWFwPHN0cmluZywgeyBzY29wZTogc3RyaW5nOyBrZXk6IHN0cmluZzsgY3JlYXRlZEF0OiBEYXRlIH0+KCksXG4gIH0pO1xuXG5mdW5jdGlvbiBpZGVtTWFwS2V5KHNjb3BlOiBzdHJpbmcsIGtleTogc3RyaW5nKSB7XG4gIHJldHVybiBgJHtzY29wZX06JHtrZXl9YDtcbn1cblxuZnVuY3Rpb24gcmFuZG9tUHVibGljVG9rZW4oKSB7XG4gIHJldHVybiBjcnlwdG8ucmFuZG9tQnl0ZXMoMjQpLnRvU3RyaW5nKFwiYmFzZTY0dXJsXCIpO1xufVxuXG5jb25zdCBtZW1vcnlBZGFwdGVyOiBEYkFkYXB0ZXIgPSB7XG4gIGFzeW5jIGNyZWF0ZURpYWdub3N0aWNzQm9va2luZyhpbnB1dCkge1xuICAgIGNvbnN0IGlkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHJlYzogQm9va2luZ1JlY29yZCA9IHtcbiAgICAgIGlkLFxuICAgICAgcHVibGljSWQ6IHJhbmRvbVB1YmxpY0lkKFwiYmtcIiksXG4gICAgICBraW5kOiBcIkRJQUdOT1NUSUNTXCIsXG4gICAgICBzdGF0dXM6IFwiUEVORElOR19QQVlNRU5UXCIsXG5cbiAgICAgIGN1c3RvbWVySWQ6IHJhbmRvbVB1YmxpY0lkKFwiY3VzdFwiKSxcbiAgICAgIGFkZHJlc3NJZDogcmFuZG9tUHVibGljSWQoXCJhZGRyXCIpLFxuICAgICAgdmVoaWNsZUlkOiByYW5kb21QdWJsaWNJZChcInZlaFwiKSxcblxuICAgICAgc2xvdFN0YXJ0OiBpbnB1dC5zbG90U3RhcnQsXG4gICAgICBzbG90RW5kOiBpbnB1dC5zbG90RW5kLFxuICAgICAgYWZ0ZXJIb3VyczogaW5wdXQuYWZ0ZXJIb3VycyxcblxuICAgICAgc3ltcHRvbVByZXNldDogaW5wdXQuc3ltcHRvbVByZXNldCA/PyBudWxsLFxuICAgICAgbm90ZXM6IGlucHV0Lm5vdGVzID8/IG51bGwsXG5cbiAgICAgIHByaWNpbmdTbmFwc2hvdEpzb246IGlucHV0LnByaWNpbmdTbmFwc2hvdEpzb24sXG5cbiAgICAgIHN0cmlwZVNlc3Npb25JZDogbnVsbCxcbiAgICAgIHBheW1lbnRFeHBpcmVzQXQ6IGlucHV0LnBheW1lbnRFeHBpcmVzQXQsXG5cbiAgICAgIHNlcnZpY2VNOEpvYklkOiBudWxsLFxuICAgICAgc2VydmljZU04VXJsOiBudWxsLFxuXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgIH07XG4gICAgbWVtLmJvb2tpbmdzLnNldChpZCwgcmVjKTtcbiAgICByZXR1cm4gcmVjO1xuICB9LFxuXG4gIGFzeW5jIGNyZWF0ZUpvYihpbnB1dCkge1xuICAgIGNvbnN0IGlkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHJlYzogSm9iUmVjb3JkID0ge1xuICAgICAgaWQsXG4gICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJqb2JcIiksXG4gICAgICBzdGF0dXM6IChpbnB1dC5zdGF0dXMgPz8gXCJORVdcIikgYXMgYW55LFxuICAgICAgdGl0bGU6IGlucHV0LnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IGlucHV0LmRlc2NyaXB0aW9uID8/IG51bGwsXG4gICAgICBpbnRlcm5hbE5vdGVzOiBpbnB1dC5pbnRlcm5hbE5vdGVzID8/IG51bGwsXG4gICAgICBjdXN0b21lcklkOiByYW5kb21QdWJsaWNJZChcImN1c3RcIiksXG4gICAgICBhZGRyZXNzSWQ6IHJhbmRvbVB1YmxpY0lkKFwiYWRkclwiKSxcbiAgICAgIHZlaGljbGVJZDogaW5wdXQudmVoaWNsZSA/IHJhbmRvbVB1YmxpY0lkKFwidmVoXCIpIDogbnVsbCxcbiAgICAgIHF1b3RlUmVxdWVzdElkOiBudWxsLFxuICAgICAgYm9va2luZ0lkOiBudWxsLFxuICAgICAgc2NoZWR1bGVkU3RhcnQ6IG51bGwsXG4gICAgICBzY2hlZHVsZWRFbmQ6IG51bGwsXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgIH07XG4gICAgbWVtLmpvYnMuc2V0KGlkLCByZWMpO1xuICAgIHJldHVybiByZWM7XG4gIH0sXG5cbiAgYXN5bmMgbGlzdEpvYnMobGltaXQpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShtZW0uam9icy52YWx1ZXMoKSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNyZWF0ZWRBdC5nZXRUaW1lKCkgLSBhLmNyZWF0ZWRBdC5nZXRUaW1lKCkpXG4gICAgICAuc2xpY2UoMCwgbGltaXQpO1xuICB9LFxuXG4gIGFzeW5jIHVwZGF0ZUpvYlN0YXR1cyh3aGVyZSwgaW5wdXQpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IG1lbS5qb2JzLmdldCh3aGVyZS5pZCk7XG4gICAgaWYgKCFleGlzdGluZykgdGhyb3cgbmV3IEVycm9yKFwiSm9iIG5vdCBmb3VuZFwiKTtcbiAgICBjb25zdCB1cGRhdGVkOiBKb2JSZWNvcmQgPSB7XG4gICAgICAuLi5leGlzdGluZyxcbiAgICAgIHN0YXR1czogaW5wdXQuc3RhdHVzLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIH07XG4gICAgbWVtLmpvYnMuc2V0KHdoZXJlLmlkLCB1cGRhdGVkKTtcbiAgICByZXR1cm4gdXBkYXRlZDtcbiAgfSxcblxuICBhc3luYyBnZXRKb2JCeUlkKGlkKSB7XG4gICAgcmV0dXJuIG1lbS5qb2JzLmdldChpZCkgPz8gbnVsbDtcbiAgfSxcblxuICBhc3luYyBjcmVhdGVRdW90ZVJlcXVlc3QoaW5wdXQpIHtcbiAgICBjb25zdCBpZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCByZWM6IFF1b3RlUmVxdWVzdFJlY29yZCA9IHtcbiAgICAgIGlkLFxuICAgICAgcHVibGljSWQ6IHJhbmRvbVB1YmxpY0lkKFwicXJcIiksXG4gICAgICBzdGF0dXM6IFwiTkVXXCIsXG4gICAgICBjYXRlZ29yeTogaW5wdXQuY2F0ZWdvcnksXG4gICAgICB1cmdlbmN5OiBpbnB1dC51cmdlbmN5LFxuXG4gICAgICBjdXN0b21lcklkOiByYW5kb21QdWJsaWNJZChcImN1c3RcIiksXG4gICAgICBhZGRyZXNzSWQ6IHJhbmRvbVB1YmxpY0lkKFwiYWRkclwiKSxcbiAgICAgIHZlaGljbGVJZDogcmFuZG9tUHVibGljSWQoXCJ2ZWhcIiksXG5cbiAgICAgIHN5bXB0b21zOiBpbnB1dC5zeW1wdG9tcyxcbiAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dC5kZXNjcmlwdGlvbixcbiAgICAgIHByaWNpbmdTbmFwc2hvdEpzb246IGlucHV0LnByaWNpbmdTbmFwc2hvdEpzb24sXG5cbiAgICAgIHNlcnZpY2VNOEpvYklkOiBudWxsLFxuICAgICAgc2VydmljZU04VXJsOiBudWxsLFxuXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgIH07XG4gICAgbWVtLnF1b3RlUmVxdWVzdHMuc2V0KGlkLCByZWMpO1xuICAgIHJldHVybiByZWM7XG4gIH0sXG5cbiAgYXN5bmMgdXBkYXRlUXVvdGVSZXF1ZXN0U3RhdHVzKHdoZXJlLCBpbnB1dCkge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gbWVtLnF1b3RlUmVxdWVzdHMuZ2V0KHdoZXJlLmlkKTtcbiAgICBpZiAoIWV4aXN0aW5nKSB0aHJvdyBuZXcgRXJyb3IoXCJRdW90ZSByZXF1ZXN0IG5vdCBmb3VuZFwiKTtcbiAgICBjb25zdCB1cGRhdGVkOiBRdW90ZVJlcXVlc3RSZWNvcmQgPSB7XG4gICAgICAuLi5leGlzdGluZyxcbiAgICAgIHN0YXR1czogaW5wdXQuc3RhdHVzLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIH07XG4gICAgbWVtLnF1b3RlUmVxdWVzdHMuc2V0KHdoZXJlLmlkLCB1cGRhdGVkKTtcbiAgICByZXR1cm4gdXBkYXRlZDtcbiAgfSxcblxuICBhc3luYyBsaXN0UXVvdGVSZXF1ZXN0cyhsaW1pdCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKG1lbS5xdW90ZVJlcXVlc3RzLnZhbHVlcygpKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY3JlYXRlZEF0LmdldFRpbWUoKSAtIGEuY3JlYXRlZEF0LmdldFRpbWUoKSlcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XG4gIH0sXG5cbiAgYXN5bmMgdXBkYXRlQm9va2luZ1N0YXR1cyh3aGVyZSwgaW5wdXQpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IG1lbS5ib29raW5ncy5nZXQod2hlcmUuaWQpO1xuICAgIGlmICghZXhpc3RpbmcpIHRocm93IG5ldyBFcnJvcihcIkJvb2tpbmcgbm90IGZvdW5kXCIpO1xuICAgIGNvbnN0IHVwZGF0ZWQ6IEJvb2tpbmdSZWNvcmQgPSB7XG4gICAgICAuLi5leGlzdGluZyxcbiAgICAgIHN0YXR1czogaW5wdXQuc3RhdHVzLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIH07XG4gICAgbWVtLmJvb2tpbmdzLnNldCh3aGVyZS5pZCwgdXBkYXRlZCk7XG4gICAgcmV0dXJuIHVwZGF0ZWQ7XG4gIH0sXG5cbiAgYXN5bmMgdXBkYXRlQm9va2luZ1N0cmlwZVNlc3Npb24od2hlcmUsIGlucHV0KSB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBtZW0uYm9va2luZ3MuZ2V0KHdoZXJlLmlkKTtcbiAgICBpZiAoIWV4aXN0aW5nKSB0aHJvdyBuZXcgRXJyb3IoXCJCb29raW5nIG5vdCBmb3VuZFwiKTtcbiAgICBjb25zdCB1cGRhdGVkOiBCb29raW5nUmVjb3JkID0ge1xuICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICBzdHJpcGVTZXNzaW9uSWQ6IGlucHV0LnN0cmlwZVNlc3Npb25JZCxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9O1xuICAgIG1lbS5ib29raW5ncy5zZXQod2hlcmUuaWQsIHVwZGF0ZWQpO1xuICAgIHJldHVybiB1cGRhdGVkO1xuICB9LFxuXG4gIGFzeW5jIGdldEJvb2tpbmdCeUlkKGlkKSB7XG4gICAgcmV0dXJuIG1lbS5ib29raW5ncy5nZXQoaWQpID8/IG51bGw7XG4gIH0sXG5cbiAgYXN5bmMgbGlzdEJvb2tpbmdzKGxpbWl0KSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20obWVtLmJvb2tpbmdzLnZhbHVlcygpKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY3JlYXRlZEF0LmdldFRpbWUoKSAtIGEuY3JlYXRlZEF0LmdldFRpbWUoKSlcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XG4gIH0sXG5cbiAgYXN5bmMgZXhwaXJlUGVuZGluZ0Jvb2tpbmdzKG5vdykge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgZm9yIChjb25zdCBiIG9mIG1lbS5ib29raW5ncy52YWx1ZXMoKSkge1xuICAgICAgaWYgKGIuc3RhdHVzID09PSBcIlBFTkRJTkdfUEFZTUVOVFwiICYmIGIucGF5bWVudEV4cGlyZXNBdCAmJiBiLnBheW1lbnRFeHBpcmVzQXQuZ2V0VGltZSgpIDw9IG5vdy5nZXRUaW1lKCkpIHtcbiAgICAgICAgbWVtLmJvb2tpbmdzLnNldChiLmlkLCB7IC4uLmIsIHN0YXR1czogXCJFWFBJUkVEXCIsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KTtcbiAgICAgICAgY291bnQrKztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNvdW50O1xuICB9LFxuXG4gIGFzeW5jIGNyZWF0ZUlkZW1wb3RlbmN5S2V5T25jZShpbnB1dCkge1xuICAgIGNvbnN0IGsgPSBpZGVtTWFwS2V5KGlucHV0LnNjb3BlLCBpbnB1dC5rZXkpO1xuICAgIGlmIChtZW0uaWRlbXBvdGVuY3kuaGFzKGspKSByZXR1cm4geyBjcmVhdGVkOiBmYWxzZSB9O1xuICAgIG1lbS5pZGVtcG90ZW5jeS5zZXQoaywgeyBzY29wZTogaW5wdXQuc2NvcGUsIGtleTogaW5wdXQua2V5LCBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkgfSk7XG4gICAgcmV0dXJuIHsgY3JlYXRlZDogdHJ1ZSB9O1xuICB9LFxuXG4gIGFzeW5jIGNyZWF0ZU9yR2V0U2VydmljZVJlcG9ydEZvckJvb2tpbmcoaW5wdXQpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IEFycmF5LmZyb20obWVtLnNlcnZpY2VSZXBvcnRzLnZhbHVlcygpKS5maW5kKChyKSA9PiByLmJvb2tpbmdJZCA9PT0gaW5wdXQuYm9va2luZ0lkICYmIHIudHlwZSA9PT0gaW5wdXQudHlwZSk7XG4gICAgaWYgKGV4aXN0aW5nKSByZXR1cm4gZXhpc3Rpbmc7XG4gICAgY29uc3QgaWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgcmVjOiBTZXJ2aWNlUmVwb3J0UmVjb3JkID0ge1xuICAgICAgaWQsXG4gICAgICBib29raW5nSWQ6IGlucHV0LmJvb2tpbmdJZCxcbiAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICBzdGF0dXM6IFwiRFJBRlRcIixcbiAgICAgIGRhdGFKc29uOiB7XG4gICAgICAgIHZlcnNpb246IDEsXG4gICAgICAgIHR5cGU6IGlucHV0LnR5cGUsXG4gICAgICAgIHRpdGxlOiBpbnB1dC50eXBlID09PSBcIkRJQUdOT1NUSUNTXCIgPyBcIkRpYWdub3N0aWNzIFJlcG9ydFwiIDogXCJQcmUtUHVyY2hhc2UgSW5zcGVjdGlvbiBSZXBvcnRcIixcbiAgICAgICAgc3VtbWFyeTogXCJcIixcbiAgICAgICAgY29udGVudE1hcmtkb3duOiBcIlwiLFxuICAgICAgICBhdHRhY2htZW50czogW10sXG4gICAgICB9LFxuICAgICAgcHVibGljVG9rZW46IHJhbmRvbVB1YmxpY1Rva2VuKCksXG4gICAgICBlbWFpbGVkQXQ6IG51bGwsXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgIH07XG4gICAgbWVtLnNlcnZpY2VSZXBvcnRzLnNldChpZCwgcmVjKTtcbiAgICByZXR1cm4gcmVjO1xuICB9LFxuXG4gIGFzeW5jIHVwZGF0ZVNlcnZpY2VSZXBvcnREYXRhKHdoZXJlLCBpbnB1dCkge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gbWVtLnNlcnZpY2VSZXBvcnRzLmdldCh3aGVyZS5pZCk7XG4gICAgaWYgKCFleGlzdGluZykgdGhyb3cgbmV3IEVycm9yKFwiU2VydmljZSByZXBvcnQgbm90IGZvdW5kXCIpO1xuICAgIGNvbnN0IHVwZGF0ZWQ6IFNlcnZpY2VSZXBvcnRSZWNvcmQgPSB7XG4gICAgICAuLi5leGlzdGluZyxcbiAgICAgIHN0YXR1czogaW5wdXQuc3RhdHVzID8/IGV4aXN0aW5nLnN0YXR1cyxcbiAgICAgIGRhdGFKc29uOiBpbnB1dC5kYXRhSnNvbixcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9O1xuICAgIG1lbS5zZXJ2aWNlUmVwb3J0cy5zZXQod2hlcmUuaWQsIHVwZGF0ZWQpO1xuICAgIHJldHVybiB1cGRhdGVkO1xuICB9LFxuXG4gIGFzeW5jIG1hcmtTZXJ2aWNlUmVwb3J0RW1haWxlZCh3aGVyZSwgaW5wdXQpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IG1lbS5zZXJ2aWNlUmVwb3J0cy5nZXQod2hlcmUuaWQpO1xuICAgIGlmICghZXhpc3RpbmcpIHRocm93IG5ldyBFcnJvcihcIlNlcnZpY2UgcmVwb3J0IG5vdCBmb3VuZFwiKTtcbiAgICBjb25zdCB1cGRhdGVkOiBTZXJ2aWNlUmVwb3J0UmVjb3JkID0ge1xuICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICBlbWFpbGVkQXQ6IGlucHV0LmVtYWlsZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9O1xuICAgIG1lbS5zZXJ2aWNlUmVwb3J0cy5zZXQod2hlcmUuaWQsIHVwZGF0ZWQpO1xuICAgIHJldHVybiB1cGRhdGVkO1xuICB9LFxuXG4gIGFzeW5jIGdldFNlcnZpY2VSZXBvcnRCeVB1YmxpY1Rva2VuKHRva2VuKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20obWVtLnNlcnZpY2VSZXBvcnRzLnZhbHVlcygpKS5maW5kKChyKSA9PiByLnB1YmxpY1Rva2VuID09PSB0b2tlbikgPz8gbnVsbDtcbiAgfSxcbn07XG5cbmNvbnN0IHByaXNtYUFkYXB0ZXI6IERiQWRhcHRlciA9IHtcbiAgYXN5bmMgY3JlYXRlRGlhZ25vc3RpY3NCb29raW5nKGlucHV0KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCBib29raW5nID0gYXdhaXQgKHByaXNtYSBhcyBhbnkpLiR0cmFuc2FjdGlvbihhc3luYyAodHg6IGFueSkgPT4ge1xuICAgICAgY29uc3QgZW1haWwgPSAoaW5wdXQuY3VzdG9tZXIuZW1haWwgPz8gXCJcIikudHJpbSgpLnRvTG93ZXJDYXNlKCkgfHwgbnVsbDtcbiAgICAgIGNvbnN0IHBob25lID0gKGlucHV0LmN1c3RvbWVyLnBob25lID8/IFwiXCIpLnRyaW0oKSB8fCBudWxsO1xuXG4gICAgICBjb25zdCBleGlzdGluZ0N1c3RvbWVyID0gYXdhaXQgdHguY3VzdG9tZXIuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgLi4uKGVtYWlsID8gW3sgZW1haWwgfV0gOiBbXSksXG4gICAgICAgICAgICAuLi4ocGhvbmUgPyBbeyBwaG9uZSB9XSA6IFtdKSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGN1c3RvbWVyID1cbiAgICAgICAgZXhpc3RpbmdDdXN0b21lciA/P1xuICAgICAgICAoYXdhaXQgdHguY3VzdG9tZXIuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJjdXN0XCIpLFxuICAgICAgICAgICAgZnVsbE5hbWU6IGlucHV0LmN1c3RvbWVyLmZ1bGxOYW1lLFxuICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICBwaG9uZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSk7XG5cbiAgICAgIGNvbnN0IGFkZHJlc3MgPSBhd2FpdCB0eC5hZGRyZXNzLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJhZGRyXCIpLFxuICAgICAgICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVyLmlkLFxuICAgICAgICAgIGxpbmUxOiBpbnB1dC5hZGRyZXNzLmxpbmUxLFxuICAgICAgICAgIHN1YnVyYjogaW5wdXQuYWRkcmVzcy5zdWJ1cmIsXG4gICAgICAgICAgY2l0eTogaW5wdXQuYWRkcmVzcy5jaXR5LFxuICAgICAgICAgIHBvc3Rjb2RlOiBpbnB1dC5hZGRyZXNzLnBvc3Rjb2RlID8/IG51bGwsXG4gICAgICAgICAgbGF0OiBpbnB1dC5hZGRyZXNzLmxhdCA/PyBudWxsLFxuICAgICAgICAgIGxuZzogaW5wdXQuYWRkcmVzcy5sbmcgPz8gbnVsbCxcbiAgICAgICAgICB0cmF2ZWxCYW5kOiBpbnB1dC5hZGRyZXNzLnRyYXZlbEJhbmQgPz8gbnVsbCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2ZWhpY2xlID0gYXdhaXQgdHgudmVoaWNsZS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgcHVibGljSWQ6IHJhbmRvbVB1YmxpY0lkKFwidmVoXCIpLFxuICAgICAgICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVyLmlkLFxuICAgICAgICAgIHBsYXRlOiBpbnB1dC52ZWhpY2xlLnBsYXRlID8/IG51bGwsXG4gICAgICAgICAgbWFrZTogaW5wdXQudmVoaWNsZS5tYWtlID8/IG51bGwsXG4gICAgICAgICAgbW9kZWw6IGlucHV0LnZlaGljbGUubW9kZWwgPz8gbnVsbCxcbiAgICAgICAgICB5ZWFyOiBpbnB1dC52ZWhpY2xlLnllYXIgPz8gbnVsbCxcbiAgICAgICAgICBmdWVsOiBpbnB1dC52ZWhpY2xlLmZ1ZWwgPz8gbnVsbCxcbiAgICAgICAgICBvZG9tZXRlcjogaW5wdXQudmVoaWNsZS5vZG9tZXRlciA/PyBudWxsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0eC5ib29raW5nLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJia1wiKSxcbiAgICAgICAgICBraW5kOiBcIkRJQUdOT1NUSUNTXCIsXG4gICAgICAgICAgc3RhdHVzOiBcIlBFTkRJTkdfUEFZTUVOVFwiLFxuICAgICAgICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVyLmlkLFxuICAgICAgICAgIGFkZHJlc3NJZDogYWRkcmVzcy5pZCxcbiAgICAgICAgICB2ZWhpY2xlSWQ6IHZlaGljbGUuaWQsXG4gICAgICAgICAgc2xvdFN0YXJ0OiBpbnB1dC5zbG90U3RhcnQsXG4gICAgICAgICAgc2xvdEVuZDogaW5wdXQuc2xvdEVuZCxcbiAgICAgICAgICBhZnRlckhvdXJzOiBpbnB1dC5hZnRlckhvdXJzLFxuICAgICAgICAgIHN5bXB0b21QcmVzZXQ6IGlucHV0LnN5bXB0b21QcmVzZXQgPz8gbnVsbCxcbiAgICAgICAgICBub3RlczogaW5wdXQubm90ZXMgPz8gbnVsbCxcbiAgICAgICAgICBwcmljaW5nU25hcHNob3RKc29uOiBpbnB1dC5wcmljaW5nU25hcHNob3RKc29uLFxuICAgICAgICAgIHBheW1lbnRFeHBpcmVzQXQ6IGlucHV0LnBheW1lbnRFeHBpcmVzQXQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBib29raW5nIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyBjcmVhdGVRdW90ZVJlcXVlc3QoaW5wdXQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIGNvbnN0IHF1b3RlID0gYXdhaXQgKHByaXNtYSBhcyBhbnkpLiR0cmFuc2FjdGlvbihhc3luYyAodHg6IGFueSkgPT4ge1xuICAgICAgY29uc3QgZW1haWwgPSAoaW5wdXQuY3VzdG9tZXIuZW1haWwgPz8gXCJcIikudHJpbSgpLnRvTG93ZXJDYXNlKCkgfHwgbnVsbDtcbiAgICAgIGNvbnN0IHBob25lID0gKGlucHV0LmN1c3RvbWVyLnBob25lID8/IFwiXCIpLnRyaW0oKSB8fCBudWxsO1xuXG4gICAgICBjb25zdCBleGlzdGluZ0N1c3RvbWVyID0gYXdhaXQgdHguY3VzdG9tZXIuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgLi4uKGVtYWlsID8gW3sgZW1haWwgfV0gOiBbXSksXG4gICAgICAgICAgICAuLi4ocGhvbmUgPyBbeyBwaG9uZSB9XSA6IFtdKSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGN1c3RvbWVyID1cbiAgICAgICAgZXhpc3RpbmdDdXN0b21lciA/P1xuICAgICAgICAoYXdhaXQgdHguY3VzdG9tZXIuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJjdXN0XCIpLFxuICAgICAgICAgICAgZnVsbE5hbWU6IGlucHV0LmN1c3RvbWVyLmZ1bGxOYW1lLFxuICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICBwaG9uZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSk7XG5cbiAgICAgIGNvbnN0IGFkZHJlc3MgPSBhd2FpdCB0eC5hZGRyZXNzLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJhZGRyXCIpLFxuICAgICAgICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVyLmlkLFxuICAgICAgICAgIGxpbmUxOiBpbnB1dC5hZGRyZXNzLmxpbmUxLFxuICAgICAgICAgIHN1YnVyYjogaW5wdXQuYWRkcmVzcy5zdWJ1cmIsXG4gICAgICAgICAgY2l0eTogaW5wdXQuYWRkcmVzcy5jaXR5LFxuICAgICAgICAgIHBvc3Rjb2RlOiBpbnB1dC5hZGRyZXNzLnBvc3Rjb2RlID8/IG51bGwsXG4gICAgICAgICAgbGF0OiBpbnB1dC5hZGRyZXNzLmxhdCA/PyBudWxsLFxuICAgICAgICAgIGxuZzogaW5wdXQuYWRkcmVzcy5sbmcgPz8gbnVsbCxcbiAgICAgICAgICB0cmF2ZWxCYW5kOiBpbnB1dC5hZGRyZXNzLnRyYXZlbEJhbmQgPz8gbnVsbCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2ZWhpY2xlID0gYXdhaXQgdHgudmVoaWNsZS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgcHVibGljSWQ6IHJhbmRvbVB1YmxpY0lkKFwidmVoXCIpLFxuICAgICAgICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVyLmlkLFxuICAgICAgICAgIHBsYXRlOiBpbnB1dC52ZWhpY2xlLnBsYXRlID8/IG51bGwsXG4gICAgICAgICAgbWFrZTogaW5wdXQudmVoaWNsZS5tYWtlID8/IG51bGwsXG4gICAgICAgICAgbW9kZWw6IGlucHV0LnZlaGljbGUubW9kZWwgPz8gbnVsbCxcbiAgICAgICAgICB5ZWFyOiBpbnB1dC52ZWhpY2xlLnllYXIgPz8gbnVsbCxcbiAgICAgICAgICBmdWVsOiBpbnB1dC52ZWhpY2xlLmZ1ZWwgPz8gbnVsbCxcbiAgICAgICAgICBvZG9tZXRlcjogaW5wdXQudmVoaWNsZS5vZG9tZXRlciA/PyBudWxsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0eC5xdW90ZVJlcXVlc3QuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHB1YmxpY0lkOiByYW5kb21QdWJsaWNJZChcInFyXCIpLFxuICAgICAgICAgIHN0YXR1czogXCJORVdcIixcbiAgICAgICAgICBjYXRlZ29yeTogaW5wdXQuY2F0ZWdvcnksXG4gICAgICAgICAgdXJnZW5jeTogaW5wdXQudXJnZW5jeSxcbiAgICAgICAgICBjdXN0b21lcklkOiBjdXN0b21lci5pZCxcbiAgICAgICAgICBhZGRyZXNzSWQ6IGFkZHJlc3MuaWQsXG4gICAgICAgICAgdmVoaWNsZUlkOiB2ZWhpY2xlLmlkLFxuICAgICAgICAgIHN5bXB0b21zOiBpbnB1dC5zeW1wdG9tcyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24sXG4gICAgICAgICAgcHJpY2luZ1NuYXBzaG90SnNvbjogaW5wdXQucHJpY2luZ1NuYXBzaG90SnNvbixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBxdW90ZSBhcyBhbnk7XG4gIH0sXG5cbiAgYXN5bmMgY3JlYXRlSm9iKGlucHV0KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCBqb2IgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuJHRyYW5zYWN0aW9uKGFzeW5jICh0eDogYW55KSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9IChpbnB1dC5jdXN0b21lci5lbWFpbCA/PyBcIlwiKS50cmltKCkudG9Mb3dlckNhc2UoKSB8fCBudWxsO1xuICAgICAgY29uc3QgcGhvbmUgPSAoaW5wdXQuY3VzdG9tZXIucGhvbmUgPz8gXCJcIikudHJpbSgpIHx8IG51bGw7XG5cbiAgICAgIGNvbnN0IGV4aXN0aW5nQ3VzdG9tZXIgPSBhd2FpdCB0eC5jdXN0b21lci5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAuLi4oZW1haWwgPyBbeyBlbWFpbCB9XSA6IFtdKSxcbiAgICAgICAgICAgIC4uLihwaG9uZSA/IFt7IHBob25lIH1dIDogW10pLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3VzdG9tZXIgPVxuICAgICAgICBleGlzdGluZ0N1c3RvbWVyID8/XG4gICAgICAgIChhd2FpdCB0eC5jdXN0b21lci5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHB1YmxpY0lkOiByYW5kb21QdWJsaWNJZChcImN1c3RcIiksXG4gICAgICAgICAgICBmdWxsTmFtZTogaW5wdXQuY3VzdG9tZXIuZnVsbE5hbWUsXG4gICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pKTtcblxuICAgICAgY29uc3QgYWRkcmVzcyA9IGF3YWl0IHR4LmFkZHJlc3MuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHB1YmxpY0lkOiByYW5kb21QdWJsaWNJZChcImFkZHJcIiksXG4gICAgICAgICAgY3VzdG9tZXJJZDogY3VzdG9tZXIuaWQsXG4gICAgICAgICAgbGluZTE6IGlucHV0LmFkZHJlc3MubGluZTEsXG4gICAgICAgICAgc3VidXJiOiBpbnB1dC5hZGRyZXNzLnN1YnVyYixcbiAgICAgICAgICBjaXR5OiBpbnB1dC5hZGRyZXNzLmNpdHksXG4gICAgICAgICAgcG9zdGNvZGU6IGlucHV0LmFkZHJlc3MucG9zdGNvZGUgPz8gbnVsbCxcbiAgICAgICAgICBsYXQ6IGlucHV0LmFkZHJlc3MubGF0ID8/IG51bGwsXG4gICAgICAgICAgbG5nOiBpbnB1dC5hZGRyZXNzLmxuZyA/PyBudWxsLFxuICAgICAgICAgIHRyYXZlbEJhbmQ6IGlucHV0LmFkZHJlc3MudHJhdmVsQmFuZCA/PyBudWxsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZlaGljbGUgPSBpbnB1dC52ZWhpY2xlXG4gICAgICAgID8gYXdhaXQgdHgudmVoaWNsZS5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBwdWJsaWNJZDogcmFuZG9tUHVibGljSWQoXCJ2ZWhcIiksXG4gICAgICAgICAgICAgIGN1c3RvbWVySWQ6IGN1c3RvbWVyLmlkLFxuICAgICAgICAgICAgICBwbGF0ZTogaW5wdXQudmVoaWNsZS5wbGF0ZSA/PyBudWxsLFxuICAgICAgICAgICAgICBtYWtlOiBpbnB1dC52ZWhpY2xlLm1ha2UgPz8gbnVsbCxcbiAgICAgICAgICAgICAgbW9kZWw6IGlucHV0LnZlaGljbGUubW9kZWwgPz8gbnVsbCxcbiAgICAgICAgICAgICAgeWVhcjogaW5wdXQudmVoaWNsZS55ZWFyID8/IG51bGwsXG4gICAgICAgICAgICAgIGZ1ZWw6IGlucHV0LnZlaGljbGUuZnVlbCA/PyBudWxsLFxuICAgICAgICAgICAgICBvZG9tZXRlcjogaW5wdXQudmVoaWNsZS5vZG9tZXRlciA/PyBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICA6IG51bGw7XG5cbiAgICAgIHJldHVybiB0eC5qb2IuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHB1YmxpY0lkOiByYW5kb21QdWJsaWNJZChcImpvYlwiKSxcbiAgICAgICAgICBzdGF0dXM6IChpbnB1dC5zdGF0dXMgPz8gXCJORVdcIikgYXMgYW55LFxuICAgICAgICAgIHRpdGxlOiBpbnB1dC50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gPz8gbnVsbCxcbiAgICAgICAgICBpbnRlcm5hbE5vdGVzOiBpbnB1dC5pbnRlcm5hbE5vdGVzID8/IG51bGwsXG4gICAgICAgICAgY3VzdG9tZXJJZDogY3VzdG9tZXIuaWQsXG4gICAgICAgICAgYWRkcmVzc0lkOiBhZGRyZXNzLmlkLFxuICAgICAgICAgIHZlaGljbGVJZDogdmVoaWNsZT8uaWQgPz8gbnVsbCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBqb2IgYXMgYW55O1xuICB9LFxuXG4gIGFzeW5jIGxpc3RKb2JzKGxpbWl0KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCByb3dzID0gYXdhaXQgKHByaXNtYSBhcyBhbnkpLmpvYi5maW5kTWFueSh7XG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSxcbiAgICAgIHRha2U6IGxpbWl0LFxuICAgIH0pO1xuICAgIHJldHVybiByb3dzIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyB1cGRhdGVKb2JTdGF0dXMod2hlcmUsIGlucHV0KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCBqb2IgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuam9iLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogd2hlcmUuaWQgfSxcbiAgICAgIGRhdGE6IHsgc3RhdHVzOiBpbnB1dC5zdGF0dXMgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gam9iIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyBnZXRKb2JCeUlkKGlkKSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICByZXR1cm4gKGF3YWl0IChwcmlzbWEgYXMgYW55KS5qb2IuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSkpIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyB1cGRhdGVRdW90ZVJlcXVlc3RTdGF0dXMod2hlcmUsIGlucHV0KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCBxdW90ZSA9IGF3YWl0IChwcmlzbWEgYXMgYW55KS5xdW90ZVJlcXVlc3QudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB3aGVyZS5pZCB9LFxuICAgICAgZGF0YTogeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9LFxuICAgIH0pO1xuICAgIHJldHVybiBxdW90ZSBhcyBhbnk7XG4gIH0sXG5cbiAgYXN5bmMgbGlzdFF1b3RlUmVxdWVzdHMobGltaXQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCAocHJpc21hIGFzIGFueSkucXVvdGVSZXF1ZXN0LmZpbmRNYW55KHtcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiBcImRlc2NcIiB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG4gICAgcmV0dXJuIHJvd3MgYXMgYW55O1xuICB9LFxuXG4gIGFzeW5jIHVwZGF0ZUJvb2tpbmdTdGF0dXMod2hlcmUsIGlucHV0KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCBib29raW5nID0gYXdhaXQgKHByaXNtYSBhcyBhbnkpLmJvb2tpbmcudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB3aGVyZS5pZCB9LFxuICAgICAgZGF0YTogeyBzdGF0dXM6IGlucHV0LnN0YXR1cyB9LFxuICAgIH0pO1xuICAgIHJldHVybiBib29raW5nIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyB1cGRhdGVCb29raW5nU3RyaXBlU2Vzc2lvbih3aGVyZSwgaW5wdXQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIGNvbnN0IGJvb2tpbmcgPSBhd2FpdCBwcmlzbWEuYm9va2luZy51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHdoZXJlLmlkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN0cmlwZVNlc3Npb25JZDogaW5wdXQuc3RyaXBlU2Vzc2lvbklkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gYm9va2luZyBhcyBhbnk7XG4gIH0sXG5cbiAgYXN5bmMgZ2V0Qm9va2luZ0J5SWQoaWQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIHJldHVybiAoYXdhaXQgcHJpc21hLmJvb2tpbmcuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkIH0gfSkpIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyBsaXN0Qm9va2luZ3MobGltaXQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIHJldHVybiAoYXdhaXQgcHJpc21hLmJvb2tpbmcuZmluZE1hbnkoeyBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSwgdGFrZTogbGltaXQgfSkpIGFzIGFueTtcbiAgfSxcblxuICBhc3luYyBleHBpcmVQZW5kaW5nQm9va2luZ3Mobm93KSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9va2luZy51cGRhdGVNYW55KHtcbiAgICAgIHdoZXJlOiB7IHN0YXR1czogXCJQRU5ESU5HX1BBWU1FTlRcIiwgcGF5bWVudEV4cGlyZXNBdDogeyBsdGU6IG5vdyB9IH0sXG4gICAgICBkYXRhOiB7IHN0YXR1czogXCJFWFBJUkVEXCIgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzLmNvdW50O1xuICB9LFxuXG4gIGFzeW5jIGNyZWF0ZUlkZW1wb3RlbmN5S2V5T25jZShpbnB1dCkge1xuICAgIGNvbnN0IHsgcHJpc21hIH0gPSBhd2FpdCBpbXBvcnQoXCJAL3NlcnZlci9wcmlzbWFcIik7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IChwcmlzbWEgYXMgYW55KS5pZGVtcG90ZW5jeUtleS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc2NvcGU6IGlucHV0LnNjb3BlLFxuICAgICAgICAgIGtleTogaW5wdXQua2V5LFxuICAgICAgICAgIHJlcXVlc3RIYXNoOiBpbnB1dC5yZXF1ZXN0SGFzaCA/PyBudWxsLFxuICAgICAgICAgIHJlc3BvbnNlSnNvbjogaW5wdXQucmVzcG9uc2VKc29uID8/IG51bGwsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7IGNyZWF0ZWQ6IHRydWUgfTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiB7IGNyZWF0ZWQ6IGZhbHNlIH07XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIGNyZWF0ZU9yR2V0U2VydmljZVJlcG9ydEZvckJvb2tpbmcoaW5wdXQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgKHByaXNtYSBhcyBhbnkpLnNlcnZpY2VSZXBvcnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7IGJvb2tpbmdJZDogaW5wdXQuYm9va2luZ0lkLCB0eXBlOiBpbnB1dC50eXBlIH0sXG4gICAgfSk7XG4gICAgaWYgKGV4aXN0aW5nKSByZXR1cm4gZXhpc3RpbmcgYXMgYW55O1xuXG4gICAgY29uc3QgZGF0YUpzb24gPSB7XG4gICAgICB2ZXJzaW9uOiAxLFxuICAgICAgdHlwZTogaW5wdXQudHlwZSxcbiAgICAgIHRpdGxlOiBpbnB1dC50eXBlID09PSBcIkRJQUdOT1NUSUNTXCIgPyBcIkRpYWdub3N0aWNzIFJlcG9ydFwiIDogXCJQcmUtUHVyY2hhc2UgSW5zcGVjdGlvbiBSZXBvcnRcIixcbiAgICAgIHN1bW1hcnk6IFwiXCIsXG4gICAgICBjb250ZW50TWFya2Rvd246IFwiXCIsXG4gICAgICBhdHRhY2htZW50czogW10sXG4gICAgfTtcblxuICAgIGNvbnN0IGNyZWF0ZWQgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuc2VydmljZVJlcG9ydC5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBib29raW5nSWQ6IGlucHV0LmJvb2tpbmdJZCxcbiAgICAgICAgdHlwZTogaW5wdXQudHlwZSxcbiAgICAgICAgc3RhdHVzOiBcIkRSQUZUXCIsXG4gICAgICAgIGRhdGFKc29uLFxuICAgICAgICBwdWJsaWNUb2tlbjogcmFuZG9tUHVibGljVG9rZW4oKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIGNyZWF0ZWQgYXMgYW55O1xuICB9LFxuXG4gIGFzeW5jIHVwZGF0ZVNlcnZpY2VSZXBvcnREYXRhKHdoZXJlLCBpbnB1dCkge1xuICAgIGNvbnN0IHsgcHJpc21hIH0gPSBhd2FpdCBpbXBvcnQoXCJAL3NlcnZlci9wcmlzbWFcIik7XG4gICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IChwcmlzbWEgYXMgYW55KS5zZXJ2aWNlUmVwb3J0LnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogd2hlcmUuaWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgIGRhdGFKc29uOiBpbnB1dC5kYXRhSnNvbixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZWQgYXMgYW55O1xuICB9LFxuXG4gIGFzeW5jIG1hcmtTZXJ2aWNlUmVwb3J0RW1haWxlZCh3aGVyZSwgaW5wdXQpIHtcbiAgICBjb25zdCB7IHByaXNtYSB9ID0gYXdhaXQgaW1wb3J0KFwiQC9zZXJ2ZXIvcHJpc21hXCIpO1xuICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuc2VydmljZVJlcG9ydC51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHdoZXJlLmlkIH0sXG4gICAgICBkYXRhOiB7IGVtYWlsZWRBdDogaW5wdXQuZW1haWxlZEF0IH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZWQgYXMgYW55O1xuICB9LFxuXG4gIGFzeW5jIGdldFNlcnZpY2VSZXBvcnRCeVB1YmxpY1Rva2VuKHRva2VuKSB7XG4gICAgY29uc3QgeyBwcmlzbWEgfSA9IGF3YWl0IGltcG9ydChcIkAvc2VydmVyL3ByaXNtYVwiKTtcbiAgICByZXR1cm4gKGF3YWl0IChwcmlzbWEgYXMgYW55KS5zZXJ2aWNlUmVwb3J0LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBwdWJsaWNUb2tlbjogdG9rZW4gfSB9KSkgYXMgYW55O1xuICB9LFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGRiKCk6IERiQWRhcHRlciB7XG4gIHJldHVybiBpc0Rldk5vRGIoKSA/IG1lbW9yeUFkYXB0ZXIgOiBwcmlzbWFBZGFwdGVyO1xufVxuIl0sIm5hbWVzIjpbImNyeXB0byIsInJhbmRvbVB1YmxpY0lkIiwicHJlZml4IiwiaWQiLCJyYW5kb21CeXRlcyIsInRvU3RyaW5nIiwiaGFzRGJFbnYiLCJCb29sZWFuIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsIkRiVW5hdmFpbGFibGVFcnJvciIsIkVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwiY29kZSIsIm5hbWUiLCJzbGVlcCIsIm1zIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiaXNMaWtlbHlEYkNvbm5lY3Rpdml0eUVycm9yIiwiZXJyIiwibXNnIiwiU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsIndpdGhEYlJldHJpZXMiLCJmbiIsImRlbGF5cyIsImxhc3RFcnIiLCJhdHRlbXB0IiwibGVuZ3RoIiwiZGJIZWFsdGhDaGVjayIsImlzRGV2Tm9EYiIsIm9rIiwibGF0ZW5jeU1zIiwiZXJyb3IiLCJzdGFydGVkIiwiRGF0ZSIsIm5vdyIsInByaXNtYSIsInRpbWVvdXRNcyIsIk51bWJlciIsIkRCX0hFQUxUSENIRUNLX1RJTUVPVVRfTVMiLCJyYWNlIiwiJHF1ZXJ5UmF3IiwiXyIsInJlamVjdCIsImFzc2VydERiSGVhbHRoeU9yVGhyb3ciLCJoZWFsdGgiLCJERVZfTk9fREIiLCJtZW0iLCJnbG9iYWwiLCJfX2Rldk5vRGJTdG9yZSIsImJvb2tpbmdzIiwiTWFwIiwicXVvdGVSZXF1ZXN0cyIsImpvYnMiLCJzZXJ2aWNlUmVwb3J0cyIsImlkZW1wb3RlbmN5IiwiaWRlbU1hcEtleSIsInNjb3BlIiwia2V5IiwicmFuZG9tUHVibGljVG9rZW4iLCJtZW1vcnlBZGFwdGVyIiwiY3JlYXRlRGlhZ25vc3RpY3NCb29raW5nIiwiaW5wdXQiLCJyYW5kb21VVUlEIiwicmVjIiwicHVibGljSWQiLCJraW5kIiwic3RhdHVzIiwiY3VzdG9tZXJJZCIsImFkZHJlc3NJZCIsInZlaGljbGVJZCIsInNsb3RTdGFydCIsInNsb3RFbmQiLCJhZnRlckhvdXJzIiwic3ltcHRvbVByZXNldCIsIm5vdGVzIiwicHJpY2luZ1NuYXBzaG90SnNvbiIsInN0cmlwZVNlc3Npb25JZCIsInBheW1lbnRFeHBpcmVzQXQiLCJzZXJ2aWNlTThKb2JJZCIsInNlcnZpY2VNOFVybCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInNldCIsImNyZWF0ZUpvYiIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJpbnRlcm5hbE5vdGVzIiwidmVoaWNsZSIsInF1b3RlUmVxdWVzdElkIiwiYm9va2luZ0lkIiwic2NoZWR1bGVkU3RhcnQiLCJzY2hlZHVsZWRFbmQiLCJsaXN0Sm9icyIsImxpbWl0IiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsInNsaWNlIiwidXBkYXRlSm9iU3RhdHVzIiwid2hlcmUiLCJleGlzdGluZyIsImdldCIsInVwZGF0ZWQiLCJnZXRKb2JCeUlkIiwiY3JlYXRlUXVvdGVSZXF1ZXN0IiwiY2F0ZWdvcnkiLCJ1cmdlbmN5Iiwic3ltcHRvbXMiLCJ1cGRhdGVRdW90ZVJlcXVlc3RTdGF0dXMiLCJsaXN0UXVvdGVSZXF1ZXN0cyIsInVwZGF0ZUJvb2tpbmdTdGF0dXMiLCJ1cGRhdGVCb29raW5nU3RyaXBlU2Vzc2lvbiIsImdldEJvb2tpbmdCeUlkIiwibGlzdEJvb2tpbmdzIiwiZXhwaXJlUGVuZGluZ0Jvb2tpbmdzIiwiY291bnQiLCJjcmVhdGVJZGVtcG90ZW5jeUtleU9uY2UiLCJrIiwiaGFzIiwiY3JlYXRlZCIsImNyZWF0ZU9yR2V0U2VydmljZVJlcG9ydEZvckJvb2tpbmciLCJmaW5kIiwiciIsInR5cGUiLCJkYXRhSnNvbiIsInZlcnNpb24iLCJzdW1tYXJ5IiwiY29udGVudE1hcmtkb3duIiwiYXR0YWNobWVudHMiLCJwdWJsaWNUb2tlbiIsImVtYWlsZWRBdCIsInVwZGF0ZVNlcnZpY2VSZXBvcnREYXRhIiwibWFya1NlcnZpY2VSZXBvcnRFbWFpbGVkIiwiZ2V0U2VydmljZVJlcG9ydEJ5UHVibGljVG9rZW4iLCJ0b2tlbiIsInByaXNtYUFkYXB0ZXIiLCJib29raW5nIiwiJHRyYW5zYWN0aW9uIiwidHgiLCJlbWFpbCIsImN1c3RvbWVyIiwidHJpbSIsInBob25lIiwiZXhpc3RpbmdDdXN0b21lciIsImZpbmRGaXJzdCIsIk9SIiwiY3JlYXRlIiwiZGF0YSIsImZ1bGxOYW1lIiwiYWRkcmVzcyIsImxpbmUxIiwic3VidXJiIiwiY2l0eSIsInBvc3Rjb2RlIiwibGF0IiwibG5nIiwidHJhdmVsQmFuZCIsInBsYXRlIiwibWFrZSIsIm1vZGVsIiwieWVhciIsImZ1ZWwiLCJvZG9tZXRlciIsInF1b3RlIiwicXVvdGVSZXF1ZXN0Iiwiam9iIiwicm93cyIsImZpbmRNYW55Iiwib3JkZXJCeSIsInRha2UiLCJ1cGRhdGUiLCJmaW5kVW5pcXVlIiwicmVzIiwidXBkYXRlTWFueSIsImx0ZSIsImlkZW1wb3RlbmN5S2V5IiwicmVxdWVzdEhhc2giLCJyZXNwb25zZUpzb24iLCJzZXJ2aWNlUmVwb3J0IiwiZGIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/db.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/email.ts":
/*!*****************************!*\
  !*** ./src/server/email.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sendBookingConfirmedBusinessEmail: () => (/* binding */ sendBookingConfirmedBusinessEmail),\n/* harmony export */   sendBookingCreatedPaymentRequiredEmail: () => (/* binding */ sendBookingCreatedPaymentRequiredEmail),\n/* harmony export */   sendBookingFallbackBusinessEmail: () => (/* binding */ sendBookingFallbackBusinessEmail),\n/* harmony export */   sendQuoteCreatedBusinessEmail: () => (/* binding */ sendQuoteCreatedBusinessEmail),\n/* harmony export */   sendServiceReportReadyEmail: () => (/* binding */ sendServiceReportReadyEmail),\n/* harmony export */   sendStripeOrphanPaymentBusinessEmail: () => (/* binding */ sendStripeOrphanPaymentBusinessEmail)\n/* harmony export */ });\n/* harmony import */ var resend__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! resend */ \"(rsc)/./node_modules/.pnpm/resend@4.8.0_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/resend/dist/index.mjs\");\n/* harmony import */ var nodemailer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! nodemailer */ \"(rsc)/./node_modules/.pnpm/nodemailer@6.10.1/node_modules/nodemailer/lib/nodemailer.js\");\n\n\nfunction getResendClient() {\n    const key = process.env.RESEND_API_KEY;\n    if (!key) return null;\n    return new resend__WEBPACK_IMPORTED_MODULE_0__.Resend(key);\n}\nfunction getEmailFrom() {\n    return process.env.EMAIL_FROM || \"Mobile Autoworks <bookings@localhost>\";\n}\nfunction getSmtpConfig() {\n    const user = (process.env.SMTP_USER || \"\").trim();\n    const pass = (process.env.SMTP_PASS || \"\").trim();\n    if (!user || !pass) return null;\n    const host = (process.env.SMTP_HOST || \"smtp.gmail.com\").trim();\n    const port = Number((process.env.SMTP_PORT || \"465\").trim());\n    const secure = String(process.env.SMTP_SECURE || \"\").trim() ? String(process.env.SMTP_SECURE).trim().toLowerCase() === \"true\" : port === 465;\n    return {\n        host,\n        port,\n        secure,\n        user,\n        pass\n    };\n}\nasync function sendEmail(input) {\n    const emailFrom = getEmailFrom();\n    const smtp = getSmtpConfig();\n    if (smtp) {\n        const transporter = nodemailer__WEBPACK_IMPORTED_MODULE_1__.createTransport({\n            host: smtp.host,\n            port: smtp.port,\n            secure: smtp.secure,\n            auth: {\n                user: smtp.user,\n                pass: smtp.pass\n            }\n        });\n        await transporter.sendMail({\n            from: emailFrom,\n            to: input.to,\n            subject: input.subject,\n            html: input.html\n        });\n        return;\n    }\n    const resend = getResendClient();\n    if (!resend) {\n        // eslint-disable-next-line no-console\n        console.log(\"[DEV EMAIL]\", {\n            to: input.to,\n            subject: input.subject\n        });\n        return;\n    }\n    await resend.emails.send({\n        from: emailFrom,\n        to: [\n            input.to\n        ],\n        subject: input.subject,\n        html: input.html\n    });\n}\nasync function sendBookingConfirmedBusinessEmail(input) {\n    const resend = getResendClient();\n    const subject = `New confirmed booking: ${input.bookingPublicId}`;\n    const html = `\n  <div style=\"background:#0a0a0a;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;\">\n    <div style=\"max-width:720px;margin:0 auto;background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:12px;overflow:hidden;\">\n      <div style=\"padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.08);\">\n        <div style=\"color:#f6c90e;font-weight:700;\">Mobile Autoworks</div>\n        <div style=\"color:#fff;font-size:18px;font-weight:700;margin-top:6px;\">New booking confirmed (paid)</div>\n      </div>\n      <div style=\"padding:20px 24px;color:rgba(255,255,255,0.86);font-size:14px;line-height:1.6;\">\n        <div style=\"margin-bottom:14px;\"><strong>Reference:</strong> ${input.bookingPublicId}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Preferred time (ISO):</strong> ${input.scheduledStartIso}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Address:</strong> ${input.addressOneLine}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Vehicle:</strong> ${input.vehiclePlate}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Symptoms:</strong><br/>${(input.symptoms || \"\").replace(/\\n/g, \"<br/>\")}</div>\n\n        <div style=\"margin-top:18px;padding:14px;border:1px solid rgba(255,255,255,0.08);border-radius:10px;background:rgba(255,255,255,0.04);\">\n          <div style=\"font-weight:700;color:#fff;margin-bottom:8px;\">Customer</div>\n          <div><strong>Name:</strong> ${input.customerName}</div>\n          <div><strong>Phone:</strong> ${input.customerPhone}</div>\n          <div><strong>Email:</strong> ${input.customerEmail || \"(not provided)\"}</div>\n        </div>\n\n        <p style=\"margin:18px 0;\">\n          <a href=\"${input.adminUrl}\" style=\"display:inline-block;background:#f6c90e;color:#000;padding:12px 16px;border-radius:10px;text-decoration:none;font-weight:700;\">Open Admin Dashboard</a>\n        </p>\n      </div>\n    </div>\n  </div>`;\n    if (!resend && !getSmtpConfig()) {\n        // eslint-disable-next-line no-console\n        console.log(\"[DEV EMAIL]\", {\n            to: input.toEmail,\n            subject,\n            bookingPublicId: input.bookingPublicId\n        });\n        return;\n    }\n    await sendEmail({\n        to: input.toEmail,\n        subject,\n        html\n    });\n}\nasync function sendBookingFallbackBusinessEmail(input) {\n    const subject = `Booking request (DB offline): ${input.customerName}`;\n    const html = `\n  <div style=\"background:#0a0a0a;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;\">\n    <div style=\"max-width:720px;margin:0 auto;background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:12px;overflow:hidden;\">\n      <div style=\"padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.08);\">\n        <div style=\"color:#f6c90e;font-weight:700;\">Mobile Autoworks</div>\n        <div style=\"color:#fff;font-size:18px;font-weight:700;margin-top:6px;\">Booking request received (database offline)</div>\n      </div>\n      <div style=\"padding:20px 24px;color:rgba(255,255,255,0.86);font-size:14px;line-height:1.6;\">\n        <div style=\"margin-bottom:14px;\"><strong>Preferred time (local):</strong> ${input.scheduledStartLocal}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Address:</strong> ${input.address}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Vehicle plate:</strong> ${input.vehiclePlate}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Symptoms:</strong><br/>${(input.symptoms || \"\").replace(/\\n/g, \"<br/>\")}</div>\n        <div style=\"margin-top:18px;padding:14px;border:1px solid rgba(255,255,255,0.08);border-radius:10px;background:rgba(255,255,255,0.04);\">\n          <div style=\"font-weight:700;color:#fff;margin-bottom:8px;\">Customer</div>\n          <div><strong>Name:</strong> ${input.customerName}</div>\n          <div><strong>Phone:</strong> ${input.customerPhone}</div>\n          <div><strong>Email:</strong> ${input.customerEmail || \"(not provided)\"}</div>\n        </div>\n      </div>\n    </div>\n  </div>`;\n    await sendEmail({\n        to: input.toEmail,\n        subject,\n        html\n    });\n}\nasync function sendStripeOrphanPaymentBusinessEmail(input) {\n    const subject = `Stripe payment received but booking missing: ${input.stripeEventId}`;\n    const html = `\n  <div style=\"background:#0a0a0a;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;\">\n    <div style=\"max-width:720px;margin:0 auto;background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:12px;overflow:hidden;\">\n      <div style=\"padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.08);\">\n        <div style=\"color:#f6c90e;font-weight:700;\">Mobile Autoworks</div>\n        <div style=\"color:#fff;font-size:18px;font-weight:700;margin-top:6px;\">Orphan Stripe payment alert</div>\n      </div>\n      <div style=\"padding:20px 24px;color:rgba(255,255,255,0.86);font-size:14px;line-height:1.6;\">\n        <div style=\"margin-bottom:10px;\"><strong>Event:</strong> ${input.stripeEventId}</div>\n        <div style=\"margin-bottom:10px;\"><strong>Session:</strong> ${input.stripeSessionId || \"(unknown)\"}</div>\n        <div style=\"margin-bottom:10px;\"><strong>bookingId metadata:</strong> ${input.bookingId || \"(missing)\"}</div>\n        <div style=\"margin-bottom:10px;\"><strong>Amount:</strong> ${input.amountTotal != null ? String(input.amountTotal) : \"(unknown)\"} ${input.currency || \"\"}</div>\n        <div style=\"margin-top:14px;color:rgba(255,255,255,0.7);\">\n          Action: check Stripe dashboard for the session/payment intent, then verify booking persistence and reconcile manually.\n        </div>\n      </div>\n    </div>\n  </div>`;\n    await sendEmail({\n        to: input.toEmail,\n        subject,\n        html\n    });\n}\nasync function sendQuoteCreatedBusinessEmail(input) {\n    const resend = getResendClient();\n    const subject = `New quote request: ${input.quotePublicId}`;\n    const html = `\n  <div style=\"background:#0a0a0a;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;\">\n    <div style=\"max-width:720px;margin:0 auto;background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:12px;overflow:hidden;\">\n      <div style=\"padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.08);\">\n        <div style=\"color:#f6c90e;font-weight:700;\">Mobile Autoworks</div>\n        <div style=\"color:#fff;font-size:18px;font-weight:700;margin-top:6px;\">New quote request</div>\n      </div>\n      <div style=\"padding:20px 24px;color:rgba(255,255,255,0.86);font-size:14px;line-height:1.6;\">\n        <div style=\"margin-bottom:14px;\"><strong>Reference:</strong> ${input.quotePublicId}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Category:</strong> ${input.category}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Urgency:</strong> ${input.urgency}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Address:</strong> ${input.addressOneLine}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Vehicle:</strong> ${[\n        input.vehiclePlate,\n        input.vehicleYear ? String(input.vehicleYear) : null,\n        input.vehicleMake,\n        input.vehicleModel\n    ].filter(Boolean).join(\" \")}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Symptoms:</strong> ${(input.symptoms || []).length ? (input.symptoms || []).join(\", \") : \"(none)\"}</div>\n        <div style=\"margin-bottom:14px;\"><strong>Description:</strong><br/>${(input.description || \"\").replace(/\\n/g, \"<br/>\")}</div>\n\n        <div style=\"margin-top:18px;padding:14px;border:1px solid rgba(255,255,255,0.08);border-radius:10px;background:rgba(255,255,255,0.04);\">\n          <div style=\"font-weight:700;color:#fff;margin-bottom:8px;\">Customer</div>\n          <div><strong>Name:</strong> ${input.customerName}</div>\n          <div><strong>Phone:</strong> ${input.customerPhone}</div>\n          <div><strong>Email:</strong> ${input.customerEmail || \"(not provided)\"}</div>\n        </div>\n\n        <p style=\"margin:18px 0;\">\n          <a href=\"${input.adminUrl}\" style=\"display:inline-block;background:#f6c90e;color:#000;padding:12px 16px;border-radius:10px;text-decoration:none;font-weight:700;\">Open Admin Dashboard</a>\n        </p>\n      </div>\n    </div>\n  </div>`;\n    if (!resend && !getSmtpConfig()) {\n        // eslint-disable-next-line no-console\n        console.log(\"[DEV EMAIL]\", {\n            to: input.toEmail,\n            subject,\n            quotePublicId: input.quotePublicId\n        });\n        return;\n    }\n    await sendEmail({\n        to: input.toEmail,\n        subject,\n        html\n    });\n}\nasync function sendServiceReportReadyEmail(input) {\n    const resend = getResendClient();\n    const subject = `${input.reportTitle} is ready`;\n    const html = `\n  <div style=\"background:#0a0a0a;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;\">\n    <div style=\"max-width:640px;margin:0 auto;background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:12px;overflow:hidden;\">\n      <div style=\"padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.08);\">\n        <div style=\"color:#f6c90e;font-weight:700;\">Mobile Autoworks</div>\n        <div style=\"color:#fff;font-size:18px;font-weight:700;margin-top:6px;\">Your report is ready</div>\n      </div>\n      <div style=\"padding:20px 24px;color:rgba(255,255,255,0.86);font-size:14px;line-height:1.6;\">\n        <p>Your <strong>${input.reportTitle}</strong> is ready to view.</p>\n        <p style=\"margin:18px 0;\">\n          <a href=\"${input.reportUrl}\" style=\"display:inline-block;background:#f6c90e;color:#000;padding:12px 16px;border-radius:10px;text-decoration:none;font-weight:700;\">View report</a>\n        </p>\n        <p style=\"color:rgba(255,255,255,0.65);font-size:12px;\">Booking reference: ${input.bookingRef}</p>\n      </div>\n    </div>\n  </div>`;\n    if (!resend && !getSmtpConfig()) {\n        // eslint-disable-next-line no-console\n        console.log(\"[DEV EMAIL]\", {\n            to: input.toEmail,\n            subject,\n            bookingRef: input.bookingRef,\n            reportUrl: input.reportUrl\n        });\n        return;\n    }\n    await sendEmail({\n        to: input.toEmail,\n        subject,\n        html\n    });\n}\nasync function sendBookingCreatedPaymentRequiredEmail(input) {\n    const resend = getResendClient();\n    const subject = \"Complete payment to confirm your booking\";\n    const html = `\n  <div style=\"background:#0a0a0a;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;\">\n    <div style=\"max-width:640px;margin:0 auto;background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:12px;overflow:hidden;\">\n      <div style=\"padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.08);\">\n        <div style=\"color:#f6c90e;font-weight:700;\">Mobile Autoworks</div>\n        <div style=\"color:#fff;font-size:18px;font-weight:700;margin-top:6px;\">Payment required to confirm</div>\n      </div>\n      <div style=\"padding:20px 24px;color:rgba(255,255,255,0.86);font-size:14px;line-height:1.6;\">\n        <p>Thanks for your booking request. To confirm your appointment, please complete payment using the button below.</p>\n        <p style=\"margin:18px 0;\">\n          <a href=\"${input.checkoutUrl}\" style=\"display:inline-block;background:#f6c90e;color:#000;padding:12px 16px;border-radius:10px;text-decoration:none;font-weight:700;\">Pay now to confirm</a>\n        </p>\n        <p style=\"color:rgba(255,255,255,0.65);font-size:12px;\">Booking reference: ${input.bookingId}</p>\n      </div>\n    </div>\n  </div>`;\n    if (!resend && !getSmtpConfig()) {\n        // DEV fallback: log to server console\n        // eslint-disable-next-line no-console\n        console.log(\"[DEV EMAIL]\", {\n            to: input.toEmail,\n            subject,\n            bookingId: input.bookingId,\n            checkoutUrl: input.checkoutUrl\n        });\n        return;\n    }\n    await sendEmail({\n        to: input.toEmail,\n        subject,\n        html\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2VtYWlsLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQWdDO0FBQ0k7QUFFcEMsU0FBU0U7SUFDUCxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLGNBQWM7SUFDdEMsSUFBSSxDQUFDSCxLQUFLLE9BQU87SUFDakIsT0FBTyxJQUFJSCwwQ0FBTUEsQ0FBQ0c7QUFDcEI7QUFFQSxTQUFTSTtJQUNQLE9BQU9ILFFBQVFDLEdBQUcsQ0FBQ0csVUFBVSxJQUFJO0FBQ25DO0FBVUEsU0FBU0M7SUFDUCxNQUFNQyxPQUFPLENBQUNOLFFBQVFDLEdBQUcsQ0FBQ00sU0FBUyxJQUFJLEVBQUMsRUFBR0MsSUFBSTtJQUMvQyxNQUFNQyxPQUFPLENBQUNULFFBQVFDLEdBQUcsQ0FBQ1MsU0FBUyxJQUFJLEVBQUMsRUFBR0YsSUFBSTtJQUMvQyxJQUFJLENBQUNGLFFBQVEsQ0FBQ0csTUFBTSxPQUFPO0lBRTNCLE1BQU1FLE9BQU8sQ0FBQ1gsUUFBUUMsR0FBRyxDQUFDVyxTQUFTLElBQUksZ0JBQWUsRUFBR0osSUFBSTtJQUM3RCxNQUFNSyxPQUFPQyxPQUFPLENBQUNkLFFBQVFDLEdBQUcsQ0FBQ2MsU0FBUyxJQUFJLEtBQUksRUFBR1AsSUFBSTtJQUN6RCxNQUFNUSxTQUFTQyxPQUFPakIsUUFBUUMsR0FBRyxDQUFDaUIsV0FBVyxJQUFJLElBQUlWLElBQUksS0FDckRTLE9BQU9qQixRQUFRQyxHQUFHLENBQUNpQixXQUFXLEVBQUVWLElBQUksR0FBR1csV0FBVyxPQUFPLFNBQ3pETixTQUFTO0lBRWIsT0FBTztRQUFFRjtRQUFNRTtRQUFNRztRQUFRVjtRQUFNRztJQUFLO0FBQzFDO0FBRUEsZUFBZVcsVUFBVUMsS0FBb0Q7SUFDM0UsTUFBTUMsWUFBWW5CO0lBQ2xCLE1BQU1vQixPQUFPbEI7SUFFYixJQUFJa0IsTUFBTTtRQUNSLE1BQU1DLGNBQWMzQix1REFBMEIsQ0FBQztZQUM3Q2MsTUFBTVksS0FBS1osSUFBSTtZQUNmRSxNQUFNVSxLQUFLVixJQUFJO1lBQ2ZHLFFBQVFPLEtBQUtQLE1BQU07WUFDbkJVLE1BQU07Z0JBQ0pwQixNQUFNaUIsS0FBS2pCLElBQUk7Z0JBQ2ZHLE1BQU1jLEtBQUtkLElBQUk7WUFDakI7UUFDRjtRQUVBLE1BQU1lLFlBQVlHLFFBQVEsQ0FBQztZQUN6QkMsTUFBTU47WUFDTk8sSUFBSVIsTUFBTVEsRUFBRTtZQUNaQyxTQUFTVCxNQUFNUyxPQUFPO1lBQ3RCQyxNQUFNVixNQUFNVSxJQUFJO1FBQ2xCO1FBQ0E7SUFDRjtJQUVBLE1BQU1DLFNBQVNsQztJQUNmLElBQUksQ0FBQ2tDLFFBQVE7UUFDWCxzQ0FBc0M7UUFDdENDLFFBQVFDLEdBQUcsQ0FBQyxlQUFlO1lBQUVMLElBQUlSLE1BQU1RLEVBQUU7WUFBRUMsU0FBU1QsTUFBTVMsT0FBTztRQUFDO1FBQ2xFO0lBQ0Y7SUFFQSxNQUFNRSxPQUFPRyxNQUFNLENBQUNDLElBQUksQ0FBQztRQUN2QlIsTUFBTU47UUFDTk8sSUFBSTtZQUFDUixNQUFNUSxFQUFFO1NBQUM7UUFDZEMsU0FBU1QsTUFBTVMsT0FBTztRQUN0QkMsTUFBTVYsTUFBTVUsSUFBSTtJQUNsQjtBQUNGO0FBRU8sZUFBZU0sa0NBQWtDaEIsS0FXdkQ7SUFDQyxNQUFNVyxTQUFTbEM7SUFFZixNQUFNZ0MsVUFBVSxDQUFDLHVCQUF1QixFQUFFVCxNQUFNaUIsZUFBZSxFQUFFO0lBRWpFLE1BQU1QLE9BQU8sQ0FBQzs7Ozs7Ozs7cUVBUXFELEVBQUVWLE1BQU1pQixlQUFlLENBQUM7Z0ZBQ2IsRUFBRWpCLE1BQU1rQixpQkFBaUIsQ0FBQzttRUFDdkMsRUFBRWxCLE1BQU1tQixjQUFjLENBQUM7bUVBQ3ZCLEVBQUVuQixNQUFNb0IsWUFBWSxDQUFDO3dFQUNoQixFQUFFLENBQUNwQixNQUFNcUIsUUFBUSxJQUFJLEVBQUMsRUFBR0MsT0FBTyxDQUFDLE9BQU8sU0FBUzs7OztzQ0FJbkYsRUFBRXRCLE1BQU11QixZQUFZLENBQUM7dUNBQ3BCLEVBQUV2QixNQUFNd0IsYUFBYSxDQUFDO3VDQUN0QixFQUFFeEIsTUFBTXlCLGFBQWEsSUFBSSxpQkFBaUI7Ozs7bUJBSTlELEVBQUV6QixNQUFNMEIsUUFBUSxDQUFDOzs7O1FBSTVCLENBQUM7SUFFUCxJQUFJLENBQUNmLFVBQVUsQ0FBQzNCLGlCQUFpQjtRQUMvQixzQ0FBc0M7UUFDdEM0QixRQUFRQyxHQUFHLENBQUMsZUFBZTtZQUFFTCxJQUFJUixNQUFNMkIsT0FBTztZQUFFbEI7WUFBU1EsaUJBQWlCakIsTUFBTWlCLGVBQWU7UUFBQztRQUNoRztJQUNGO0lBRUEsTUFBTWxCLFVBQVU7UUFBRVMsSUFBSVIsTUFBTTJCLE9BQU87UUFBRWxCO1FBQVNDO0lBQUs7QUFDckQ7QUFFTyxlQUFla0IsaUNBQWlDNUIsS0FTdEQ7SUFDQyxNQUFNUyxVQUFVLENBQUMsOEJBQThCLEVBQUVULE1BQU11QixZQUFZLEVBQUU7SUFFckUsTUFBTWIsT0FBTyxDQUFDOzs7Ozs7OztrRkFRa0UsRUFBRVYsTUFBTTZCLG1CQUFtQixDQUFDO21FQUMzQyxFQUFFN0IsTUFBTThCLE9BQU8sQ0FBQzt5RUFDVixFQUFFOUIsTUFBTW9CLFlBQVksQ0FBQzt3RUFDdEIsRUFBRSxDQUFDcEIsTUFBTXFCLFFBQVEsSUFBSSxFQUFDLEVBQUdDLE9BQU8sQ0FBQyxPQUFPLFNBQVM7OztzQ0FHbkYsRUFBRXRCLE1BQU11QixZQUFZLENBQUM7dUNBQ3BCLEVBQUV2QixNQUFNd0IsYUFBYSxDQUFDO3VDQUN0QixFQUFFeEIsTUFBTXlCLGFBQWEsSUFBSSxpQkFBaUI7Ozs7UUFJekUsQ0FBQztJQUVQLE1BQU0xQixVQUFVO1FBQUVTLElBQUlSLE1BQU0yQixPQUFPO1FBQUVsQjtRQUFTQztJQUFLO0FBQ3JEO0FBRU8sZUFBZXFCLHFDQUFxQy9CLEtBTzFEO0lBQ0MsTUFBTVMsVUFBVSxDQUFDLDZDQUE2QyxFQUFFVCxNQUFNZ0MsYUFBYSxFQUFFO0lBRXJGLE1BQU10QixPQUFPLENBQUM7Ozs7Ozs7O2lFQVFpRCxFQUFFVixNQUFNZ0MsYUFBYSxDQUFDO21FQUNwQixFQUFFaEMsTUFBTWlDLGVBQWUsSUFBSSxZQUFZOzhFQUM1QixFQUFFakMsTUFBTWtDLFNBQVMsSUFBSSxZQUFZO2tFQUM3QyxFQUFFbEMsTUFBTW1DLFdBQVcsSUFBSSxPQUFPdkMsT0FBT0ksTUFBTW1DLFdBQVcsSUFBSSxZQUFZLENBQUMsRUFBRW5DLE1BQU1vQyxRQUFRLElBQUksR0FBRzs7Ozs7O1FBTXhKLENBQUM7SUFFUCxNQUFNckMsVUFBVTtRQUFFUyxJQUFJUixNQUFNMkIsT0FBTztRQUFFbEI7UUFBU0M7SUFBSztBQUNyRDtBQUVPLGVBQWUyQiw4QkFBOEJyQyxLQWdCbkQ7SUFDQyxNQUFNVyxTQUFTbEM7SUFFZixNQUFNZ0MsVUFBVSxDQUFDLG1CQUFtQixFQUFFVCxNQUFNc0MsYUFBYSxFQUFFO0lBRTNELE1BQU01QixPQUFPLENBQUM7Ozs7Ozs7O3FFQVFxRCxFQUFFVixNQUFNc0MsYUFBYSxDQUFDO29FQUN2QixFQUFFdEMsTUFBTXVDLFFBQVEsQ0FBQzttRUFDbEIsRUFBRXZDLE1BQU13QyxPQUFPLENBQUM7bUVBQ2hCLEVBQUV4QyxNQUFNbUIsY0FBYyxDQUFDO21FQUN2QixFQUFFO1FBQzNEbkIsTUFBTW9CLFlBQVk7UUFDbEJwQixNQUFNeUMsV0FBVyxHQUFHN0MsT0FBT0ksTUFBTXlDLFdBQVcsSUFBSTtRQUNoRHpDLE1BQU0wQyxXQUFXO1FBQ2pCMUMsTUFBTTJDLFlBQVk7S0FDbkIsQ0FDRUMsTUFBTSxDQUFDQyxTQUNQQyxJQUFJLENBQUMsS0FBSztvRUFDK0MsRUFBRSxDQUFDOUMsTUFBTXFCLFFBQVEsSUFBSSxFQUFFLEVBQUUwQixNQUFNLEdBQUcsQ0FBQy9DLE1BQU1xQixRQUFRLElBQUksRUFBRSxFQUFFeUIsSUFBSSxDQUFDLFFBQVEsU0FBUzsyRUFDeEUsRUFBRSxDQUFDOUMsTUFBTWdELFdBQVcsSUFBSSxFQUFDLEVBQUcxQixPQUFPLENBQUMsT0FBTyxTQUFTOzs7O3NDQUl6RixFQUFFdEIsTUFBTXVCLFlBQVksQ0FBQzt1Q0FDcEIsRUFBRXZCLE1BQU13QixhQUFhLENBQUM7dUNBQ3RCLEVBQUV4QixNQUFNeUIsYUFBYSxJQUFJLGlCQUFpQjs7OzttQkFJOUQsRUFBRXpCLE1BQU0wQixRQUFRLENBQUM7Ozs7UUFJNUIsQ0FBQztJQUVQLElBQUksQ0FBQ2YsVUFBVSxDQUFDM0IsaUJBQWlCO1FBQy9CLHNDQUFzQztRQUN0QzRCLFFBQVFDLEdBQUcsQ0FBQyxlQUFlO1lBQUVMLElBQUlSLE1BQU0yQixPQUFPO1lBQUVsQjtZQUFTNkIsZUFBZXRDLE1BQU1zQyxhQUFhO1FBQUM7UUFDNUY7SUFDRjtJQUVBLE1BQU12QyxVQUFVO1FBQUVTLElBQUlSLE1BQU0yQixPQUFPO1FBQUVsQjtRQUFTQztJQUFLO0FBQ3JEO0FBRU8sZUFBZXVDLDRCQUE0QmpELEtBS2pEO0lBQ0MsTUFBTVcsU0FBU2xDO0lBRWYsTUFBTWdDLFVBQVUsR0FBR1QsTUFBTWtELFdBQVcsQ0FBQyxTQUFTLENBQUM7SUFFL0MsTUFBTXhDLE9BQU8sQ0FBQzs7Ozs7Ozs7d0JBUVEsRUFBRVYsTUFBTWtELFdBQVcsQ0FBQzs7bUJBRXpCLEVBQUVsRCxNQUFNbUQsU0FBUyxDQUFDOzttRkFFOEMsRUFBRW5ELE1BQU1vRCxVQUFVLENBQUM7OztRQUc5RixDQUFDO0lBRVAsSUFBSSxDQUFDekMsVUFBVSxDQUFDM0IsaUJBQWlCO1FBQy9CLHNDQUFzQztRQUN0QzRCLFFBQVFDLEdBQUcsQ0FBQyxlQUFlO1lBQUVMLElBQUlSLE1BQU0yQixPQUFPO1lBQUVsQjtZQUFTMkMsWUFBWXBELE1BQU1vRCxVQUFVO1lBQUVELFdBQVduRCxNQUFNbUQsU0FBUztRQUFDO1FBQ2xIO0lBQ0Y7SUFFQSxNQUFNcEQsVUFBVTtRQUFFUyxJQUFJUixNQUFNMkIsT0FBTztRQUFFbEI7UUFBU0M7SUFBSztBQUNyRDtBQUVPLGVBQWUyQyx1Q0FBdUNyRCxLQUk1RDtJQUNDLE1BQU1XLFNBQVNsQztJQUVmLE1BQU1nQyxVQUFVO0lBRWhCLE1BQU1DLE9BQU8sQ0FBQzs7Ozs7Ozs7OzttQkFVRyxFQUFFVixNQUFNc0QsV0FBVyxDQUFDOzttRkFFNEMsRUFBRXRELE1BQU1rQyxTQUFTLENBQUM7OztRQUc3RixDQUFDO0lBRVAsSUFBSSxDQUFDdkIsVUFBVSxDQUFDM0IsaUJBQWlCO1FBQy9CLHNDQUFzQztRQUN0QyxzQ0FBc0M7UUFDdEM0QixRQUFRQyxHQUFHLENBQUMsZUFBZTtZQUFFTCxJQUFJUixNQUFNMkIsT0FBTztZQUFFbEI7WUFBU3lCLFdBQVdsQyxNQUFNa0MsU0FBUztZQUFFb0IsYUFBYXRELE1BQU1zRCxXQUFXO1FBQUM7UUFDcEg7SUFDRjtJQUVBLE1BQU12RCxVQUFVO1FBQUVTLElBQUlSLE1BQU0yQixPQUFPO1FBQUVsQjtRQUFTQztJQUFLO0FBQ3JEIiwic291cmNlcyI6WyJDOlxcbnptb2JpbGVhdXRvc1xcbmV4dFxcc3JjXFxzZXJ2ZXJcXGVtYWlsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc2VuZCB9IGZyb20gXCJyZXNlbmRcIjtcbmltcG9ydCBub2RlbWFpbGVyIGZyb20gXCJub2RlbWFpbGVyXCI7XG5cbmZ1bmN0aW9uIGdldFJlc2VuZENsaWVudCgpIHtcbiAgY29uc3Qga2V5ID0gcHJvY2Vzcy5lbnYuUkVTRU5EX0FQSV9LRVk7XG4gIGlmICgha2V5KSByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIG5ldyBSZXNlbmQoa2V5KTtcbn1cblxuZnVuY3Rpb24gZ2V0RW1haWxGcm9tKCkge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuRU1BSUxfRlJPTSB8fCBcIk1vYmlsZSBBdXRvd29ya3MgPGJvb2tpbmdzQGxvY2FsaG9zdD5cIjtcbn1cblxudHlwZSBTbXRwQ29uZmlnID0ge1xuICBob3N0OiBzdHJpbmc7XG4gIHBvcnQ6IG51bWJlcjtcbiAgc2VjdXJlOiBib29sZWFuO1xuICB1c2VyOiBzdHJpbmc7XG4gIHBhc3M6IHN0cmluZztcbn07XG5cbmZ1bmN0aW9uIGdldFNtdHBDb25maWcoKTogU210cENvbmZpZyB8IG51bGwge1xuICBjb25zdCB1c2VyID0gKHByb2Nlc3MuZW52LlNNVFBfVVNFUiB8fCBcIlwiKS50cmltKCk7XG4gIGNvbnN0IHBhc3MgPSAocHJvY2Vzcy5lbnYuU01UUF9QQVNTIHx8IFwiXCIpLnRyaW0oKTtcbiAgaWYgKCF1c2VyIHx8ICFwYXNzKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCBob3N0ID0gKHByb2Nlc3MuZW52LlNNVFBfSE9TVCB8fCBcInNtdHAuZ21haWwuY29tXCIpLnRyaW0oKTtcbiAgY29uc3QgcG9ydCA9IE51bWJlcigocHJvY2Vzcy5lbnYuU01UUF9QT1JUIHx8IFwiNDY1XCIpLnRyaW0oKSk7XG4gIGNvbnN0IHNlY3VyZSA9IFN0cmluZyhwcm9jZXNzLmVudi5TTVRQX1NFQ1VSRSB8fCBcIlwiKS50cmltKClcbiAgICA/IFN0cmluZyhwcm9jZXNzLmVudi5TTVRQX1NFQ1VSRSkudHJpbSgpLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiXG4gICAgOiBwb3J0ID09PSA0NjU7XG5cbiAgcmV0dXJuIHsgaG9zdCwgcG9ydCwgc2VjdXJlLCB1c2VyLCBwYXNzIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNlbmRFbWFpbChpbnB1dDogeyB0bzogc3RyaW5nOyBzdWJqZWN0OiBzdHJpbmc7IGh0bWw6IHN0cmluZyB9KSB7XG4gIGNvbnN0IGVtYWlsRnJvbSA9IGdldEVtYWlsRnJvbSgpO1xuICBjb25zdCBzbXRwID0gZ2V0U210cENvbmZpZygpO1xuXG4gIGlmIChzbXRwKSB7XG4gICAgY29uc3QgdHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7XG4gICAgICBob3N0OiBzbXRwLmhvc3QsXG4gICAgICBwb3J0OiBzbXRwLnBvcnQsXG4gICAgICBzZWN1cmU6IHNtdHAuc2VjdXJlLFxuICAgICAgYXV0aDoge1xuICAgICAgICB1c2VyOiBzbXRwLnVzZXIsXG4gICAgICAgIHBhc3M6IHNtdHAucGFzcyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0cmFuc3BvcnRlci5zZW5kTWFpbCh7XG4gICAgICBmcm9tOiBlbWFpbEZyb20sXG4gICAgICB0bzogaW5wdXQudG8sXG4gICAgICBzdWJqZWN0OiBpbnB1dC5zdWJqZWN0LFxuICAgICAgaHRtbDogaW5wdXQuaHRtbCxcbiAgICB9KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCByZXNlbmQgPSBnZXRSZXNlbmRDbGllbnQoKTtcbiAgaWYgKCFyZXNlbmQpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgIGNvbnNvbGUubG9nKFwiW0RFViBFTUFJTF1cIiwgeyB0bzogaW5wdXQudG8sIHN1YmplY3Q6IGlucHV0LnN1YmplY3QgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcbiAgICBmcm9tOiBlbWFpbEZyb20sXG4gICAgdG86IFtpbnB1dC50b10sXG4gICAgc3ViamVjdDogaW5wdXQuc3ViamVjdCxcbiAgICBodG1sOiBpbnB1dC5odG1sLFxuICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRCb29raW5nQ29uZmlybWVkQnVzaW5lc3NFbWFpbChpbnB1dDoge1xuICB0b0VtYWlsOiBzdHJpbmc7XG4gIGJvb2tpbmdQdWJsaWNJZDogc3RyaW5nO1xuICBzY2hlZHVsZWRTdGFydElzbzogc3RyaW5nO1xuICBhZGRyZXNzT25lTGluZTogc3RyaW5nO1xuICBjdXN0b21lck5hbWU6IHN0cmluZztcbiAgY3VzdG9tZXJQaG9uZTogc3RyaW5nO1xuICBjdXN0b21lckVtYWlsOiBzdHJpbmcgfCBudWxsO1xuICB2ZWhpY2xlUGxhdGU6IHN0cmluZztcbiAgc3ltcHRvbXM6IHN0cmluZztcbiAgYWRtaW5Vcmw6IHN0cmluZztcbn0pIHtcbiAgY29uc3QgcmVzZW5kID0gZ2V0UmVzZW5kQ2xpZW50KCk7XG5cbiAgY29uc3Qgc3ViamVjdCA9IGBOZXcgY29uZmlybWVkIGJvb2tpbmc6ICR7aW5wdXQuYm9va2luZ1B1YmxpY0lkfWA7XG5cbiAgY29uc3QgaHRtbCA9IGBcbiAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IzBhMGEwYTtwYWRkaW5nOjI0cHg7Zm9udC1mYW1pbHk6dWktc2Fucy1zZXJpZixzeXN0ZW0tdWksLWFwcGxlLXN5c3RlbSxTZWdvZSBVSSxSb2JvdG8sSGVsdmV0aWNhLEFyaWFsO1wiPlxuICAgIDxkaXYgc3R5bGU9XCJtYXgtd2lkdGg6NzIwcHg7bWFyZ2luOjAgYXV0bztiYWNrZ3JvdW5kOiMxMTE7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpO2JvcmRlci1yYWRpdXM6MTJweDtvdmVyZmxvdzpoaWRkZW47XCI+XG4gICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzoyMHB4IDI0cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTtcIj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiNmNmM5MGU7Zm9udC13ZWlnaHQ6NzAwO1wiPk1vYmlsZSBBdXRvd29ya3M8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiNmZmY7Zm9udC1zaXplOjE4cHg7Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi10b3A6NnB4O1wiPk5ldyBib29raW5nIGNvbmZpcm1lZCAocGFpZCk8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6MjBweCAyNHB4O2NvbG9yOnJnYmEoMjU1LDI1NSwyNTUsMC44Nik7Zm9udC1zaXplOjE0cHg7bGluZS1oZWlnaHQ6MS42O1wiPlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLWJvdHRvbToxNHB4O1wiPjxzdHJvbmc+UmVmZXJlbmNlOjwvc3Ryb25nPiAke2lucHV0LmJvb2tpbmdQdWJsaWNJZH08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTRweDtcIj48c3Ryb25nPlByZWZlcnJlZCB0aW1lIChJU08pOjwvc3Ryb25nPiAke2lucHV0LnNjaGVkdWxlZFN0YXJ0SXNvfTwvZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLWJvdHRvbToxNHB4O1wiPjxzdHJvbmc+QWRkcmVzczo8L3N0cm9uZz4gJHtpbnB1dC5hZGRyZXNzT25lTGluZX08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTRweDtcIj48c3Ryb25nPlZlaGljbGU6PC9zdHJvbmc+ICR7aW5wdXQudmVoaWNsZVBsYXRlfTwvZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLWJvdHRvbToxNHB4O1wiPjxzdHJvbmc+U3ltcHRvbXM6PC9zdHJvbmc+PGJyLz4keyhpbnB1dC5zeW1wdG9tcyB8fCBcIlwiKS5yZXBsYWNlKC9cXG4vZywgXCI8YnIvPlwiKX08L2Rpdj5cblxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLXRvcDoxOHB4O3BhZGRpbmc6MTRweDtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7Ym9yZGVyLXJhZGl1czoxMHB4O2JhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwwLjA0KTtcIj5cbiAgICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC13ZWlnaHQ6NzAwO2NvbG9yOiNmZmY7bWFyZ2luLWJvdHRvbTo4cHg7XCI+Q3VzdG9tZXI8L2Rpdj5cbiAgICAgICAgICA8ZGl2PjxzdHJvbmc+TmFtZTo8L3N0cm9uZz4gJHtpbnB1dC5jdXN0b21lck5hbWV9PC9kaXY+XG4gICAgICAgICAgPGRpdj48c3Ryb25nPlBob25lOjwvc3Ryb25nPiAke2lucHV0LmN1c3RvbWVyUGhvbmV9PC9kaXY+XG4gICAgICAgICAgPGRpdj48c3Ryb25nPkVtYWlsOjwvc3Ryb25nPiAke2lucHV0LmN1c3RvbWVyRW1haWwgfHwgXCIobm90IHByb3ZpZGVkKVwifTwvZGl2PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbjoxOHB4IDA7XCI+XG4gICAgICAgICAgPGEgaHJlZj1cIiR7aW5wdXQuYWRtaW5Vcmx9XCIgc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jaztiYWNrZ3JvdW5kOiNmNmM5MGU7Y29sb3I6IzAwMDtwYWRkaW5nOjEycHggMTZweDtib3JkZXItcmFkaXVzOjEwcHg7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Zm9udC13ZWlnaHQ6NzAwO1wiPk9wZW4gQWRtaW4gRGFzaGJvYXJkPC9hPlxuICAgICAgICA8L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+YDtcblxuICBpZiAoIXJlc2VuZCAmJiAhZ2V0U210cENvbmZpZygpKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLmxvZyhcIltERVYgRU1BSUxdXCIsIHsgdG86IGlucHV0LnRvRW1haWwsIHN1YmplY3QsIGJvb2tpbmdQdWJsaWNJZDogaW5wdXQuYm9va2luZ1B1YmxpY0lkIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IHNlbmRFbWFpbCh7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBodG1sIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZEJvb2tpbmdGYWxsYmFja0J1c2luZXNzRW1haWwoaW5wdXQ6IHtcbiAgdG9FbWFpbDogc3RyaW5nO1xuICBjdXN0b21lck5hbWU6IHN0cmluZztcbiAgY3VzdG9tZXJFbWFpbDogc3RyaW5nIHwgbnVsbDtcbiAgY3VzdG9tZXJQaG9uZTogc3RyaW5nO1xuICBzY2hlZHVsZWRTdGFydExvY2FsOiBzdHJpbmc7XG4gIGFkZHJlc3M6IHN0cmluZztcbiAgdmVoaWNsZVBsYXRlOiBzdHJpbmc7XG4gIHN5bXB0b21zOiBzdHJpbmc7XG59KSB7XG4gIGNvbnN0IHN1YmplY3QgPSBgQm9va2luZyByZXF1ZXN0IChEQiBvZmZsaW5lKTogJHtpbnB1dC5jdXN0b21lck5hbWV9YDtcblxuICBjb25zdCBodG1sID0gYFxuICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDojMGEwYTBhO3BhZGRpbmc6MjRweDtmb250LWZhbWlseTp1aS1zYW5zLXNlcmlmLHN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxIZWx2ZXRpY2EsQXJpYWw7XCI+XG4gICAgPGRpdiBzdHlsZT1cIm1heC13aWR0aDo3MjBweDttYXJnaW46MCBhdXRvO2JhY2tncm91bmQ6IzExMTtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7Ym9yZGVyLXJhZGl1czoxMnB4O292ZXJmbG93OmhpZGRlbjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJwYWRkaW5nOjIwcHggMjRweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpO1wiPlxuICAgICAgICA8ZGl2IHN0eWxlPVwiY29sb3I6I2Y2YzkwZTtmb250LXdlaWdodDo3MDA7XCI+TW9iaWxlIEF1dG93b3JrczwvZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPVwiY29sb3I6I2ZmZjtmb250LXNpemU6MThweDtmb250LXdlaWdodDo3MDA7bWFyZ2luLXRvcDo2cHg7XCI+Qm9va2luZyByZXF1ZXN0IHJlY2VpdmVkIChkYXRhYmFzZSBvZmZsaW5lKTwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzoyMHB4IDI0cHg7Y29sb3I6cmdiYSgyNTUsMjU1LDI1NSwwLjg2KTtmb250LXNpemU6MTRweDtsaW5lLWhlaWdodDoxLjY7XCI+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjE0cHg7XCI+PHN0cm9uZz5QcmVmZXJyZWQgdGltZSAobG9jYWwpOjwvc3Ryb25nPiAke2lucHV0LnNjaGVkdWxlZFN0YXJ0TG9jYWx9PC9kaXY+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjE0cHg7XCI+PHN0cm9uZz5BZGRyZXNzOjwvc3Ryb25nPiAke2lucHV0LmFkZHJlc3N9PC9kaXY+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjE0cHg7XCI+PHN0cm9uZz5WZWhpY2xlIHBsYXRlOjwvc3Ryb25nPiAke2lucHV0LnZlaGljbGVQbGF0ZX08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTRweDtcIj48c3Ryb25nPlN5bXB0b21zOjwvc3Ryb25nPjxici8+JHsoaW5wdXQuc3ltcHRvbXMgfHwgXCJcIikucmVwbGFjZSgvXFxuL2csIFwiPGJyLz5cIil9PC9kaXY+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tdG9wOjE4cHg7cGFkZGluZzoxNHB4O2JvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTtib3JkZXItcmFkaXVzOjEwcHg7YmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LDAuMDQpO1wiPlxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXdlaWdodDo3MDA7Y29sb3I6I2ZmZjttYXJnaW4tYm90dG9tOjhweDtcIj5DdXN0b21lcjwvZGl2PlxuICAgICAgICAgIDxkaXY+PHN0cm9uZz5OYW1lOjwvc3Ryb25nPiAke2lucHV0LmN1c3RvbWVyTmFtZX08L2Rpdj5cbiAgICAgICAgICA8ZGl2PjxzdHJvbmc+UGhvbmU6PC9zdHJvbmc+ICR7aW5wdXQuY3VzdG9tZXJQaG9uZX08L2Rpdj5cbiAgICAgICAgICA8ZGl2PjxzdHJvbmc+RW1haWw6PC9zdHJvbmc+ICR7aW5wdXQuY3VzdG9tZXJFbWFpbCB8fCBcIihub3QgcHJvdmlkZWQpXCJ9PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PmA7XG5cbiAgYXdhaXQgc2VuZEVtYWlsKHsgdG86IGlucHV0LnRvRW1haWwsIHN1YmplY3QsIGh0bWwgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kU3RyaXBlT3JwaGFuUGF5bWVudEJ1c2luZXNzRW1haWwoaW5wdXQ6IHtcbiAgdG9FbWFpbDogc3RyaW5nO1xuICBzdHJpcGVFdmVudElkOiBzdHJpbmc7XG4gIHN0cmlwZVNlc3Npb25JZDogc3RyaW5nIHwgbnVsbDtcbiAgYm9va2luZ0lkOiBzdHJpbmcgfCBudWxsO1xuICBhbW91bnRUb3RhbDogbnVtYmVyIHwgbnVsbDtcbiAgY3VycmVuY3k6IHN0cmluZyB8IG51bGw7XG59KSB7XG4gIGNvbnN0IHN1YmplY3QgPSBgU3RyaXBlIHBheW1lbnQgcmVjZWl2ZWQgYnV0IGJvb2tpbmcgbWlzc2luZzogJHtpbnB1dC5zdHJpcGVFdmVudElkfWA7XG5cbiAgY29uc3QgaHRtbCA9IGBcbiAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IzBhMGEwYTtwYWRkaW5nOjI0cHg7Zm9udC1mYW1pbHk6dWktc2Fucy1zZXJpZixzeXN0ZW0tdWksLWFwcGxlLXN5c3RlbSxTZWdvZSBVSSxSb2JvdG8sSGVsdmV0aWNhLEFyaWFsO1wiPlxuICAgIDxkaXYgc3R5bGU9XCJtYXgtd2lkdGg6NzIwcHg7bWFyZ2luOjAgYXV0bztiYWNrZ3JvdW5kOiMxMTE7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpO2JvcmRlci1yYWRpdXM6MTJweDtvdmVyZmxvdzpoaWRkZW47XCI+XG4gICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzoyMHB4IDI0cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTtcIj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiNmNmM5MGU7Zm9udC13ZWlnaHQ6NzAwO1wiPk1vYmlsZSBBdXRvd29ya3M8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiNmZmY7Zm9udC1zaXplOjE4cHg7Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi10b3A6NnB4O1wiPk9ycGhhbiBTdHJpcGUgcGF5bWVudCBhbGVydDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzoyMHB4IDI0cHg7Y29sb3I6cmdiYSgyNTUsMjU1LDI1NSwwLjg2KTtmb250LXNpemU6MTRweDtsaW5lLWhlaWdodDoxLjY7XCI+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjEwcHg7XCI+PHN0cm9uZz5FdmVudDo8L3N0cm9uZz4gJHtpbnB1dC5zdHJpcGVFdmVudElkfTwvZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLWJvdHRvbToxMHB4O1wiPjxzdHJvbmc+U2Vzc2lvbjo8L3N0cm9uZz4gJHtpbnB1dC5zdHJpcGVTZXNzaW9uSWQgfHwgXCIodW5rbm93bilcIn08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTBweDtcIj48c3Ryb25nPmJvb2tpbmdJZCBtZXRhZGF0YTo8L3N0cm9uZz4gJHtpbnB1dC5ib29raW5nSWQgfHwgXCIobWlzc2luZylcIn08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTBweDtcIj48c3Ryb25nPkFtb3VudDo8L3N0cm9uZz4gJHtpbnB1dC5hbW91bnRUb3RhbCAhPSBudWxsID8gU3RyaW5nKGlucHV0LmFtb3VudFRvdGFsKSA6IFwiKHVua25vd24pXCJ9ICR7aW5wdXQuY3VycmVuY3kgfHwgXCJcIn08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6MTRweDtjb2xvcjpyZ2JhKDI1NSwyNTUsMjU1LDAuNyk7XCI+XG4gICAgICAgICAgQWN0aW9uOiBjaGVjayBTdHJpcGUgZGFzaGJvYXJkIGZvciB0aGUgc2Vzc2lvbi9wYXltZW50IGludGVudCwgdGhlbiB2ZXJpZnkgYm9va2luZyBwZXJzaXN0ZW5jZSBhbmQgcmVjb25jaWxlIG1hbnVhbGx5LlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5gO1xuXG4gIGF3YWl0IHNlbmRFbWFpbCh7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBodG1sIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFF1b3RlQ3JlYXRlZEJ1c2luZXNzRW1haWwoaW5wdXQ6IHtcbiAgdG9FbWFpbDogc3RyaW5nO1xuICBxdW90ZVB1YmxpY0lkOiBzdHJpbmc7XG4gIGNhdGVnb3J5OiBzdHJpbmc7XG4gIHVyZ2VuY3k6IHN0cmluZztcbiAgYWRkcmVzc09uZUxpbmU6IHN0cmluZztcbiAgY3VzdG9tZXJOYW1lOiBzdHJpbmc7XG4gIGN1c3RvbWVyUGhvbmU6IHN0cmluZztcbiAgY3VzdG9tZXJFbWFpbDogc3RyaW5nIHwgbnVsbDtcbiAgdmVoaWNsZVBsYXRlOiBzdHJpbmc7XG4gIHZlaGljbGVNYWtlOiBzdHJpbmcgfCBudWxsO1xuICB2ZWhpY2xlTW9kZWw6IHN0cmluZyB8IG51bGw7XG4gIHZlaGljbGVZZWFyOiBudW1iZXIgfCBudWxsO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBzeW1wdG9tczogc3RyaW5nW107XG4gIGFkbWluVXJsOiBzdHJpbmc7XG59KSB7XG4gIGNvbnN0IHJlc2VuZCA9IGdldFJlc2VuZENsaWVudCgpO1xuXG4gIGNvbnN0IHN1YmplY3QgPSBgTmV3IHF1b3RlIHJlcXVlc3Q6ICR7aW5wdXQucXVvdGVQdWJsaWNJZH1gO1xuXG4gIGNvbnN0IGh0bWwgPSBgXG4gIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kOiMwYTBhMGE7cGFkZGluZzoyNHB4O2ZvbnQtZmFtaWx5OnVpLXNhbnMtc2VyaWYsc3lzdGVtLXVpLC1hcHBsZS1zeXN0ZW0sU2Vnb2UgVUksUm9ib3RvLEhlbHZldGljYSxBcmlhbDtcIj5cbiAgICA8ZGl2IHN0eWxlPVwibWF4LXdpZHRoOjcyMHB4O21hcmdpbjowIGF1dG87YmFja2dyb3VuZDojMTExO2JvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTtib3JkZXItcmFkaXVzOjEycHg7b3ZlcmZsb3c6aGlkZGVuO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6MjBweCAyNHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7XCI+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJjb2xvcjojZjZjOTBlO2ZvbnQtd2VpZ2h0OjcwMDtcIj5Nb2JpbGUgQXV0b3dvcmtzPC9kaXY+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJjb2xvcjojZmZmO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtd2VpZ2h0OjcwMDttYXJnaW4tdG9wOjZweDtcIj5OZXcgcXVvdGUgcmVxdWVzdDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzoyMHB4IDI0cHg7Y29sb3I6cmdiYSgyNTUsMjU1LDI1NSwwLjg2KTtmb250LXNpemU6MTRweDtsaW5lLWhlaWdodDoxLjY7XCI+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjE0cHg7XCI+PHN0cm9uZz5SZWZlcmVuY2U6PC9zdHJvbmc+ICR7aW5wdXQucXVvdGVQdWJsaWNJZH08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTRweDtcIj48c3Ryb25nPkNhdGVnb3J5Ojwvc3Ryb25nPiAke2lucHV0LmNhdGVnb3J5fTwvZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLWJvdHRvbToxNHB4O1wiPjxzdHJvbmc+VXJnZW5jeTo8L3N0cm9uZz4gJHtpbnB1dC51cmdlbmN5fTwvZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLWJvdHRvbToxNHB4O1wiPjxzdHJvbmc+QWRkcmVzczo8L3N0cm9uZz4gJHtpbnB1dC5hZGRyZXNzT25lTGluZX08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTRweDtcIj48c3Ryb25nPlZlaGljbGU6PC9zdHJvbmc+ICR7W1xuICAgICAgICAgIGlucHV0LnZlaGljbGVQbGF0ZSxcbiAgICAgICAgICBpbnB1dC52ZWhpY2xlWWVhciA/IFN0cmluZyhpbnB1dC52ZWhpY2xlWWVhcikgOiBudWxsLFxuICAgICAgICAgIGlucHV0LnZlaGljbGVNYWtlLFxuICAgICAgICAgIGlucHV0LnZlaGljbGVNb2RlbCxcbiAgICAgICAgXVxuICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgICAuam9pbihcIiBcIil9PC9kaXY+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjE0cHg7XCI+PHN0cm9uZz5TeW1wdG9tczo8L3N0cm9uZz4gJHsoaW5wdXQuc3ltcHRvbXMgfHwgW10pLmxlbmd0aCA/IChpbnB1dC5zeW1wdG9tcyB8fCBbXSkuam9pbihcIiwgXCIpIDogXCIobm9uZSlcIn08L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206MTRweDtcIj48c3Ryb25nPkRlc2NyaXB0aW9uOjwvc3Ryb25nPjxici8+JHsoaW5wdXQuZGVzY3JpcHRpb24gfHwgXCJcIikucmVwbGFjZSgvXFxuL2csIFwiPGJyLz5cIil9PC9kaXY+XG5cbiAgICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6MThweDtwYWRkaW5nOjE0cHg7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpO2JvcmRlci1yYWRpdXM6MTBweDtiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsMC4wNCk7XCI+XG4gICAgICAgICAgPGRpdiBzdHlsZT1cImZvbnQtd2VpZ2h0OjcwMDtjb2xvcjojZmZmO21hcmdpbi1ib3R0b206OHB4O1wiPkN1c3RvbWVyPC9kaXY+XG4gICAgICAgICAgPGRpdj48c3Ryb25nPk5hbWU6PC9zdHJvbmc+ICR7aW5wdXQuY3VzdG9tZXJOYW1lfTwvZGl2PlxuICAgICAgICAgIDxkaXY+PHN0cm9uZz5QaG9uZTo8L3N0cm9uZz4gJHtpbnB1dC5jdXN0b21lclBob25lfTwvZGl2PlxuICAgICAgICAgIDxkaXY+PHN0cm9uZz5FbWFpbDo8L3N0cm9uZz4gJHtpbnB1dC5jdXN0b21lckVtYWlsIHx8IFwiKG5vdCBwcm92aWRlZClcIn08L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPHAgc3R5bGU9XCJtYXJnaW46MThweCAwO1wiPlxuICAgICAgICAgIDxhIGhyZWY9XCIke2lucHV0LmFkbWluVXJsfVwiIHN0eWxlPVwiZGlzcGxheTppbmxpbmUtYmxvY2s7YmFja2dyb3VuZDojZjZjOTBlO2NvbG9yOiMwMDA7cGFkZGluZzoxMnB4IDE2cHg7Ym9yZGVyLXJhZGl1czoxMHB4O3RleHQtZGVjb3JhdGlvbjpub25lO2ZvbnQtd2VpZ2h0OjcwMDtcIj5PcGVuIEFkbWluIERhc2hib2FyZDwvYT5cbiAgICAgICAgPC9wPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PmA7XG5cbiAgaWYgKCFyZXNlbmQgJiYgIWdldFNtdHBDb25maWcoKSkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgY29uc29sZS5sb2coXCJbREVWIEVNQUlMXVwiLCB7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBxdW90ZVB1YmxpY0lkOiBpbnB1dC5xdW90ZVB1YmxpY0lkIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IHNlbmRFbWFpbCh7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBodG1sIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFNlcnZpY2VSZXBvcnRSZWFkeUVtYWlsKGlucHV0OiB7XG4gIHRvRW1haWw6IHN0cmluZztcbiAgcmVwb3J0VGl0bGU6IHN0cmluZztcbiAgcmVwb3J0VXJsOiBzdHJpbmc7XG4gIGJvb2tpbmdSZWY6IHN0cmluZztcbn0pIHtcbiAgY29uc3QgcmVzZW5kID0gZ2V0UmVzZW5kQ2xpZW50KCk7XG5cbiAgY29uc3Qgc3ViamVjdCA9IGAke2lucHV0LnJlcG9ydFRpdGxlfSBpcyByZWFkeWA7XG5cbiAgY29uc3QgaHRtbCA9IGBcbiAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IzBhMGEwYTtwYWRkaW5nOjI0cHg7Zm9udC1mYW1pbHk6dWktc2Fucy1zZXJpZixzeXN0ZW0tdWksLWFwcGxlLXN5c3RlbSxTZWdvZSBVSSxSb2JvdG8sSGVsdmV0aWNhLEFyaWFsO1wiPlxuICAgIDxkaXYgc3R5bGU9XCJtYXgtd2lkdGg6NjQwcHg7bWFyZ2luOjAgYXV0bztiYWNrZ3JvdW5kOiMxMTE7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpO2JvcmRlci1yYWRpdXM6MTJweDtvdmVyZmxvdzpoaWRkZW47XCI+XG4gICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzoyMHB4IDI0cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTtcIj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiNmNmM5MGU7Zm9udC13ZWlnaHQ6NzAwO1wiPk1vYmlsZSBBdXRvd29ya3M8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiNmZmY7Zm9udC1zaXplOjE4cHg7Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi10b3A6NnB4O1wiPllvdXIgcmVwb3J0IGlzIHJlYWR5PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgc3R5bGU9XCJwYWRkaW5nOjIwcHggMjRweDtjb2xvcjpyZ2JhKDI1NSwyNTUsMjU1LDAuODYpO2ZvbnQtc2l6ZToxNHB4O2xpbmUtaGVpZ2h0OjEuNjtcIj5cbiAgICAgICAgPHA+WW91ciA8c3Ryb25nPiR7aW5wdXQucmVwb3J0VGl0bGV9PC9zdHJvbmc+IGlzIHJlYWR5IHRvIHZpZXcuPC9wPlxuICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbjoxOHB4IDA7XCI+XG4gICAgICAgICAgPGEgaHJlZj1cIiR7aW5wdXQucmVwb3J0VXJsfVwiIHN0eWxlPVwiZGlzcGxheTppbmxpbmUtYmxvY2s7YmFja2dyb3VuZDojZjZjOTBlO2NvbG9yOiMwMDA7cGFkZGluZzoxMnB4IDE2cHg7Ym9yZGVyLXJhZGl1czoxMHB4O3RleHQtZGVjb3JhdGlvbjpub25lO2ZvbnQtd2VpZ2h0OjcwMDtcIj5WaWV3IHJlcG9ydDwvYT5cbiAgICAgICAgPC9wPlxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsMC42NSk7Zm9udC1zaXplOjEycHg7XCI+Qm9va2luZyByZWZlcmVuY2U6ICR7aW5wdXQuYm9va2luZ1JlZn08L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+YDtcblxuICBpZiAoIXJlc2VuZCAmJiAhZ2V0U210cENvbmZpZygpKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLmxvZyhcIltERVYgRU1BSUxdXCIsIHsgdG86IGlucHV0LnRvRW1haWwsIHN1YmplY3QsIGJvb2tpbmdSZWY6IGlucHV0LmJvb2tpbmdSZWYsIHJlcG9ydFVybDogaW5wdXQucmVwb3J0VXJsIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IHNlbmRFbWFpbCh7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBodG1sIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZEJvb2tpbmdDcmVhdGVkUGF5bWVudFJlcXVpcmVkRW1haWwoaW5wdXQ6IHtcbiAgYm9va2luZ0lkOiBzdHJpbmc7XG4gIHRvRW1haWw6IHN0cmluZztcbiAgY2hlY2tvdXRVcmw6IHN0cmluZztcbn0pIHtcbiAgY29uc3QgcmVzZW5kID0gZ2V0UmVzZW5kQ2xpZW50KCk7XG5cbiAgY29uc3Qgc3ViamVjdCA9IFwiQ29tcGxldGUgcGF5bWVudCB0byBjb25maXJtIHlvdXIgYm9va2luZ1wiO1xuXG4gIGNvbnN0IGh0bWwgPSBgXG4gIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kOiMwYTBhMGE7cGFkZGluZzoyNHB4O2ZvbnQtZmFtaWx5OnVpLXNhbnMtc2VyaWYsc3lzdGVtLXVpLC1hcHBsZS1zeXN0ZW0sU2Vnb2UgVUksUm9ib3RvLEhlbHZldGljYSxBcmlhbDtcIj5cbiAgICA8ZGl2IHN0eWxlPVwibWF4LXdpZHRoOjY0MHB4O21hcmdpbjowIGF1dG87YmFja2dyb3VuZDojMTExO2JvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTtib3JkZXItcmFkaXVzOjEycHg7b3ZlcmZsb3c6aGlkZGVuO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6MjBweCAyNHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7XCI+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJjb2xvcjojZjZjOTBlO2ZvbnQtd2VpZ2h0OjcwMDtcIj5Nb2JpbGUgQXV0b3dvcmtzPC9kaXY+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJjb2xvcjojZmZmO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtd2VpZ2h0OjcwMDttYXJnaW4tdG9wOjZweDtcIj5QYXltZW50IHJlcXVpcmVkIHRvIGNvbmZpcm08L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6MjBweCAyNHB4O2NvbG9yOnJnYmEoMjU1LDI1NSwyNTUsMC44Nik7Zm9udC1zaXplOjE0cHg7bGluZS1oZWlnaHQ6MS42O1wiPlxuICAgICAgICA8cD5UaGFua3MgZm9yIHlvdXIgYm9va2luZyByZXF1ZXN0LiBUbyBjb25maXJtIHlvdXIgYXBwb2ludG1lbnQsIHBsZWFzZSBjb21wbGV0ZSBwYXltZW50IHVzaW5nIHRoZSBidXR0b24gYmVsb3cuPC9wPlxuICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbjoxOHB4IDA7XCI+XG4gICAgICAgICAgPGEgaHJlZj1cIiR7aW5wdXQuY2hlY2tvdXRVcmx9XCIgc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jaztiYWNrZ3JvdW5kOiNmNmM5MGU7Y29sb3I6IzAwMDtwYWRkaW5nOjEycHggMTZweDtib3JkZXItcmFkaXVzOjEwcHg7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Zm9udC13ZWlnaHQ6NzAwO1wiPlBheSBub3cgdG8gY29uZmlybTwvYT5cbiAgICAgICAgPC9wPlxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsMC42NSk7Zm9udC1zaXplOjEycHg7XCI+Qm9va2luZyByZWZlcmVuY2U6ICR7aW5wdXQuYm9va2luZ0lkfTwvcD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5gO1xuXG4gIGlmICghcmVzZW5kICYmICFnZXRTbXRwQ29uZmlnKCkpIHtcbiAgICAvLyBERVYgZmFsbGJhY2s6IGxvZyB0byBzZXJ2ZXIgY29uc29sZVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgY29uc29sZS5sb2coXCJbREVWIEVNQUlMXVwiLCB7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBib29raW5nSWQ6IGlucHV0LmJvb2tpbmdJZCwgY2hlY2tvdXRVcmw6IGlucHV0LmNoZWNrb3V0VXJsIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IHNlbmRFbWFpbCh7IHRvOiBpbnB1dC50b0VtYWlsLCBzdWJqZWN0LCBodG1sIH0pO1xufVxuIl0sIm5hbWVzIjpbIlJlc2VuZCIsIm5vZGVtYWlsZXIiLCJnZXRSZXNlbmRDbGllbnQiLCJrZXkiLCJwcm9jZXNzIiwiZW52IiwiUkVTRU5EX0FQSV9LRVkiLCJnZXRFbWFpbEZyb20iLCJFTUFJTF9GUk9NIiwiZ2V0U210cENvbmZpZyIsInVzZXIiLCJTTVRQX1VTRVIiLCJ0cmltIiwicGFzcyIsIlNNVFBfUEFTUyIsImhvc3QiLCJTTVRQX0hPU1QiLCJwb3J0IiwiTnVtYmVyIiwiU01UUF9QT1JUIiwic2VjdXJlIiwiU3RyaW5nIiwiU01UUF9TRUNVUkUiLCJ0b0xvd2VyQ2FzZSIsInNlbmRFbWFpbCIsImlucHV0IiwiZW1haWxGcm9tIiwic210cCIsInRyYW5zcG9ydGVyIiwiY3JlYXRlVHJhbnNwb3J0IiwiYXV0aCIsInNlbmRNYWlsIiwiZnJvbSIsInRvIiwic3ViamVjdCIsImh0bWwiLCJyZXNlbmQiLCJjb25zb2xlIiwibG9nIiwiZW1haWxzIiwic2VuZCIsInNlbmRCb29raW5nQ29uZmlybWVkQnVzaW5lc3NFbWFpbCIsImJvb2tpbmdQdWJsaWNJZCIsInNjaGVkdWxlZFN0YXJ0SXNvIiwiYWRkcmVzc09uZUxpbmUiLCJ2ZWhpY2xlUGxhdGUiLCJzeW1wdG9tcyIsInJlcGxhY2UiLCJjdXN0b21lck5hbWUiLCJjdXN0b21lclBob25lIiwiY3VzdG9tZXJFbWFpbCIsImFkbWluVXJsIiwidG9FbWFpbCIsInNlbmRCb29raW5nRmFsbGJhY2tCdXNpbmVzc0VtYWlsIiwic2NoZWR1bGVkU3RhcnRMb2NhbCIsImFkZHJlc3MiLCJzZW5kU3RyaXBlT3JwaGFuUGF5bWVudEJ1c2luZXNzRW1haWwiLCJzdHJpcGVFdmVudElkIiwic3RyaXBlU2Vzc2lvbklkIiwiYm9va2luZ0lkIiwiYW1vdW50VG90YWwiLCJjdXJyZW5jeSIsInNlbmRRdW90ZUNyZWF0ZWRCdXNpbmVzc0VtYWlsIiwicXVvdGVQdWJsaWNJZCIsImNhdGVnb3J5IiwidXJnZW5jeSIsInZlaGljbGVZZWFyIiwidmVoaWNsZU1ha2UiLCJ2ZWhpY2xlTW9kZWwiLCJmaWx0ZXIiLCJCb29sZWFuIiwiam9pbiIsImxlbmd0aCIsImRlc2NyaXB0aW9uIiwic2VuZFNlcnZpY2VSZXBvcnRSZWFkeUVtYWlsIiwicmVwb3J0VGl0bGUiLCJyZXBvcnRVcmwiLCJib29raW5nUmVmIiwic2VuZEJvb2tpbmdDcmVhdGVkUGF5bWVudFJlcXVpcmVkRW1haWwiLCJjaGVja291dFVybCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/email.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/pricing.ts":
/*!*******************************!*\
  !*** ./src/server/pricing.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ServiceType: () => (/* binding */ ServiceType),\n/* harmony export */   computePricing: () => (/* binding */ computePricing)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js\");\n\nconst ServiceType = zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n    \"DIAGNOSTICS\",\n    \"PPI\"\n]);\nconst PaymentPolicy = zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n    \"REQUIRED\",\n    \"DEPOSIT\",\n    \"PAY_LATER\"\n]);\nfunction isAfterHoursAuckland(scheduledStartLocal) {\n    // scheduledStartLocal expected format: YYYY-MM-DDTHH:mm (Pacific/Auckland local wall time)\n    const m = /^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})$/.exec(scheduledStartLocal);\n    if (!m) return false;\n    const year = Number(m[1]);\n    const month = Number(m[2]);\n    const dayOfMonth = Number(m[3]);\n    const hour = Number(m[4]);\n    // Day-of-week depends on the calendar date, not the timezone.\n    const day = new Date(Date.UTC(year, month - 1, dayOfMonth)).getUTCDay();\n    const isWeekend = day === 0 || day === 6;\n    if (isWeekend) return true;\n    // Mon-Fri, outside 08:00-18:00 is after-hours\n    return hour < 8 || hour >= 18;\n}\nfunction computePricing(input) {\n    const diagnosticsTotalCents = 14000;\n    const ppiDepositCents = 15000;\n    // Per your instruction: after-hours surcharge applies to labour, not flat fees.\n    // At bootstrap we record it but do not add to Stripe line items.\n    const afterHours = isAfterHoursAuckland(input.scheduledStartLocal);\n    const labourSurchargeRate = afterHours ? 0.25 : 0;\n    const paymentExpiryMinutes = 60;\n    if (input.serviceType === \"DIAGNOSTICS\") {\n        const stripeLineItems = [\n            {\n                quantity: 1,\n                price_data: {\n                    currency: \"nzd\",\n                    unit_amount: diagnosticsTotalCents,\n                    product_data: {\n                        name: \"Mobile Diagnostics\"\n                    }\n                }\n            }\n        ];\n        return {\n            paymentPolicy: \"REQUIRED\",\n            paymentExpiryMinutes,\n            pricingJson: {\n                currency: \"NZD\",\n                diagnosticsTotalCents,\n                afterHours,\n                labourSurchargeRate,\n                stripeLineItems\n            }\n        };\n    }\n    // PPI default: deposit required\n    const stripeLineItems = [\n        {\n            quantity: 1,\n            price_data: {\n                currency: \"nzd\",\n                unit_amount: ppiDepositCents,\n                product_data: {\n                    name: \"Pre-Purchase Inspection (Deposit)\"\n                }\n            }\n        }\n    ];\n    return {\n        paymentPolicy: \"DEPOSIT\",\n        paymentExpiryMinutes,\n        pricingJson: {\n            currency: \"NZD\",\n            ppiDepositCents,\n            afterHours,\n            labourSurchargeRate,\n            stripeLineItems\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3ByaWNpbmcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXdCO0FBRWpCLE1BQU1DLGNBQWNELHdDQUFNLENBQUM7SUFBQztJQUFlO0NBQU0sRUFBRTtBQUcxRCxNQUFNRyxnQkFBZ0JILHdDQUFNLENBQUM7SUFBQztJQUFZO0lBQVc7Q0FBWTtBQUdqRSxTQUFTSSxxQkFBcUJDLG1CQUEyQjtJQUN2RCwyRkFBMkY7SUFDM0YsTUFBTUMsSUFBSSwyREFBMkRDLElBQUksQ0FBQ0Y7SUFDMUUsSUFBSSxDQUFDQyxHQUFHLE9BQU87SUFFZixNQUFNRSxPQUFPQyxPQUFPSCxDQUFDLENBQUMsRUFBRTtJQUN4QixNQUFNSSxRQUFRRCxPQUFPSCxDQUFDLENBQUMsRUFBRTtJQUN6QixNQUFNSyxhQUFhRixPQUFPSCxDQUFDLENBQUMsRUFBRTtJQUM5QixNQUFNTSxPQUFPSCxPQUFPSCxDQUFDLENBQUMsRUFBRTtJQUV4Qiw4REFBOEQ7SUFDOUQsTUFBTU8sTUFBTSxJQUFJQyxLQUFLQSxLQUFLQyxHQUFHLENBQUNQLE1BQU1FLFFBQVEsR0FBR0MsYUFBYUssU0FBUztJQUVyRSxNQUFNQyxZQUFZSixRQUFRLEtBQUtBLFFBQVE7SUFDdkMsSUFBSUksV0FBVyxPQUFPO0lBRXRCLDhDQUE4QztJQUM5QyxPQUFPTCxPQUFPLEtBQUtBLFFBQVE7QUFDN0I7QUFFTyxTQUFTTSxlQUFlQyxLQUFnRTtJQUM3RixNQUFNQyx3QkFBd0I7SUFDOUIsTUFBTUMsa0JBQWtCO0lBRXhCLGdGQUFnRjtJQUNoRixpRUFBaUU7SUFDakUsTUFBTUMsYUFBYWxCLHFCQUFxQmUsTUFBTWQsbUJBQW1CO0lBQ2pFLE1BQU1rQixzQkFBc0JELGFBQWEsT0FBTztJQUVoRCxNQUFNRSx1QkFBdUI7SUFFN0IsSUFBSUwsTUFBTU0sV0FBVyxLQUFLLGVBQWU7UUFDdkMsTUFBTUMsa0JBQWtCO1lBQ3RCO2dCQUNFQyxVQUFVO2dCQUNWQyxZQUFZO29CQUNWQyxVQUFVO29CQUNWQyxhQUFhVjtvQkFDYlcsY0FBYzt3QkFDWkMsTUFBTTtvQkFDUjtnQkFDRjtZQUNGO1NBQ0Q7UUFFRCxPQUFPO1lBQ0xDLGVBQWU7WUFDZlQ7WUFDQVUsYUFBYTtnQkFDWEwsVUFBVTtnQkFDVlQ7Z0JBQ0FFO2dCQUNBQztnQkFDQUc7WUFDRjtRQUNGO0lBQ0Y7SUFFQSxnQ0FBZ0M7SUFDaEMsTUFBTUEsa0JBQWtCO1FBQ3RCO1lBQ0VDLFVBQVU7WUFDVkMsWUFBWTtnQkFDVkMsVUFBVTtnQkFDVkMsYUFBYVQ7Z0JBQ2JVLGNBQWM7b0JBQ1pDLE1BQU07Z0JBQ1I7WUFDRjtRQUNGO0tBQ0Q7SUFFRCxPQUFPO1FBQ0xDLGVBQWU7UUFDZlQ7UUFDQVUsYUFBYTtZQUNYTCxVQUFVO1lBQ1ZSO1lBQ0FDO1lBQ0FDO1lBQ0FHO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJDOlxcbnptb2JpbGVhdXRvc1xcbmV4dFxcc3JjXFxzZXJ2ZXJcXHByaWNpbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcblxuZXhwb3J0IGNvbnN0IFNlcnZpY2VUeXBlID0gei5lbnVtKFtcIkRJQUdOT1NUSUNTXCIsIFwiUFBJXCJdKTtcbmV4cG9ydCB0eXBlIFNlcnZpY2VUeXBlID0gei5pbmZlcjx0eXBlb2YgU2VydmljZVR5cGU+O1xuXG5jb25zdCBQYXltZW50UG9saWN5ID0gei5lbnVtKFtcIlJFUVVJUkVEXCIsIFwiREVQT1NJVFwiLCBcIlBBWV9MQVRFUlwiXSk7XG5leHBvcnQgdHlwZSBQYXltZW50UG9saWN5ID0gei5pbmZlcjx0eXBlb2YgUGF5bWVudFBvbGljeT47XG5cbmZ1bmN0aW9uIGlzQWZ0ZXJIb3Vyc0F1Y2tsYW5kKHNjaGVkdWxlZFN0YXJ0TG9jYWw6IHN0cmluZykge1xuICAvLyBzY2hlZHVsZWRTdGFydExvY2FsIGV4cGVjdGVkIGZvcm1hdDogWVlZWS1NTS1ERFRISDptbSAoUGFjaWZpYy9BdWNrbGFuZCBsb2NhbCB3YWxsIHRpbWUpXG4gIGNvbnN0IG0gPSAvXihbMC05XXs0fSktKFswLTldezJ9KS0oWzAtOV17Mn0pVChbMC05XXsyfSk6KFswLTldezJ9KSQvLmV4ZWMoc2NoZWR1bGVkU3RhcnRMb2NhbCk7XG4gIGlmICghbSkgcmV0dXJuIGZhbHNlO1xuXG4gIGNvbnN0IHllYXIgPSBOdW1iZXIobVsxXSk7XG4gIGNvbnN0IG1vbnRoID0gTnVtYmVyKG1bMl0pO1xuICBjb25zdCBkYXlPZk1vbnRoID0gTnVtYmVyKG1bM10pO1xuICBjb25zdCBob3VyID0gTnVtYmVyKG1bNF0pO1xuXG4gIC8vIERheS1vZi13ZWVrIGRlcGVuZHMgb24gdGhlIGNhbGVuZGFyIGRhdGUsIG5vdCB0aGUgdGltZXpvbmUuXG4gIGNvbnN0IGRheSA9IG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoIC0gMSwgZGF5T2ZNb250aCkpLmdldFVUQ0RheSgpO1xuXG4gIGNvbnN0IGlzV2Vla2VuZCA9IGRheSA9PT0gMCB8fCBkYXkgPT09IDY7XG4gIGlmIChpc1dlZWtlbmQpIHJldHVybiB0cnVlO1xuXG4gIC8vIE1vbi1GcmksIG91dHNpZGUgMDg6MDAtMTg6MDAgaXMgYWZ0ZXItaG91cnNcbiAgcmV0dXJuIGhvdXIgPCA4IHx8IGhvdXIgPj0gMTg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlUHJpY2luZyhpbnB1dDogeyBzZXJ2aWNlVHlwZTogU2VydmljZVR5cGU7IHNjaGVkdWxlZFN0YXJ0TG9jYWw6IHN0cmluZyB9KSB7XG4gIGNvbnN0IGRpYWdub3N0aWNzVG90YWxDZW50cyA9IDE0MDAwO1xuICBjb25zdCBwcGlEZXBvc2l0Q2VudHMgPSAxNTAwMDtcblxuICAvLyBQZXIgeW91ciBpbnN0cnVjdGlvbjogYWZ0ZXItaG91cnMgc3VyY2hhcmdlIGFwcGxpZXMgdG8gbGFib3VyLCBub3QgZmxhdCBmZWVzLlxuICAvLyBBdCBib290c3RyYXAgd2UgcmVjb3JkIGl0IGJ1dCBkbyBub3QgYWRkIHRvIFN0cmlwZSBsaW5lIGl0ZW1zLlxuICBjb25zdCBhZnRlckhvdXJzID0gaXNBZnRlckhvdXJzQXVja2xhbmQoaW5wdXQuc2NoZWR1bGVkU3RhcnRMb2NhbCk7XG4gIGNvbnN0IGxhYm91clN1cmNoYXJnZVJhdGUgPSBhZnRlckhvdXJzID8gMC4yNSA6IDA7XG5cbiAgY29uc3QgcGF5bWVudEV4cGlyeU1pbnV0ZXMgPSA2MDtcblxuICBpZiAoaW5wdXQuc2VydmljZVR5cGUgPT09IFwiRElBR05PU1RJQ1NcIikge1xuICAgIGNvbnN0IHN0cmlwZUxpbmVJdGVtcyA9IFtcbiAgICAgIHtcbiAgICAgICAgcXVhbnRpdHk6IDEsXG4gICAgICAgIHByaWNlX2RhdGE6IHtcbiAgICAgICAgICBjdXJyZW5jeTogXCJuemRcIixcbiAgICAgICAgICB1bml0X2Ftb3VudDogZGlhZ25vc3RpY3NUb3RhbENlbnRzLFxuICAgICAgICAgIHByb2R1Y3RfZGF0YToge1xuICAgICAgICAgICAgbmFtZTogXCJNb2JpbGUgRGlhZ25vc3RpY3NcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICBdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBheW1lbnRQb2xpY3k6IFwiUkVRVUlSRURcIiBhcyBjb25zdCxcbiAgICAgIHBheW1lbnRFeHBpcnlNaW51dGVzLFxuICAgICAgcHJpY2luZ0pzb246IHtcbiAgICAgICAgY3VycmVuY3k6IFwiTlpEXCIsXG4gICAgICAgIGRpYWdub3N0aWNzVG90YWxDZW50cyxcbiAgICAgICAgYWZ0ZXJIb3VycyxcbiAgICAgICAgbGFib3VyU3VyY2hhcmdlUmF0ZSxcbiAgICAgICAgc3RyaXBlTGluZUl0ZW1zLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLy8gUFBJIGRlZmF1bHQ6IGRlcG9zaXQgcmVxdWlyZWRcbiAgY29uc3Qgc3RyaXBlTGluZUl0ZW1zID0gW1xuICAgIHtcbiAgICAgIHF1YW50aXR5OiAxLFxuICAgICAgcHJpY2VfZGF0YToge1xuICAgICAgICBjdXJyZW5jeTogXCJuemRcIixcbiAgICAgICAgdW5pdF9hbW91bnQ6IHBwaURlcG9zaXRDZW50cyxcbiAgICAgICAgcHJvZHVjdF9kYXRhOiB7XG4gICAgICAgICAgbmFtZTogXCJQcmUtUHVyY2hhc2UgSW5zcGVjdGlvbiAoRGVwb3NpdClcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgXTtcblxuICByZXR1cm4ge1xuICAgIHBheW1lbnRQb2xpY3k6IFwiREVQT1NJVFwiIGFzIGNvbnN0LFxuICAgIHBheW1lbnRFeHBpcnlNaW51dGVzLFxuICAgIHByaWNpbmdKc29uOiB7XG4gICAgICBjdXJyZW5jeTogXCJOWkRcIixcbiAgICAgIHBwaURlcG9zaXRDZW50cyxcbiAgICAgIGFmdGVySG91cnMsXG4gICAgICBsYWJvdXJTdXJjaGFyZ2VSYXRlLFxuICAgICAgc3RyaXBlTGluZUl0ZW1zLFxuICAgIH0sXG4gIH07XG59XG4iXSwibmFtZXMiOlsieiIsIlNlcnZpY2VUeXBlIiwiZW51bSIsIlBheW1lbnRQb2xpY3kiLCJpc0FmdGVySG91cnNBdWNrbGFuZCIsInNjaGVkdWxlZFN0YXJ0TG9jYWwiLCJtIiwiZXhlYyIsInllYXIiLCJOdW1iZXIiLCJtb250aCIsImRheU9mTW9udGgiLCJob3VyIiwiZGF5IiwiRGF0ZSIsIlVUQyIsImdldFVUQ0RheSIsImlzV2Vla2VuZCIsImNvbXB1dGVQcmljaW5nIiwiaW5wdXQiLCJkaWFnbm9zdGljc1RvdGFsQ2VudHMiLCJwcGlEZXBvc2l0Q2VudHMiLCJhZnRlckhvdXJzIiwibGFib3VyU3VyY2hhcmdlUmF0ZSIsInBheW1lbnRFeHBpcnlNaW51dGVzIiwic2VydmljZVR5cGUiLCJzdHJpcGVMaW5lSXRlbXMiLCJxdWFudGl0eSIsInByaWNlX2RhdGEiLCJjdXJyZW5jeSIsInVuaXRfYW1vdW50IiwicHJvZHVjdF9kYXRhIiwibmFtZSIsInBheW1lbnRQb2xpY3kiLCJwcmljaW5nSnNvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/pricing.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/stripe.ts":
/*!******************************!*\
  !*** ./src/server/stripe.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createCheckoutSessionForBooking: () => (/* binding */ createCheckoutSessionForBooking)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/.pnpm/stripe@18.5.0_@types+node@22.19.3/node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _server_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/db */ \"(rsc)/./src/server/db.ts\");\n\n\nfunction getStripeClient() {\n    const stripeSecretKey = process.env.STRIPE_SECRET_KEY;\n    if (!stripeSecretKey) return null;\n    return new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](stripeSecretKey);\n}\nasync function createCheckoutSessionForBooking(input) {\n    const appUrl = process.env.APP_URL || \"http://localhost:3000\";\n    const booking = input.booking;\n    // DEV bypass: no Stripe required.\n    if ((0,_server_db__WEBPACK_IMPORTED_MODULE_1__.isDevNoDb)() || !process.env.STRIPE_SECRET_KEY) {\n        return {\n            id: `dev_session_${booking.id}`,\n            url: `${appUrl}/checkout/success?bookingId=${booking.id}`\n        };\n    }\n    const stripe = getStripeClient();\n    if (!stripe) throw new Error(\"Missing STRIPE_SECRET_KEY\");\n    const pricing = booking.pricingSnapshotJson;\n    const lineItems = pricing?.stripeLineItems || [];\n    if (!Array.isArray(lineItems) || lineItems.length === 0) {\n        throw new Error(\"Missing Stripe line items in pricingSnapshotJson\");\n    }\n    const session = await stripe.checkout.sessions.create({\n        mode: \"payment\",\n        customer_email: input.customerEmail,\n        expires_at: Math.floor((booking.paymentExpiresAt?.getTime() || Date.now() + 60000) / 1000),\n        success_url: `${appUrl}/checkout/success?bookingId=${booking.id}`,\n        cancel_url: `${appUrl}/checkout/cancelled?bookingId=${booking.id}`,\n        metadata: {\n            bookingId: booking.id\n        },\n        line_items: lineItems,\n        payment_intent_data: {\n            metadata: {\n                bookingId: booking.id\n            }\n        }\n    });\n    return session;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3N0cmlwZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNEI7QUFFWTtBQUV4QyxTQUFTRTtJQUNQLE1BQU1DLGtCQUFrQkMsUUFBUUMsR0FBRyxDQUFDQyxpQkFBaUI7SUFDckQsSUFBSSxDQUFDSCxpQkFBaUIsT0FBTztJQUM3QixPQUFPLElBQUlILDhDQUFNQSxDQUFDRztBQUNwQjtBQUVPLGVBQWVJLGdDQUFnQ0MsS0FBd0Q7SUFDNUcsTUFBTUMsU0FBU0wsUUFBUUMsR0FBRyxDQUFDSyxPQUFPLElBQUk7SUFDdEMsTUFBTUMsVUFBVUgsTUFBTUcsT0FBTztJQUU3QixrQ0FBa0M7SUFDbEMsSUFBSVYscURBQVNBLE1BQU0sQ0FBQ0csUUFBUUMsR0FBRyxDQUFDQyxpQkFBaUIsRUFBRTtRQUNqRCxPQUFPO1lBQ0xNLElBQUksQ0FBQyxZQUFZLEVBQUVELFFBQVFDLEVBQUUsRUFBRTtZQUMvQkMsS0FBSyxHQUFHSixPQUFPLDRCQUE0QixFQUFFRSxRQUFRQyxFQUFFLEVBQUU7UUFDM0Q7SUFDRjtJQUVBLE1BQU1FLFNBQVNaO0lBQ2YsSUFBSSxDQUFDWSxRQUFRLE1BQU0sSUFBSUMsTUFBTTtJQUU3QixNQUFNQyxVQUFVTCxRQUFRTSxtQkFBbUI7SUFDM0MsTUFBTUMsWUFBNERGLFNBQVNHLG1CQUFtQixFQUFFO0lBQ2hHLElBQUksQ0FBQ0MsTUFBTUMsT0FBTyxDQUFDSCxjQUFjQSxVQUFVSSxNQUFNLEtBQUssR0FBRztRQUN2RCxNQUFNLElBQUlQLE1BQU07SUFDbEI7SUFFQSxNQUFNUSxVQUFVLE1BQU1ULE9BQU9VLFFBQVEsQ0FBQ0MsUUFBUSxDQUFDQyxNQUFNLENBQUM7UUFDcERDLE1BQU07UUFDTkMsZ0JBQWdCcEIsTUFBTXFCLGFBQWE7UUFDbkNDLFlBQVlDLEtBQUtDLEtBQUssQ0FBQyxDQUFFckIsUUFBUXNCLGdCQUFnQixFQUFFQyxhQUFhQyxLQUFLQyxHQUFHLEtBQUssS0FBSyxJQUFnQjtRQUNsR0MsYUFBYSxHQUFHNUIsT0FBTyw0QkFBNEIsRUFBRUUsUUFBUUMsRUFBRSxFQUFFO1FBQ2pFMEIsWUFBWSxHQUFHN0IsT0FBTyw4QkFBOEIsRUFBRUUsUUFBUUMsRUFBRSxFQUFFO1FBQ2xFMkIsVUFBVTtZQUNSQyxXQUFXN0IsUUFBUUMsRUFBRTtRQUN2QjtRQUNBNkIsWUFBWXZCO1FBQ1p3QixxQkFBcUI7WUFDbkJILFVBQVU7Z0JBQ1JDLFdBQVc3QixRQUFRQyxFQUFFO1lBQ3ZCO1FBQ0Y7SUFDRjtJQUVBLE9BQU9XO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxuem1vYmlsZWF1dG9zXFxuZXh0XFxzcmNcXHNlcnZlclxcc3RyaXBlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJpcGUgZnJvbSBcInN0cmlwZVwiO1xuaW1wb3J0IHR5cGUgeyBCb29raW5nUmVjb3JkIH0gZnJvbSBcIkAvc2VydmVyL2RiXCI7XG5pbXBvcnQgeyBpc0Rldk5vRGIgfSBmcm9tIFwiQC9zZXJ2ZXIvZGJcIjtcblxuZnVuY3Rpb24gZ2V0U3RyaXBlQ2xpZW50KCkge1xuICBjb25zdCBzdHJpcGVTZWNyZXRLZXkgPSBwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWTtcbiAgaWYgKCFzdHJpcGVTZWNyZXRLZXkpIHJldHVybiBudWxsO1xuICByZXR1cm4gbmV3IFN0cmlwZShzdHJpcGVTZWNyZXRLZXkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ2hlY2tvdXRTZXNzaW9uRm9yQm9va2luZyhpbnB1dDogeyBib29raW5nOiBCb29raW5nUmVjb3JkOyBjdXN0b21lckVtYWlsOiBzdHJpbmcgfSkge1xuICBjb25zdCBhcHBVcmwgPSBwcm9jZXNzLmVudi5BUFBfVVJMIHx8IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwXCI7XG4gIGNvbnN0IGJvb2tpbmcgPSBpbnB1dC5ib29raW5nO1xuXG4gIC8vIERFViBieXBhc3M6IG5vIFN0cmlwZSByZXF1aXJlZC5cbiAgaWYgKGlzRGV2Tm9EYigpIHx8ICFwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWSkge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogYGRldl9zZXNzaW9uXyR7Ym9va2luZy5pZH1gLFxuICAgICAgdXJsOiBgJHthcHBVcmx9L2NoZWNrb3V0L3N1Y2Nlc3M/Ym9va2luZ0lkPSR7Ym9va2luZy5pZH1gLFxuICAgIH0gYXMgYW55O1xuICB9XG5cbiAgY29uc3Qgc3RyaXBlID0gZ2V0U3RyaXBlQ2xpZW50KCk7XG4gIGlmICghc3RyaXBlKSB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIFNUUklQRV9TRUNSRVRfS0VZXCIpO1xuXG4gIGNvbnN0IHByaWNpbmcgPSBib29raW5nLnByaWNpbmdTbmFwc2hvdEpzb24gYXMgYW55O1xuICBjb25zdCBsaW5lSXRlbXM6IFN0cmlwZS5DaGVja291dC5TZXNzaW9uQ3JlYXRlUGFyYW1zLkxpbmVJdGVtW10gPSBwcmljaW5nPy5zdHJpcGVMaW5lSXRlbXMgfHwgW107XG4gIGlmICghQXJyYXkuaXNBcnJheShsaW5lSXRlbXMpIHx8IGxpbmVJdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIFN0cmlwZSBsaW5lIGl0ZW1zIGluIHByaWNpbmdTbmFwc2hvdEpzb25cIik7XG4gIH1cblxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc3RyaXBlLmNoZWNrb3V0LnNlc3Npb25zLmNyZWF0ZSh7XG4gICAgbW9kZTogXCJwYXltZW50XCIsXG4gICAgY3VzdG9tZXJfZW1haWw6IGlucHV0LmN1c3RvbWVyRW1haWwsXG4gICAgZXhwaXJlc19hdDogTWF0aC5mbG9vcigoKGJvb2tpbmcucGF5bWVudEV4cGlyZXNBdD8uZ2V0VGltZSgpIHx8IERhdGUubm93KCkgKyA2MF8wMDApIGFzIG51bWJlcikgLyAxMDAwKSxcbiAgICBzdWNjZXNzX3VybDogYCR7YXBwVXJsfS9jaGVja291dC9zdWNjZXNzP2Jvb2tpbmdJZD0ke2Jvb2tpbmcuaWR9YCxcbiAgICBjYW5jZWxfdXJsOiBgJHthcHBVcmx9L2NoZWNrb3V0L2NhbmNlbGxlZD9ib29raW5nSWQ9JHtib29raW5nLmlkfWAsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIGJvb2tpbmdJZDogYm9va2luZy5pZCxcbiAgICB9LFxuICAgIGxpbmVfaXRlbXM6IGxpbmVJdGVtcyxcbiAgICBwYXltZW50X2ludGVudF9kYXRhOiB7XG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBib29raW5nSWQ6IGJvb2tpbmcuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIHJldHVybiBzZXNzaW9uO1xufVxuIl0sIm5hbWVzIjpbIlN0cmlwZSIsImlzRGV2Tm9EYiIsImdldFN0cmlwZUNsaWVudCIsInN0cmlwZVNlY3JldEtleSIsInByb2Nlc3MiLCJlbnYiLCJTVFJJUEVfU0VDUkVUX0tFWSIsImNyZWF0ZUNoZWNrb3V0U2Vzc2lvbkZvckJvb2tpbmciLCJpbnB1dCIsImFwcFVybCIsIkFQUF9VUkwiLCJib29raW5nIiwiaWQiLCJ1cmwiLCJzdHJpcGUiLCJFcnJvciIsInByaWNpbmciLCJwcmljaW5nU25hcHNob3RKc29uIiwibGluZUl0ZW1zIiwic3RyaXBlTGluZUl0ZW1zIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwic2Vzc2lvbiIsImNoZWNrb3V0Iiwic2Vzc2lvbnMiLCJjcmVhdGUiLCJtb2RlIiwiY3VzdG9tZXJfZW1haWwiLCJjdXN0b21lckVtYWlsIiwiZXhwaXJlc19hdCIsIk1hdGgiLCJmbG9vciIsInBheW1lbnRFeHBpcmVzQXQiLCJnZXRUaW1lIiwiRGF0ZSIsIm5vdyIsInN1Y2Nlc3NfdXJsIiwiY2FuY2VsX3VybCIsIm1ldGFkYXRhIiwiYm9va2luZ0lkIiwibGluZV9pdGVtcyIsInBheW1lbnRfaW50ZW50X2RhdGEiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/stripe.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3","vendor-chunks/zod@3.25.76","vendor-chunks/stripe@18.5.0_@types+node@22.19.3","vendor-chunks/nodemailer@6.10.1","vendor-chunks/math-intrinsics@1.1.0","vendor-chunks/es-errors@1.3.0","vendor-chunks/qs@6.14.0","vendor-chunks/call-bind-apply-helpers@1.0.2","vendor-chunks/get-proto@1.0.1","vendor-chunks/object-inspect@1.13.4","vendor-chunks/has-symbols@1.1.0","vendor-chunks/gopd@1.2.0","vendor-chunks/function-bind@1.1.2","vendor-chunks/resend@4.8.0_react-dom@19.2.3_react@19.2.3__react@19.2.3","vendor-chunks/side-channel@1.1.0","vendor-chunks/side-channel-weakmap@1.0.2","vendor-chunks/side-channel-map@1.0.1","vendor-chunks/side-channel-list@1.0.0","vendor-chunks/hasown@2.0.2","vendor-chunks/get-intrinsic@1.3.0","vendor-chunks/es-object-atoms@1.1.1","vendor-chunks/es-define-property@1.0.1","vendor-chunks/dunder-proto@1.0.1","vendor-chunks/call-bound@1.0.4"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@15.1.9_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fbookings%2Fcreate%2Froute&page=%2Fapi%2Fbookings%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbookings%2Fcreate%2Froute.ts&appDir=C%3A%5Cnzmobileautos%5Cnext%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cnzmobileautos%5Cnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();