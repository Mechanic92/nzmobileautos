(()=>{var e={};e.id=6361,e.ids=[3374,6361],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},95958:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>v,serverHooks:()=>C,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{GET:()=>y});var n=r(47268),i=r(61657),o=r(52624),s=r(88125),l=r(93374);let c=process.env.CARJAM_API_KEY;function u(e){return e.toUpperCase().replace(/[\s-]/g,"").trim()}function p(e){let t=u(e);return/^[A-Z0-9]{1,6}$/.test(t)}async function d(e){let t=u(e),r=await l.prisma.vehicleCache.findUnique({where:{plate:t}});if(!r)return null;if(r.expiresAt<new Date)return await l.prisma.vehicleCache.delete({where:{plate:t}}),null;let a=r.identityJson||{};return{found:!0,plate:r.plate,make:a.make,model:a.model,year:a.year,engineCc:a.engineCc,fuel:a.fuel,bodyStyle:a.bodyStyle,vin:a.vin}}async function m(e,t){let r=new Date;r.setDate(r.getDate()+30),await l.prisma.vehicleCache.upsert({where:{plate:e.plate},create:{plate:e.plate,identityJson:{make:e.make,model:e.model,year:e.year,fuel:e.fuel,bodyStyle:e.bodyStyle,vin:e.vin,engineCc:e.engineCc,...t},classificationJson:{},expiresAt:r,lastAccessAt:new Date,lookupCount:1},update:{identityJson:{make:e.make,model:e.model,year:e.year,fuel:e.fuel,bodyStyle:e.bodyStyle,vin:e.vin,engineCc:e.engineCc,...t},lastAccessAt:new Date,expiresAt:r}})}async function f(e){if(!c)return console.warn("[CarJam] API key not configured"),{found:!1,plate:e,error:"Vehicle lookup service not configured"};try{let t=`https://api.carjam.co.nz/car?plate=${encodeURIComponent(e)}&key=${c}`,r=await fetch(t,{method:"GET",headers:{Accept:"application/json"}});if(!r.ok){if(404===r.status)return{found:!1,plate:e,error:"Vehicle not found in NZ register"};throw Error(`CarJam API error: ${r.status}`)}let a=await r.json();if(!a.success||!a.idh)return{found:!1,plate:e,error:a.message||"Vehicle not found"};let n={found:!0,plate:e,make:a.idh.make,model:a.idh.model,year:a.idh.year_of_manufacture,engineCc:a.idh.engine_cc,fuel:a.idh.fuel,bodyStyle:a.idh.body_style,transmission:a.idh.transmission,colour:a.idh.main_colour,vin:a.idh.vin,oilCapacityL:a.specifications?.engine_oil_capacity_litres,oilGrade:a.specifications?.engine_oil_grade};return await m(n,a),n}catch(t){return console.error("[CarJam] API error:",t.message),{found:!1,plate:e,error:"Failed to lookup vehicle. Please try again or enter details manually."}}}async function h(e){let t=u(e);if(!p(t))return{found:!1,plate:t,error:"Invalid plate format. NZ plates are 1-6 alphanumeric characters."};let r=await d(t);return r?(console.log(`[CarJam] Cache hit for plate: ${t}`),r):(console.log(`[CarJam] Fetching from API for plate: ${t}`),f(t))}async function y(e,{params:t}){try{let{plate:e}=await t;if(!e)return s.NextResponse.json({error:"Plate parameter is required"},{status:400});let r=u(e);if(!p(r))return s.NextResponse.json({found:!1,plate:r,error:"Invalid plate format. NZ plates are 1-6 alphanumeric characters."},{status:400});let a=await h(r);return s.NextResponse.json(a)}catch(e){return console.error("[API] Vehicle lookup error:",e),s.NextResponse.json({found:!1,error:"Failed to lookup vehicle. Please try again."},{status:500})}}let v=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/vehicle/[plate]/route",pathname:"/api/vehicle/[plate]",filename:"route",bundlePath:"app/api/vehicle/[plate]/route"},resolvedPagePath:"C:\\nzmobileautos\\next\\src\\app\\api\\vehicle\\[plate]\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:g,workUnitAsyncStorage:w,serverHooks:C}=v;function k(){return(0,o.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:w})}},42167:()=>{},95311:()=>{},93374:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>n});var a=r(96330);let n=global.__prisma||new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4762,7560],()=>r(95958));module.exports=a})();