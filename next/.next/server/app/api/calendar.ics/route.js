(()=>{var e={};e.id=7861,e.ids=[3374,7861],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8092:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>A,routeModule:()=>h,serverHooks:()=>f,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>N});var s={};r.r(s),r.d(s,{GET:()=>d,runtime:()=>l});var n=r(47268),a=r(61657),o=r(52624),i=r(88125),u=r(93374);let l="nodejs";function p(e){return(e||"").replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"").replace(/,/g,"\\,").replace(/;/g,"\\;")}function c(e){return e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z")}async function d(e){let t=new URL(e.url).searchParams.get("t")||"",r=process.env.ADMIN_PROVISION_TOKEN;if(!r)return new i.NextResponse("Calendar feed not configured",{status:500});if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let s=0;s<e.length;s++)r|=e.charCodeAt(s)^t.charCodeAt(s);return 0===r}(t,r))return new i.NextResponse("Not found",{status:404});let s=await u.prisma.booking.findMany({where:{status:"CONFIRMED"},orderBy:{slotStart:"asc"},include:{customer:!0,address:!0,vehicle:!0}}),n=new Date,a=[];for(let e of(a.push("BEGIN:VCALENDAR"),a.push("VERSION:2.0"),a.push("PRODID:-//Mobile Autoworks NZ//Admin Calendar//EN"),a.push("CALSCALE:GREGORIAN"),a.push("METHOD:PUBLISH"),a.push("X-WR-CALNAME:Mobile Autoworks Jobs"),a.push("X-WR-TIMEZONE:Pacific/Auckland"),s)){let t=`${e.id}@nzmobileauto.vercel.app`,r=c(e.slotStart),s=c(e.slotEnd),o=`Mobile Autoworks - ${e.kind} (${e.publicId})`,i=[e.address?.line1,e.address?.suburb,e.address?.city].filter(Boolean).join(", "),u=`${e.customer?.fullName||""}${e.customer?.phone?` (${e.customer.phone})`:""}`,l=`Reference: ${e.publicId}
Status: ${e.status}
Customer: ${u}
Customer email: ${e.customer?.email||""}
Address: ${i}
Vehicle: ${[e.vehicle?.plate,e.vehicle?.year,e.vehicle?.make,e.vehicle?.model].filter(Boolean).join(" ")}

Notes:
${e.notes||""}`;a.push("BEGIN:VEVENT"),a.push(`UID:${p(t)}`),a.push(`DTSTAMP:${c(n)}`),a.push(`DTSTART:${r}`),a.push(`DTEND:${s}`),a.push(`SUMMARY:${p(o)}`),i&&a.push(`LOCATION:${p(i)}`),a.push(`DESCRIPTION:${p(l)}`),a.push("END:VEVENT")}a.push("END:VCALENDAR");let o=a.join("\r\n")+"\r\n";return new i.NextResponse(o,{status:200,headers:{"content-type":"text/calendar; charset=utf-8","cache-control":"no-store, max-age=0","content-disposition":'inline; filename="mobile-autoworks.ics"'}})}let h=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/calendar.ics/route",pathname:"/api/calendar.ics",filename:"route",bundlePath:"app/api/calendar.ics/route"},resolvedPagePath:"C:\\nzmobileautos\\next\\src\\app\\api\\calendar.ics\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:N,serverHooks:f}=h;function A(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:N})}},42167:()=>{},95311:()=>{},93374:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>n});var s=r(96330);let n=global.__prisma||new s.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4762,7560],()=>r(8092));module.exports=s})();