(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{8095:(e,t,s)=>{Promise.resolve().then(s.bind(s,3151)),Promise.resolve().then(s.bind(s,8796)),Promise.resolve().then(s.bind(s,6810)),Promise.resolve().then(s.bind(s,3890))},3151:(e,t,s)=>{"use strict";s.d(t,{AdminLogoutButton:()=>d});var a=s(3827),l=s(7507);function d(){let[e,t]=(0,l.useState)(!1),s=async()=>{t(!0);try{let e=await fetch("/api/admin/logout",{method:"POST"});if(!e.ok){let t=await e.text();throw Error(t||"Logout failed")}window.location.href="/"}catch(e){alert((null==e?void 0:e.message)||"Logout failed")}finally{t(!1)}};return(0,a.jsx)("button",{type:"button",disabled:e,className:"px-3 py-2 rounded-md border border-white/15 text-white/90 hover:bg-white/5 disabled:opacity-60",onClick:s,children:e?"Logging out…":"Logout"})}},8796:(e,t,s)=>{"use strict";s.d(t,{BookingsTable:()=>d});var a=s(3827),l=s(7507);function d(e){let{initialBookings:t}=e,[s,d]=(0,l.useState)(null),r=(0,l.useMemo)(()=>t,[t]),i=async(e,t)=>{d(e);try{let s=await fetch("/api/bookings/status",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:e,status:t})});if(!s.ok){let e=await s.text();throw Error(e||"Failed to update booking status")}window.location.reload()}catch(e){alert((null==e?void 0:e.message)||"Failed to update booking status")}finally{d(null)}};return(0,a.jsx)("div",{className:"mt-8 overflow-x-auto border border-white/10 rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-white/5 text-white/70",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left p-3",children:"Created"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Public"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Kind"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Slot"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Status"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:r.map(e=>{let t=s===e.id;return(0,a.jsxs)("tr",{className:"border-t border-white/10",children:[(0,a.jsx)("td",{className:"p-3 text-white/70",children:e.createdAt}),(0,a.jsx)("td",{className:"p-3",children:e.publicId}),(0,a.jsx)("td",{className:"p-3",children:e.kind}),(0,a.jsx)("td",{className:"p-3 text-white/70",children:e.slotStart}),(0,a.jsx)("td",{className:"p-3",children:e.status}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("a",{className:"px-3 py-1.5 rounded-md border border-white/15 hover:bg-white/5 no-underline",href:"/admin/reports/".concat(e.id),children:"Report"}),(0,a.jsx)("a",{className:"px-3 py-1.5 rounded-md border border-white/15 hover:bg-white/5 no-underline",href:"/admin/reports/ppi/".concat(e.id),children:"PPI"}),(0,a.jsx)("button",{type:"button",disabled:t||"CONFIRMED"===e.status,className:"px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/15 disabled:opacity-60",onClick:()=>i(e.id,"CONFIRMED"),children:"Confirm"}),(0,a.jsx)("button",{type:"button",disabled:t||"CANCELLED"===e.status,className:"px-3 py-1.5 rounded-md border border-white/15 hover:bg-white/5 disabled:opacity-60",onClick:()=>i(e.id,"CANCELLED"),children:"Cancel"})]})})]},e.id)})})]})})}},6810:(e,t,s)=>{"use strict";s.d(t,{JobsPipeline:()=>r});var a=s(3827),l=s(7507);let d=[{key:"NEW",title:"New"},{key:"NEEDS_QUOTE",title:"Needs quote"},{key:"QUOTED",title:"Quoted"},{key:"SCHEDULED",title:"Scheduled"},{key:"IN_PROGRESS",title:"In progress"},{key:"COMPLETED",title:"Completed"},{key:"CANCELLED",title:"Cancelled"}];function r(e){let{initialJobs:t}=e,[s,r]=(0,l.useState)(null),[i,o]=(0,l.useState)(""),[n,c]=(0,l.useState)(!1),[h,u]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[b,p]=(0,l.useState)(""),[N,j]=(0,l.useState)(""),[w,g]=(0,l.useState)(""),[y,f]=(0,l.useState)("Auckland"),[v,E]=(0,l.useState)(""),C=(0,l.useMemo)(()=>{let e=i.trim().toLowerCase();return e?t.filter(t=>"".concat(t.publicId," ").concat(t.title).toLowerCase().includes(e)):t},[t,i]),S=(0,l.useMemo)(()=>{let e={NEW:[],NEEDS_QUOTE:[],QUOTED:[],SCHEDULED:[],IN_PROGRESS:[],COMPLETED:[],CANCELLED:[]};for(let t of C)e[t.status].push(t);return e},[C]),k=async(e,t)=>{r(e);try{let s=await fetch("/api/jobs/status",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:e,status:t})});if(!s.ok){let e=await s.text();throw Error(e||"Failed to update job status")}window.location.reload()}catch(e){alert((null==e?void 0:e.message)||"Failed to update job status")}finally{r(null)}},O=async()=>{if(!h.trim()||!m.trim()||!N.trim()||!w.trim()||!y.trim()){alert("Please fill title, customer name, and address.");return}c(!0);try{let e=await fetch("/api/jobs/create",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({status:"NEW",title:h.trim(),internalNotes:v.trim()||null,customer:{fullName:m.trim(),phone:b.trim()||null},address:{line1:N.trim(),suburb:w.trim(),city:y.trim()}})});if(!e.ok){let t=await e.text();throw Error(t||"Failed to create job")}window.location.reload()}catch(e){alert((null==e?void 0:e.message)||"Failed to create job")}finally{c(!1)}};return(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)("input",{value:i,onChange:e=>o(e.target.value),placeholder:"Search jobs (id/title)…",className:"w-full sm:w-80 rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{type:"button",disabled:n,className:"px-3 py-2 rounded-md bg-white/10 hover:bg-white/15 disabled:opacity-60 text-sm",onClick:O,children:n?"Creating…":"Create job"})})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"rounded-md border border-white/10 p-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"Quick create"}),(0,a.jsxs)("div",{className:"mt-3 grid gap-2",children:[(0,a.jsx)("input",{value:h,onChange:e=>u(e.target.value),placeholder:"Job title (e.g. Brake noise)",className:"rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"}),(0,a.jsx)("input",{value:m,onChange:e=>x(e.target.value),placeholder:"Customer name",className:"rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"}),(0,a.jsx)("input",{value:b,onChange:e=>p(e.target.value),placeholder:"Phone (optional)",className:"rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"}),(0,a.jsx)("input",{value:N,onChange:e=>j(e.target.value),placeholder:"Address line 1",className:"rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)("input",{value:w,onChange:e=>g(e.target.value),placeholder:"Suburb",className:"rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"}),(0,a.jsx)("input",{value:y,onChange:e=>f(e.target.value),placeholder:"City",className:"rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"})]}),(0,a.jsx)("textarea",{value:v,onChange:e=>E(e.target.value),placeholder:"Internal notes (optional)",className:"min-h-[90px] rounded-md bg-black/30 border border-white/10 px-3 py-2 text-sm"})]})]}),d.map(e=>{let t=S[e.key];return(0,a.jsxs)("div",{className:"rounded-md border border-white/10 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-3 py-2 bg-white/5 flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:e.title}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:t.length})]}),(0,a.jsx)("div",{className:"p-3 space-y-3",children:0===t.length?(0,a.jsx)("div",{className:"text-sm text-white/50",children:"No jobs"}):t.map(e=>{let t=s===e.id,l=function(e){switch(e){case"NEW":return"NEEDS_QUOTE";case"NEEDS_QUOTE":return"QUOTED";case"QUOTED":return"SCHEDULED";case"SCHEDULED":return"IN_PROGRESS";case"IN_PROGRESS":return"COMPLETED";default:return null}}(e.status);return(0,a.jsxs)("div",{className:"rounded-md border border-white/10 bg-black/20 p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:e.title}),(0,a.jsx)("div",{className:"mt-1 text-xs text-white/60",children:e.publicId}),e.scheduledStart?(0,a.jsxs)("div",{className:"mt-1 text-xs text-white/60",children:["Scheduled: ",e.scheduledStart]}):null]}),(0,a.jsx)("button",{type:"button",disabled:t,className:"px-2 py-1 rounded-md border border-white/15 hover:bg-white/5 text-xs disabled:opacity-60",onClick:()=>k(e.id,"CANCELLED"),children:"Cancel"})]}),(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[l?(0,a.jsxs)("button",{type:"button",disabled:t,className:"px-2.5 py-1.5 rounded-md bg-white/10 hover:bg-white/15 text-xs disabled:opacity-60",onClick:()=>k(e.id,l),children:["Move to ",l]}):null,"NEW"!==e.status?(0,a.jsx)("button",{type:"button",disabled:t,className:"px-2.5 py-1.5 rounded-md border border-white/15 hover:bg-white/5 text-xs disabled:opacity-60",onClick:()=>k(e.id,"NEW"),children:"Back to NEW"}):null]})]},e.id)})})]},e.key)})]})]})}},3890:(e,t,s)=>{"use strict";s.d(t,{QuoteRequestsTable:()=>d});var a=s(3827),l=s(7507);function d(e){let{initialQuotes:t}=e,[s,d]=(0,l.useState)(null),r=(0,l.useMemo)(()=>t,[t]),i=async(e,t)=>{d(e);try{let s=await fetch("/api/quotes/status",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:e,status:t})});if(!s.ok){let e=await s.text();throw Error(e||"Failed to update quote status")}window.location.reload()}catch(e){alert((null==e?void 0:e.message)||"Failed to update quote status")}finally{d(null)}};return(0,a.jsx)("div",{className:"mt-6 overflow-x-auto border border-white/10 rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-white/5 text-white/70",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left p-3",children:"Created"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Public"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Status"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Category"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Urgency"}),(0,a.jsx)("th",{className:"text-left p-3",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:r.map(e=>{let t=s===e.id;return(0,a.jsxs)("tr",{className:"border-t border-white/10",children:[(0,a.jsx)("td",{className:"p-3 text-white/70",children:e.createdAt}),(0,a.jsx)("td",{className:"p-3",children:e.publicId}),(0,a.jsx)("td",{className:"p-3",children:e.status}),(0,a.jsx)("td",{className:"p-3",children:e.category}),(0,a.jsx)("td",{className:"p-3",children:e.urgency}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{type:"button",disabled:t,className:"px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/15 disabled:opacity-60",onClick:()=>i(e.id,"CONTACTED"),children:"Mark contacted"}),(0,a.jsx)("button",{type:"button",disabled:t,className:"px-3 py-1.5 rounded-md border border-white/15 hover:bg-white/5 disabled:opacity-60",onClick:()=>i(e.id,"CLOSED"),children:"Close"})]})})]},e.id)})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1241,4211,7358],()=>t(8095)),_N_E=e.O()}]);